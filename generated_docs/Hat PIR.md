# Hat PIR 原理图描述

---

## 原理图分析

好的，遵照您的指示，以下是 M5Stack Hat PIR 原理图的技术描述。

### **整体电路设计思想**
该模块是一款基于专用 PIR 控制芯片 BISS0001 的被动红外传感器电路。其核心设计思想是：利用热释电红外传感器（PIR）将检测到的红外辐射变化转换为微弱的电信号，通过 BISS0001 芯片内部集成的两级运算放大器进行信号放大与滤波，再由内部的窗口比较器将模拟信号转换为数字触发信号，最后经过内部逻辑控制输出具有一定延时宽度的数字电平。电路采用 LDO 稳压器将 5V 输入转换为稳定的 3.3V 工作电压，以适配 M5StickC 的接口电平。

### **主要芯片及其功能**
*   **U1 (BISS0001):** 这是电路的核心控制器，是一款专用于 PIR 传感器的信号处理集成电路。它内部集成了高输入阻抗的运算放大器、窗口比较器、状态控制器、延时定时器以及输出驱动等功能模块。它负责处理来自 PIR 传感器的微弱信号，并根据外部 RC 元件设定的参数，输出数字控制信号。
*   **U2 (ME6211C33):** 这是一款低压差线性稳压器 (LDO)。其功能是将来自 M5StickC 的 5V 电源转换为稳定的 3.3V 电压，为整个模块（包括 BISS0001 芯片和 PIR 传感器）提供工作电源。

### **供电电路**
*   **电源输入:** 电路通过 J1 接口的 PIN1 从 M5StickC 获取 5V 电源。
*   **电压转换:** 5V 电压输入到 LDO 芯片 U2 (ME6211C33) 的 `IN` 引脚。U2 将电压稳定在 3.3V 后从 `OUT` 引脚输出。
*   **电源滤波:**
    *   `C10` (1uF) 是 U2 的输入滤波电容，用于稳定输入电压。
    *   `C11` (1uF) 是 U2 的输出滤波电容，用于保证输出 3.3V 电源的稳定性。
    *   `C12` (100nF) 是靠近 U1 芯片 `VDD` (PIN9) 引脚的去耦电容，用于滤除电源上的高频噪声。
*   **电源分配:** 经过稳压和滤波的 3.3V 电源被分配给 BISS0001 芯片的 `VDD` 引脚 (PIN9) 和输出引脚 `OUT` 的上拉电阻 `R1`。

### **PIR 传感与信号调理电路**
*   **PIR 传感器 (PIR1):** 这是核心感应元件，具有三个引脚：
    *   `D` (Drain): 信号输出端，连接到 BISS0001 的第一级放大器输入端。
    *   `S` (Source): 信号参考端，通过电阻 `R8` 和 `R9` 接地，形成偏置。
    *   `G` (Ground): 接地端。
*   **第一级放大:**
    *   PIR1 的 `D` 引脚输出的微弱差分信号，通过隔直电容 `C7` (100nF) 交流耦合至 BISS0001 的 `IN1+` 引脚 (PIN14)，即第一级运放的同相输入端。
    *   `R6` 和 `R7` 构成一个分压网络，为第一级运放的反相输入端 `IN1-` (PIN13) 提供偏置电压。
    *   `R5` 和 `C8` (100nF) 构成第一级运放的反馈网络，连接在输出端 `OP1O` (PIN16) 和反相输入端 `IN1-` (PIN13) 之间，决定了放大倍数和低通滤波特性。
*   **第二级放大 (窗口比较器):**
    *   第一级运放的输出信号 `OP1O` (PIN16)，通过隔直电容 `C6` (10nF) 交流耦合至 `IN2+` 引脚 (PIN11)，即窗口比较器的输入端。
    *   `IN2+` 引脚接收到经过放大的脉冲信号后，与 BISS0001 内部设定的上下阈值进行比较，以判断是否为有效的人体移动信号。

### **逻辑控制与延时电路**
*   **工作模式设置:** BISS0001 的 `A` 引脚 (PIN1) 通过电阻 `R2` 连接到 3.3V 电源，这将其设置为可重复触发模式。在此模式下，如果在输出高电平期间再次检测到信号，输出高电平的持续时间将重新开始计时。
*   **输出延时时间 (Tx):** 由连接在 `RTX` (PIN3) 和 `CTX` (PIN4) 之间的 RC 网络决定。电路上由电阻 `R3` 和电容 `C3` 组成。其延时时间 `Tx` 约等于 `24576 × R3 × C3`。
*   **触发禁止时间 (Ti):** 由连接在 `RTI` (PIN5) 和 `CTI` (PIN6) 之间的 RC 网络决定。电路上由电阻 `R4` 和电容 `C4` 组成。该时间用于在一次有效触发结束后，屏蔽一段时间内的输入信号，以防止因环境变化引起的误触发。其禁止时间 `Ti` 约等于 `24 × R4 × C4`。

### **输出电路**
*   **信号输出:** BISS0001 的 `VO` 引脚 (PIN2) 是其内部逻辑处理后的数字信号输出端。
*   **电平匹配与接口:**
    *   `VO` 引脚连接到 J1 接口的 `OUT` 引脚，该引脚对应 M5StickC 的 G36。
    *   电路中包含一个 `R1` (10kΩ) 上拉电阻，将 `OUT` 引脚上拉至 3.3V。当 BISS0001 未触发时，其 `VO` 输出为高阻态或低电平，`OUT` 引脚因上拉电阻而呈现高电平 (3.3V)；当检测到有效信号时，`VO` 内部的晶体管导通下拉至地，使 `OUT` 引脚变为低电平。
    *   **注意：** 根据常见 BISS0001 应用，`VO` 在感应到信号时输出高电平。但结合此处的上拉电阻设计，推断 `VO` 可能为开漏输出。更准确的行为是：未感应时，`OUT` 被 `R1` 拉高至 3.3V；感应到信号后，`VO` 输出一个高电平脉冲，此时 `OUT` 仍然是 3.3V。该描述基于原理图结构，实际应用中需确认 `VO` 的输出逻辑是拉高还是拉低。*(根据标准 M5Stack PIR Hat 行为，感应到信号时输出高电平，因此此处的设计意图应为 `VO` 主动输出高电平，R1 作为一个弱上拉，确保空闲状态为高电平)*

### **信号路径与电路连接关系总结**
1.  **电源路径:** M5StickC 5V → C10 → U2(ME6211) → 3.3V 输出 → C11 → U1(BISS0001) VDD & R1 上拉电阻。
2.  **信号路径:**
    *   人体红外辐射变化 → PIR1 传感器。
    *   PIR1 输出微弱电信号 → C7 (AC 耦合)。
    *   信号进入 U1 的第一级运放 (PIN14) 进行放大。
    *   放大后的信号经 C6 (AC 耦合) 进入 U1 的窗口比较器 (PIN11)。
    *   比较器产生触发脉冲，启动 U1 内部的延时定时器。
    *   U1 的 `VO` (PIN2) 输出一个由 R3/C3 设定的宽度的数字脉冲。
    *   该脉冲通过 J1 接口的 `OUT` 引脚，传输给 M5StickC 的 G36 引脚进行读取。

---

## 补充信息

好的，基于对原理图的进一步分析，以下是补充的技术说明：

### **补充说明**

1.  **光敏控制引脚 (CDS) 的配置**
    *   BISS0001 芯片的 PIN8 是 `CDS` 引脚，用于连接光敏电阻（CdS cell），以实现光控功能（例如，仅在环境光线较暗时才启用传感器）。
    *   在此电路中，`CDS` 引脚通过电容 `C5` (100nF) 接地。这种连接方式是 BISS0001 芯片数据手册中推荐的禁用光控功能的方法。
    *   其效果是，内部比较器的参考电压被固定，使得 PIR 传感功能被永久使能，模块可以在任何光照条件下（白天或黑夜）工作。

2.  **输出电路逻辑的进一步澄清**
    *   BISS0001 的 `VO` (PIN2) 标准输出逻辑是：在触发延时 `Tx` 期间输出高电平，在空闲和触发禁止时间 `Ti` 内输出低电平。
    *   因此，当模块未检测到人体移动时，`OUT` 引脚为低电平（约 0V）。当检测到移动时，`OUT` 引脚输出高电平（约 3.3V），并持续 `Tx` 所设定的时间。
    *   上拉电阻 `R1` (10kΩ) 在此电路中的作用是确保信号线有一个确定的默认状态。在 BISS0001 正常工作时，其推挽输出会覆盖 `R1` 的弱上拉作用。但在系统上电或 BISS0001 输出端处于高阻态的瞬间，`R1` 能防止 M5StickC 的 G36 输入引脚悬空，提供了一定的电气稳定性。

3.  **接口连接器 (J1) 的完整定义**
    该模块通过 J1 连接器与 M5StickC 通信和供电，其引脚定义如下：
    *   **PIN1 (5V):** 电源输入端，从 M5StickC 获取 5V 电源。
    *   **PIN2 (OUT/G36):** 信号输出端，将处理后的数字信号输出到 M5StickC 的 G36 引脚。
    *   **PIN3 (3.3V):** 3.3V 电源输出端。此 3.3V 是由板载 LDO (U2) 生成的，可以为外部小型设备提供电源。
    *   **PIN4 (GND):** 电路地。

4.  **关键无源元件的功能细化**
    *   **AC 耦合电容:** `C7` 和 `C6` 是级间交流耦合电容。它们的作用是只允许变化的信号（即由人体移动引起的 PIR 信号脉冲）通过，同时阻断各放大级之间的直流偏置电压，确保电路只对动态红外变化产生响应。
    *   **PIR 偏置电阻:** `R8` 和 `R9` 构成一个分压网络，为 PIR 传感器 `PIR1` 的 `S` (Source) 引脚提供一个稳定的直流偏置电压，这是传感器内部场效应管正常工作所必需的。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 21:50:02*
