# Module13.2 ECG 原理图描述

---

## 原理图分析

### Module13.2 ECG 原理图描述

#### 主要芯片及其功能

*   **STM32F031G4U6 (U1)**：主控制器，32位 ARM Cortex-M0 微控制器。负责通过 SPI 总线接收来自 ADC 的心电数据，运行内部算法进行处理与心率计算，并通过 UART 接口将结果发送至主控设备。
*   **AD8232 (U3)**：单导联、心率监护模拟前端。用于采集、放大和滤波来自心电电极的微弱生物电信号。其内部集成了仪表放大器和右腿驱动（RLD）电路。
*   **AD7476A (U5)**：12位、高速、低功耗、逐次逼近型模数转换器（ADC）。将经过前端调理后的模拟心电信号转换为数字信号。
*   **AD8603 (U4)**：精密、低噪声、轨到轨输入/输出运算放大器。在此电路中与外围阻容元件构成一个有源低通滤波器，用于对 AD8232 的输出信号进行进一步滤波。
*   **B0503S-1WR2 (U6)**：DC-DC 隔离电源模块。将输入的 5V 电压转换为隔离的 3.3V（ISO_3V3），为模拟前端电路提供隔离供电，实现电气安全隔离。
*   **SM1015 (U2)**：数字信号隔离器。用于隔离 ADC (U5) 与微控制器 (U1) 之间的 SPI 通信信号，确保数字地和模拟地之间的电气隔离。
*   **ME6211 (U7)**：低压差线性稳压器 (LDO)。将隔离电源模块输出的 ISO_3V3 稳定地调整后为 AD8232 提供电源。

#### 电路设计思想

该模块采用“模拟前端采集 + ADC 转换 + MCU 处理”的架构。核心设计思想是实现信号采集端（模拟电路）与数据处理端（数字电路）的完全电气隔离，以确保使用安全性和信号稳定性。心电信号由 AD8232 采集并初步调理，经 AD8603 构成的低通滤波器滤除高频噪声后，由 AD7476A ADC 转换为数字信号。数字信号通过 SM1015 隔离器传输给 STM32 微控制器，STM32 完成数据处理后通过 UART 接口输出。

#### 供电与隔离电路

*   **电源输入**：模块通过 M5-Bus 接口获取 5V 和 3.3V 电源。
*   **数字部分供电**：STM32 微控制器 (U1) 和数字隔离器 (U2) 的 B 侧（数字侧）由 M5-Bus 提供的 3.3V 直接供电，使用 GND 作为参考地。
*   **模拟部分供电与隔离**：M5-Bus 的 5V 电源输入至 B0503S-1WR2 (U6) 隔离电源模块。该模块输出一组电气隔离的电源（ISO_3V3）和地（GND_ISO）。
*   **模拟电路稳压**：ISO_3V3 电源首先为 AD8603 (U4)、AD7476A (U5) 以及数字隔离器 (U2) 的 A 侧（模拟侧）供电。同时，ISO_3V3 经过 ME6211 (U7) LDO 稳压后，为 AD8232 (U3) 提供更稳定的工作电源。整个模拟前端（U3, U4, U5）均工作在隔离电源域（ISO_3V3, GND_ISO）。

#### 信号路径

1.  **模拟信号采集**：心电信号通过 3.5mm 耳机接口 (J1) 的 `TIP` (ECG_P) 和 `RING1` (ECG_N) 输入至 AD8232 (U3) 的 `+IN` 和 `-IN` 引脚。`RING2` (RLD) 连接至 AD8232 的 `RLD` 引脚，用于右腿驱动以抑制共模干扰。
2.  **前端放大与滤波**：AD8232 对输入信号进行放大（增益 G=100），其 `OUTPUT` 引脚输出经过初步处理的模拟信号。
3.  **有源低通滤波**：AD8232 的输出信号送入由 AD8603 (U4) 及其外围电阻 (R11)、电容 (C22) 构成的二阶有源低通滤波器，进一步滤除高频噪声。
4.  **模数转换**：滤波后的模拟信号从 AD8603 的输出端送至 AD7476A (U5) 的 `VIN` 引脚，进行12位模数转换。
5.  **数字信号隔离传输**：AD7476A 的 SPI 输出信号（`SDATA`、`SCLK`）和片选信号（`/CS`）连接至数字隔离器 SM1015 (U2) 的 A 侧输入。隔离后的 SPI 信号从 U2 的 B 侧输出。
6.  **MCU 数据接收**：隔离后的 SPI 信号（SPI_MISO, SPI_SCK, SPI_CS）连接至 STM32 (U1) 的 PA6, PA5, PA4 引脚。STM32 作为 SPI 主机读取 ADC 数据。
7.  **串口输出**：STM32 (U1) 将处理后的数据通过其 UART1 接口（`TX`: PA9, `RX`: PA10）发送至 M5-Bus，与上位机或主控通信。

#### 外设模块与接口

*   **M5-Bus 接口**：标准的 M5Stack 接口，提供 5V、3.3V、GND 电源，以及 UART 通信的 TXD (G1) 和 RXD (G3) 信号线。
*   **ECG 输入接口 (J1)**：一个 3.5mm 三段式音频接口，用于连接心电电极。引脚定义为 `TIP` (ECG_P), `RING1` (ECG_N), `RING2` (RLD)。

#### 串口与通讯芯片

*   **串口通信**：STM32 (U1) 的 `PA9` (TX) 和 `PA10` (RX) 引脚直接连接到 M5-Bus 的对应引脚，实现与 M5 主控的 UART 通信。此部分通信电路位于非隔离区。
*   **SPI 通信**：STM32 (U1) 的 SPI1 接口（`PA4`:/CS, `PA5`:SCK, `PA6`:MISO）作为主机，通过数字隔离器 SM1015 (U2) 与位于隔离区的 AD7476A ADC (U5)进行通信。

#### 电路之间的连接关系

*   **ADC 到 MCU**：AD7476A (U5) 与 STM32 (U1) 之间通过 SPI 总线连接。该连接跨越了隔离边界，由数字隔离器 SM1015 (U2) 实现信号的电气隔离。U5 的 `SDATA` 连接至 U2 的 `INA`，U2 的 `OUTB` 连接至 U1 的 `PA6`。U1 的 `PA5` (SCK) 和 `PA4` (/CS) 分别通过 U2 的 B-A 侧通道驱动 U5 的 `SCLK` 和 `/CS` 引脚。
*   **MCU 到 M5-Bus**：STM32 (U1) 的 UART 引脚 `PA9`/`PA10` 直接与 M5-Bus 的 `G1`/`G3` 相连，用于数据输出。
*   **电源域关系**：电路被明确划分为两个电源域。数字域由 M5-Bus 的 3.3V 和 GND 供电，包含 STM32 (U1)。模拟域由隔离 DC-DC 模块 (U6) 生成的 ISO_3V3 和 GND_ISO 供电，包含 AD8232 (U3)、AD8603 (U4) 和 AD7476A (U5)。数字隔离器 (U2) 横跨两个电源域，连接了这两个部分。

---

## 补充信息

好的，以下是基于原理图的补充性技术描述：

### 补充说明

#### 1. 模拟前端的精细化设计

*   **AD8232 参考与偏置**：AD8232 (U3) 的参考电压输入引脚 `REFIN` 连接到一个由电阻 R9 和 R10 构成的分压器网络，该网络将隔离电源 ISO_3V3 分压，为 AD8232 的内部放大器提供一个稳定的中间电平偏置。电容 C19 用于稳定该参考电压。
*   **输入端 RC 滤波**：在 ECG 信号输入端（ECG_P 和 ECG_N），分别串联了电阻 R7 和 R8，并对地（GND_ISO）接有电容 C13 和 C14。这构成了一个低通 RC 滤波器，用于滤除进入 AD8232 前的高频噪声和射频干扰 (RFI)。
*   **AD8232 工作模式**：`LOD+` 和 `LOD-` 引脚（导联脱落检测）悬空，表示该功能未被使用。`SDN` (Shutdown) 引脚连接至其供电电源，确保芯片始终处于工作状态。`AC/DC` 引脚接地，选择直流耦合模式以实现快速恢复功能。

#### 2. 参考电压与信号调理

*   **ADC 参考电压**：ADC AD7476A (U5) 的 `REF` 引脚直接连接到其电源引脚 `VDD` (ISO_3V3)。这意味着 ADC 的转换基准电压即为其供电电压，其满量程输入范围为 0 至 ISO_3V3。
*   **运放偏置**：构成低通滤波器的运放 AD8603 (U4) 的同相输入端（+）连接至 AD8232 的参考电压 `VREF_AD8232`。此举将滤波器的输出信号偏置在 ADC 输入范围的中间点，从而最大化了动态范围。

#### 3. MCU 相关电路

*   **复位电路**：STM32 (U1) 的 `NRST` 引脚连接到一个由 R3 和 C6 组成的 RC 网络，提供上电复位功能。同时，该引脚也连接到一个按键 (BTN1)，允许用户手动复位微控制器。
*   **调试接口**：原理图上引出了 STM32 的 `PA13` (SWDIO) 和 `PA14` (SWCLK) 引脚，构成了标准的串行线调试（SWD）接口，用于固件烧录和在线调试。
*   **时钟源**：STM32 微控制器未外接晶体谐振器，表明其使用的是内部高速 RC 振荡器（HSI）作为系统时钟源。

#### 4. 电源去耦设计

*   原理图中为每一个关键集成电路的电源引脚附近都配置了去耦电容。例如，U1 (STM32) 旁的 C3、C4、C5，U3 (AD8232) 旁的 C17、C18，以及其他芯片旁的相应电容。这些电容的作用是滤除电源线上的高频噪声，为芯片提供瞬时电流，保证了数字电路和高精度模拟电路的稳定运行。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 22:31:35*
