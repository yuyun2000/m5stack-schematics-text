# Module13.2 AIN4-20mA 原理图描述

---

## 原理图分析

### Module13.2 AIN4-20mA 原理图描述

#### 1. 核心控制器 (MCU)
- **芯片型号**: STM32G030F6P6
- **功能**: 作为模块的主控单元，负责采集经过信号调理后的四路模拟电压信号，进行 ADC 转换和数据处理，并通过 I2C 接口与 M5 主机进行通信。

#### 2. 电源系统
- **外部供电**: 通过 DC-JACK 接口接收 9~24V 的直流电源输入。
- **DC-DC 转换**: 外部输入的直流电压经由一个 DC-DC 升压（Boost）电路处理。
- **电源隔离**: 经过升压的电源被送入 F2424S-2WR3 电源隔离模块的输入端。该模块输出一路与输入端电气隔离的 24V 直流电。这路隔离的 24V 电源专门用于为四路电流采集回路的初级侧（包括 HCNR200 的输入侧）供电，并通过跳线帽选择是否为外部 2 线制传感器供电。
- **主控侧供电**: MCU (STM32G030F6P6) 及信号调理电路（SGM321）等次级侧电路，通过 M5-Bus 接口的 BUS_5V (Pin 28) 引脚获取电源。
- **地隔离**: 电路设计了两个独立的地平面：隔离地（GND_ISO）和系统地（GND）。GND_ISO 用于电流输入端子和 HCNR200 隔离芯片的初级侧；系统地用于 MCU、SGM321 运算放大器和 M5-Bus 接口。F2424S-2WR3 模块是实现两个地平面之间电气隔离的关键。

#### 3. 电流采集与信号隔离电路 (共四路，结构相同)
- **输入端子**: 提供四组 IN+ 和 IN- 输入端子，用于连接 4~20mA 电流信号源。
- **输入阻抗**: 在每路输入的回路上，串联一个约 200Ω 的精密采样电阻。输入的 4~20mA 电流流过该电阻，产生一个与电流成正比的电压信号。
- **信号隔离**:
    - **芯片**: HCNR200 线性光电耦合器。
    - **原理**: 采样电阻上产生的电压信号驱动 HCNR200 内部的 LED。LED 发出的光被两个光电二极管接收。一个光电二极管位于初级侧，用于构建反馈回路以保证线性度；另一个光电二极管位于次级侧，输出一个与输入电流成正比的、且与初级侧完全电气隔离的微弱电流信号。
- **供电切换机制**:
    - 每路输入都配有一个跳线帽，用于选择供电模式。
    - **内部供电 (2线制)**: 连接跳线帽，将隔离电源 F2424S-2WR3 输出的 24V 电压连接到 IN+ 端子，为传感器提供工作电源。
    - **外部供电 (4线制)**: 断开跳线帽，IN+ 端子与内部隔离电源断开，传感器由外部独立供电。

#### 4. 信号调理与放大电路
- **芯片**: SGM321YC5/TR 运算放大器。
- **电路设计**: 每路 HCNR200 隔离输出的微弱电流信号被送入一个由 SGM321 构成的跨阻放大器（Transimpedance Amplifier）电路。
- **功能**: 该电路将来自 HCNR200 次级侧的电流信号转换成一个电压信号，并进行放大，使其幅度匹配 STM32G030F6P6 MCU 的 ADC 输入范围。
- **信号路径**: HCNR200 次级侧输出 -> SGM321 运放电路 -> STM32G030F6P6 的 ADC 输入引脚。

#### 5. 通信接口
- **芯片**: 通信功能由主控 MCU STM32G030F6P6 内置的 I2C 控制器实现。
- **协议**: I2C 总线。
- **地址**: 模块的 I2C 从机地址固定为 0x55。
- **物理连接**: MCU 的 I2C_SDA 和 I2C_SCL 引脚分别连接至 M5-Bus 的 17 号 (SDA) 和 18 号 (SCL) 引脚，与 M5 主机建立通信。

#### 6. M5-Bus 接口连接
- **SDA (Pin 17) / SCL (Pin 18)**: I2C 通信总线。
- **BUS_5V (Pin 28)**: 为模块的次级侧电路（MCU、运放等）提供 5V 电源。
- **HPWR (Pin 25-29)**: 备用电源输入引脚。
- **BAT_OUT (Pin 30)**: 备用电源输入引脚。
- **GND**: 连接至模块的系统地（次级侧地）。

---

## 补充信息

好的，以下是基于前述信息的补充说明，旨在进一步阐述电路的工作流程和设计细节。

### 电路结构与工作流程补充

#### 1. 信号处理链路 (单通道)
模块的核心功能是将输入的 4~20mA 电流信号转换为可被 M5 主机读取的数字值。其信号处理链路如下：
1.  **电流-电压转换**: 外部传感器产生的 4~20mA 电流流经输入端子（IN+ / IN-）和板载的约 200Ω 采样电阻，在该电阻上产生一个与输入电流成线性关系的电压降（例如，4mA -> 0.8V, 20mA -> 4.0V）。
2.  **光电隔离**: 该电压信号驱动隔离芯片 HCNR200 初级侧的 LED。HCNR200 的次级侧光电二极管会产生一个与初级侧光强成正比的、微安级别的微小电流。此过程实现了信号的电气隔离。
3.  **跨阻放大与调理**: 该微小电流被送入运算放大器 SGM321YC5/TR 构成的跨阻放大电路。该电路将输入的微弱电流信号转换并放大为一个电压信号。电路的增益由反馈电阻决定，其设计目标是使 4~20mA 输入范围恰好映射到 MCU 的 ADC 模块能够有效识别的电压范围（如 0.x V 至 3.x V）。
4.  **ADC 采样**: 经过调理后的模拟电压信号被送至主控 MCU STM32G030F6P6 的一个 ADC 输入引脚。
5.  **数据处理与通信**: MCU 对采集到的数字电压值进行计算，将其反向换算为对应的电流值（mA），并通过 I2C 总线将四路通道的数据传输给 M5 主机。

#### 2. 电源路径与隔离域
电路被明确划分为两个独立的电气域，以确保测量的安全性和抗干扰能力：
- **隔离域 (Primary Side / ISO-Side)**:
    - **电源来源**: 外部 9~24V DC 电源经内部 DC-DC 升压后，由 F2424S-2WR3 模块转换为隔离的 24V 电源。
    - **供电对象**: HCNR200 芯片的初级侧（LED 驱动电路）以及通过跳线帽选择性供给的外部 2 线制传感器。
    - **地平面**: 使用独立的隔离地 (GND_ISO)。
- **系统域 (Secondary Side / System-Side)**:
    - **电源来源**: M5-Bus 接口提供的 BUS_5V (Pin 28)。该 5V 电源会进一步通过 LDO（低压差线性稳压器）转换为 3.3V，用于 MCU 和其他逻辑电路。
    - **供电对象**: 主控 MCU (STM32G030F6P6)、四颗运算放大器 (SGM321YC5/TR)、HCNR200 芯片的次级侧（光电二极管接收电路）。
    - **地平面**: 使用系统地 (GND)，与 M5 主机的地相连。

#### 3. 关键电路设计细节
- **HCNR200 的线性化设计**: HCNR200 内部包含两个匹配的光电二极管。一个用于次级侧信号输出，另一个位于初级侧，通常与外部电路构成负反馈回路，用于稳定 LED 的光输出，从而补偿 LED 的非线性、温度漂移和老化效应，保证了从输入电流到输出电流的高线性度转换。
- **跳线配置的电气逻辑**: 跳线帽在电路中扮演着物理开关的角色。当用于内部供电时，它将 F2424S-2WR3 输出的隔离 24V 电源正极与电流输入端子 IN+ 直接连通，形成一个完整的电流回路，为 2 线制传感器供电。当用于外部供电时，该连接被断开，IN+ 端子仅作为信号输入点。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 22:19:29*
