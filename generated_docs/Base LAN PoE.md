# Base LAN PoE 原理图描述

---

## 原理图分析

好的，遵照您的指示，以下是 M5Stack Base LAN PoE (SKU: K012-C) 的原理图技术性描述。

---

### 1. 主要芯片及其功能

#### 1.1. 以太网控制器 (W5500)
- **型号**: W5500 (U2)
- **功能**: W5500 是一款全硬件 TCP/IP 协议栈的以太网控制器，集成了 10/100Mbps 以太网物理层 (PHY) 和媒体访问控制层 (MAC)。它通过 SPI 接口与主控 MCU 进行通信，显著降低了主控在网络协议处理上的负载。
- **接口与连接**:
  - **SPI 接口**: 通过 M-Bus 接口连接至主控 MCU。信号包括 `SPI_MOSI` (MOSI), `SPI_MISO` (MISO), `SPI_CLK` (SCLK), `CS` (SCSn)。
  - **控制信号**: `RST` (RSTn) 和 `INT` (INTn) 信号同样通过 M-Bus 连接至主控，分别用于硬件复位和中断通知。
  - **以太网 PHY 接口**: 差分信号对 `TXOP/TXON` (发送) 和 `RXIP/RXIN` (接收) 连接至网络隔离变压器 (T1)。
- **时钟**: 由一个 25MHz 的无源晶振 (Y1) 提供工作时钟。
- **供电**: 由板载 +3.3V LDO (U6) 供电，并在 VDD 和 VSS 引脚周围配置了多个去耦电容 (C10, C11, C12, C13) 以保证电源稳定。

### 2. 电源系统

#### 2.1. 供电输入
该模块支持两种供电方式，通过二极管 (D3, D4) 实现电源输入的“或”逻辑，防止电源反灌：
1.  **PoE 供电**: 通过 RJ45 接口 (J2) 的空闲线对 (Pin 4&5, Pin 7&8) 获取符合 IEEE 802.3af 标准的 PoE 电源。
2.  **外部 DC 供电**: 通过 DC-044 电源插座 (J3) 支持 9V-24V 的直流电压输入。

#### 2.2. PoE 模块 (U1)
- **功能**: U1 是一个隔离式 PoE 模块，负责从 RJ45 接口的 `VC+` (Pin 7,8) 和 `VC-` (Pin 4,5) 引脚上提取电力，并将其转换为稳定的直流电压。
- **输出**: PoE 模块的输出经过二极管 D3 后汇入主电源输入轨 `VIN`。

#### 2.3. 电压转换
- **Step-Down (降压) 转换器**: 核心降压芯片为 SY8113B (U3)，它是一个高效的同步降压转换器。
  - **输入**: 输入电压 `VIN` 来自 PoE 模块或外部 DC 电源 (9V-24V)。
  - **输出**: 将 `VIN` 降压至稳定的 `+5V`，为板载大部分芯片和 M-Bus 上的 `5V` 引脚供电。电路中包含电感 L2 和相应的反馈电阻 (R13, R14) 构成 Buck 电路。
- **LDO (低压差线性稳压器)**:
  - **3.3V LDO**: 型号为 ME6211 (U6)，将 `+5V` 电压转换为 `+3.3V`，专门为以太网控制器 W5500 (U2) 供电。

#### 2.4. 电源输出与分配
- **+5V**: 由 SY8113B 产生，是模块内部主要的供电电压，为 RS485/RS232 芯片供电，并输出至 M-Bus 接口的 `5V` 引脚。
- **BAT**: M-Bus 上的 `BAT` 引脚在本模块中为直通设计，未连接任何电源电路，仅用于 M5 主控与其它模块间的电池电压传递。
- **HPWR**: `HPWR` (High Power) 引脚直接连接到 `VIN` 电压轨，即外部 9-24V DC 或 PoE 模块的输出电压。这使得 M5 主控可以直接获取未经稳压的原始输入电源。

### 3. 以太网电路
- **网络接口**: RJ45 接口 (J2)，型号为 HR911105A，集成了网络隔离变压器 (T1) 和状态指示灯。
- **隔离与耦合**: W5500 的 `TX/RX` 差分信号对通过耦合电容连接至网络变压器 T1 的芯片侧。T1 提供了必要的电气隔离（1.5kVrms），并进行阻抗匹配。变压器的 RJ45 侧连接至物理接口，其中心抽头用于 PoE 电力提取。

### 4. 串口与通讯电路
该模块集成了 RS485 和 RS232 两种串口通讯标准，通过一个两位拨码开关 (SW1) 进行模式选择。串口信号通过一个 6Pin 的 HT3.96 间距端子 (J6) 引出。

#### 4.1. 模式选择开关 (SW1)
- **功能**: SW1 是一个双刀双掷 (DPDT) 开关，用于将 M-Bus 上的串行 TTL 信号 `RXD0` 和 `TXD0` 切换连接至 RS485 收发器或 RS232 电平转换芯片。
- **逻辑**:
  - 当开关拨至 RS485 侧时，`TXD0` 连接到 SP3485EE 的 `RO`，`RXD0` 连接到 `DI`。
  - 当开关拨至 RS232 侧时，`TXD0` 连接到 MAX232 的 `R1OUT`，`RXD0` 连接到 `T1IN`。

#### 4.2. RS485 电路
- **芯片**: SP3485EE (U4)，一个 3.3V 低功耗半双工 RS485 收发器。
- **信号路径**:
  - **发送**: M-Bus 的 `RXD0` -> SW1 -> U4 的 `DI` (Driver Input) -> 差分信号 `A/B` -> HT3.96 端子。
  - **接收**: HT3.96 端子的 `A/B` -> U4 -> `RO` (Receiver Output) -> SW1 -> M-Bus 的 `TXD0`。
- **方向控制**: U4 的 `DE` (Driver Enable) 和 `RE` (Receiver Enable) 引脚并联，由 M-Bus 上的 `GPIO_CTL` 引脚控制，实现发送/接收模式的切换。
- **保护与终端**: 在 A/B 信号线上配置了 TVS 二极管 (D5, D6) 用于静电和浪涌保护。终端电阻 R20 (120Ω) 可通过跳线 J5 选择是否接入。

#### 4.3. RS232 电路
- **芯片**: MAX232 (U5)，一个标准的双路 RS232 驱动器/接收器。
- **信号路径**:
  - **发送 (TTL->RS232)**: M-Bus 的 `RXD0` -> SW1 -> U5 的 `T1IN` -> `T1OUT` -> HT3.96 端子的 `TX`。
  - **接收 (RS232->TTL)**: HT3.96 端子的 `RX` -> U5 的 `R1IN` -> `R1OUT` -> SW1 -> M-Bus 的 `TXD0`。
- **电平转换**: U5 利用外部的电荷泵电容 (C23, C24, C25, C26) 将 +5V 电压生成约 ±10V 的 RS232 电平。
- **供电**: 由 `+5V` 电源供电。

### 5. M-Bus 接口与连接关系
通过 2x15 Pin 的排针/排母 (J1) 与 M5 主控连接，主要信号分配如下：
- **SPI 总线**: `SPI_MOSI`, `SPI_MISO`, `SPI_CLK`, `CS`，专用于与 W5500 通信。
- **控制总线**: `RST`, `INT`，用于控制 W5500。
- **UART 总线**: `RXD0`, `TXD0`，连接至拨码开关 SW1，用于 TTL 串口通信。
- **GPIO**: `GPIO_CTL`，用于控制 RS485 收发器的方向。
- **电源总线**: `5V` (由本模块产生并可为主控供电)，`BAT` (直通)，`HPWR` (提供 9-24V 原始输入电压)，`GND`。

### 6. 外设与接口
- **RJ45 接口 (J2)**: 用于以太网连接和 PoE 供电。
- **HT3.96 端子 (J6)**: 6Pin 绿色接线端子，用于引出 RS485 (A, B) 或 RS232 (TX, RX) 信号，同时提供 5V 和 GND。
- **DC 电源插座 (J3)**: 用于连接 9-24V 外部电源适配器。
- **M-Bus 连接器 (J1)**: 用于与 M5Stack 主控堆叠连接。
- **跳线 (J5)**: 用于选择是否为 RS485 总线并联 120Ω 终端电阻。

---

## 补充信息

是的，在上述结构化描述的基础上，可以补充以下几点电路设计细节，以提供更完整的技术视图：

### 电路设计细节补充

1.  **以太网信号完整性与EMI抑制**:
    *   **Bob Smith端接**: 在网络隔离变压器 (T1) 的芯片侧中心抽头与地之间，设计了标准的 Bob Smith 端接电路。该电路由电阻 R5, R6, R7, R8 和电容 C7 组成，用于端接差分信号对的共模噪声，有效抑制电磁干扰 (EMI) 并提升信号完整性。
    *   **状态指示灯**: W5500 的 `LINKLED` 和 `SPDLED` 引脚直接驱动 RJ45 接口 (J2) 上集成的两个 LED，用于直观地显示网络连接状态（Link）和速度（Speed）。

2.  **控制信号稳定性**:
    *   W5500 芯片的复位引脚 `RSTn` 和中断引脚 `INTn` 均通过 10kΩ 的电阻 (R3, R2) 上拉至 +3.3V。这确保了在主控 MCU I/O 初始化或未主动驱动时，这些信号处于稳定、有效的高电平默认状态。

3.  **RS485 总线可靠性设计**:
    *   **失效保护偏置 (Fail-Safe Biasing)**: 为了确保在总线空闲（所有节点均未发送数据）时有一个确定的差分电压，电路中加入了偏置电阻。电阻 R18 将 A 线路上拉至 +5V，电阻 R19 将 B 线路下拉至 GND。这可以有效防止总线悬空时接收器因噪声产生误判。

4.  **电源保护与滤波**:
    *   **反极性保护**: 外部 DC 输入 (J3) 路径上的二极管 D4 不仅用于与 PoE 电源进行“或”逻辑隔离，同时也起到了防止电源反接的保护作用。
    *   **输入/输出滤波**: 在 9-24V 主电源输入轨 `VIN` 上配置了电解电容 C16 和 C17 作为输入滤波，用于吸收电压尖峰和稳定输入。同样，在 +5V 输出端也配置了电容 C19 和 C20，以保证输出电压的平稳和低纹波。

5.  **HT3.96 端子引脚定义 (J6)**:
    该 6Pin 接线端子的具体引脚功能分配如下：
    *   Pin 1: `RS485_A` / `RS232_TX`
    *   Pin 2: `RS485_B` / `RS232_RX`
    *   Pin 3: `GND`
    *   Pin 4: `GND`
    *   Pin 5: `+5V`
    *   Pin 6: `+5V`
    （`GND` 和 `+5V` 分别提供了两个并联的引脚以增大电流承载能力）

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 20:04:55*
