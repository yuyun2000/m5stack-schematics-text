# Unit ACSSR 原理图描述

---

## 原理图分析

好的，以下是根据您提供的 M5Stack Unit ACSSR 原理图生成的详细技术描述。

### **M5Stack Unit ACSSR 原理图描述**

#### **1. 主控芯片及其功能**

该模块的核心控制器是 **ESP32-C3-MINI-1 (U1)**，一颗集成 Wi-Fi 和 Bluetooth 5 (LE) 的 32 位 RISC-V 单核微控制器。其主要引脚连接及功能分配如下：

*   **GPIO0 (SCL)**: 连接至 Grove 接口的 SCL 线，用于 I2C 通信。
*   **GPIO1 (SDA)**: 连接至 Grove 接口的 SDA 线，用于 I2C 通信。
*   **GPIO2 (RGB_LED_PIN)**: 用于驱动板载的可编程 RGB LED (SK6812)。
*   **GPIO3 (BTN)**: 连接至一个物理按键 (S1)，作为用户输入。
*   **GPIO4 (RELAY_CTL)**: 作为固态继电器控制信号输出引脚。
*   **GPIO5 (UART0_TXD)**: 作为 UART0 的发送引脚，连接至 RS485 收发器的数据输入端。
*   **GPIO6 (UART0_RXD)**: 作为 UART0 的接收引脚，连接至 RS485 收发器的数据输出端。
*   **VDD3V3**: 连接至系统 3.3V 电源，为主控芯片供电。

#### **2. 供电与电源管理**

模块支持双路直流电源输入，并通过一个 DC-DC 转换器为系统提供稳定的 3.3V 电压。

*   **输入接口**:
    *   **RS485PWR 接口 (J2)**: 一个 VH3.96-4P 连接器，支持 **DC 9~24V** 输入 (`V_IN`)。
    *   **Grove 接口 (J1)**: 一个 HY2.0-4P 连接器，支持 **DC 5V** 输入 (`VBUS`)。
*   **电源选择电路**:
    *   来自 J1 和 J2 的电源输入通过两个肖特基二极管 **D1** 和 **D2 (SS14)** 构成一个“或门”电路。此设计可防止两路电源相互倒灌，并自动选择电压较高的一路为系统供电。
*   **DC-DC 稳压电路**:
    *   主稳压芯片为 **SY8089I (U3)**，它是一款高效的同步降压转换器。
    *   该芯片将来自二极管“或门”电路的 `VIN`（5V 或 9-24V）转换为稳定的 **3.3V**。
    *   此 3.3V 电源 (`3V3`) 为主控芯片 ESP32-C3、RS485 收发器、RGB LED、按键上拉电阻以及 I2C 上拉电阻等所有低压逻辑电路供电。

#### **3. 交流固态继电器 (ACSSR) 与驱动电路**

模块的核心功能是控制一个单相交流固态继电器 (SSR)。

*   **固态继电器 (J3)**:
    *   这是一个模块化元件，原理图上标示了其直流输入端 (`IN+`, `IN-`) 和交流输出端 (`OUT1`, `OUT2`)。
    *   其内部包含光电隔离、触发电路和功率开关元件（如双向晶闸管），实现了控制侧与负载侧的电气隔离。
    *   继电器模块内置一个状态指示灯，当输入端有电流时点亮。
*   **驱动电路**:
    *   ESP32-C3 的 **GPIO4 (RELAY_CTL)** 信号通过一个 **NPN 型三极管 Q1 (MMBT2222A)** 来驱动 SSR。
    *   这是一个典型的低边开关 (Low-side Switch) 设计：
        *   SSR 的输入正极 `IN+` 连接到 3.3V 电源。
        *   SSR 的输入负极 `IN-` 连接到三极管 Q1 的集电极。
        *   Q1 的发射极接地，基极通过一个限流电阻 R6 连接到 `RELAY_CTL`。
    *   **工作逻辑**: 当 `RELAY_CTL` 输出高电平 (3.3V) 时，三极管 Q1 导通，将 `IN-` 拉至地电平，从而在 SSR 输入端形成约 3.3V 的压差，使其导通。当 `RELAY_CTL` 输出低电平时，Q1 截止，SSR 输入端无电流，继电器断开。

#### **4. 负载输出接口与信号路径**

交流负载通过一个 4 位 3.96mm 间距的接线端子 **J4 (TB396-4P)** 连接。

*   **端子定义**:
    *   Pin 1: `OUT_L` (负载火线输出)
    *   Pin 2: `OUT_N` (负载零线输出)
    *   Pin 3: `IN_L` (市电火线输入)
    *   Pin 4: `IN_N` (市电零线输入)
*   **信号路径**:
    *   外部市电火线接入 `IN_L` (Pin 3)，该电流进入 SSR 的输出端 `OUT2`。
    *   当 SSR 导通时，电流从 `OUT1` 流出，并连接到 `OUT_L` (Pin 1)，再流向外部负载。
    *   外部市电零线接入 `IN_N` (Pin 4)，该端子在 PCB 上与 `OUT_N` (Pin 2) 直接相连，为负载提供回路。
*   **结论**: 该设计通过 SSR 串联在火线 (Live) 路径中，以通断火线的方式来控制交流负载的开关，符合安全规范。

#### **5. 串口与通讯芯片**

模块集成了 RS485 和 I2C 两种通信方式。

*   **RS485 通信**:
    *   **收发器**: 采用 **SP3485 (U2)** 芯片，这是一款 3.3V 供电的 RS485 收发器。
    *   **数据连接**: ESP32-C3 的 `UART0_TXD` (GPIO5) 连接到 SP3485 的 `DI` (Driver Input)，`UART0_RXD` (GPIO6) 连接到 `RO` (Receiver Output)。
    *   **方向控制**: SP3485 的接收使能 `RE#` (低有效) 和发送使能 `DE` (高有效) 引脚被连接在一起，但其控制信号源在原理图中未明确连接至 ESP32-C3 的 GPIO。
    *   **总线端**: `A` 和 `B` 线连接到 RS485PWR 接口 (J2)，并并联了一个 **120Ω 的终端匹配电阻 R12**。
*   **I2C 通信**:
    *   通过 **Grove 接口 (J1)** 实现，作为 I2C 从设备工作。
    *   ESP32-C3 的 **GPIO0 (SCL)** 和 **GPIO1 (SDA)** 直接连接到 J1 的对应引脚。
    *   SCL 和 SDA 线上分别配置了 **4.7KΩ 的上拉电阻 R4 和 R3**，将总线电平上拉至 3.3V。

#### **6. 外设、逻辑电路与人机交互**

*   **可编程 RGB LED**:
    *   使用一颗 **SK6812 (LED1)** 芯片。
    *   其数据输入引脚 `DI` 由 ESP32-C3 的 **GPIO2** 控制，可实现全彩编程。
    *   由 3.3V 电源供电。
*   **按键输入**:
    *   一个物理按键 **S1** 连接在 ESP32-C3 的 **GPIO3** 和地之间。
    *   一个 **10KΩ 的上拉电阻 R1** 将 GPIO3 默认拉高至 3.3V。当按键按下时，GPIO3 被拉低，产生一个下降沿中断或低电平信号。

---

## 补充信息

是的，在对原理图进行更深入的分析后，可以补充以下几个关键的技术细节和设计要点：

### **补充技术描述**

#### **1. 编程与调试接口**

*   原理图上包含一个专用的 **编程/调试排针 P1**。这是一个 2.54mm 间距的 6-Pin 接口，用于对 ESP32-C3 进行固件烧录和调试。
*   **排针 P1 引脚定义**:
    *   **3V3 / GND**: 提供调试器或串口模块的供电参考。
    *   **RXD / TXD**: 连接到 ESP32-C3 的 `UART0_RXD` (GPIO6) 和 `UART0_TXD` (GPIO5)，与 RS485 收发器共享 UART0 总线。在烧录时，需要确保 RS485 总线不受干扰。
    *   **IO9**: 连接到 ESP32-C3 的 GPIO9，这是 ESP32-C3 的一个关键 strapping pin。在烧录模式下，需要将此引脚拉低。
    *   **EN**: 连接到 ESP32-C3 的 `EN` (Enable/Reset) 引脚，用于复位芯片。

#### **2. ESP32-C3 启动配置 (Strapping Pins)**

*   为了确保 ESP32-C3 能够从内部 Flash 正常启动，原理图上对 strapping pins 进行了配置。
*   **GPIO9** 通过一个 **10KΩ 的下拉电阻 R2** 连接到地。此配置确保了在正常上电时，芯片会从主 SPI Flash 启动运行用户程序。

#### **3. RS485 方向控制**

*   RS485 收发器 **SP3485 (U2)** 的方向控制是通过 ESP32-C3 的 **GPIO7** 实现的。
*   SP3485 的接收使能引脚 `RE#` (低电平有效) 和发送使能引脚 `DE` (高电平有效) 被连接在一起，并由信号 `485_EN` 控制。
*   `485_EN` 信号直接由 **GPIO7** 驱动。
*   同时，`485_EN` 信号线上还有一个 **下拉电阻 R13** 接地。
    *   **功能**: 这个设计确保了在 ESP32-C3 初始化完成前或 GPIO7 未被配置时，`485_EN` 信号默认为低电平。这使得 SP3485 默认处于 **接收模式** (`RE#`=0, `DE`=0)，避免了总线冲突。
    *   **工作逻辑**: 当需要发送数据时，软件需将 GPIO7 置为高电平，使能发送器；发送完成后，立即将 GPIO7 置为低电平，切换回接收模式。

#### **4. 电路稳定性与去耦设计**

*   原理图中为所有关键集成电路都配置了去耦电容，以确保电源的稳定性和滤除高频噪声。
*   **ESP32-C3 (U1)**: 周围布置了多个电容 (如 C4, C5, C6, C7)，分别靠近其不同的电源引脚，用于高频和低频去耦。
*   **SY8089I (U3)**: 在其输入端 `VIN` 和输出端 `3V3` 均配置了电容 (如 C10, C11, C12)，这是 DC-DC 转换器稳定工作的必要条件。
*   **SP3485 (U2)**: 在其 VCC 引脚附近配置了去耦电容 (如 C8, C9)，以保证通信芯片的稳定运行。

#### **5. 电气隔离的明确性**

*   需要强调的是，整个低压直流控制电路（包括 ESP32-C3、电源、通信接口等）与高压交流负载电路之间通过 **固态继电器 (J3) 内部的光电耦合器** 实现了完全的 **电气隔离 (Galvanic Isolation)**。
*   PCB 布局上，高压部分（J4 接线端子和 J3 的输出侧）与低压部分物理上会保持足够的安全距离和爬电距离，这是产品的核心安全设计。

---

*该文档由 AI 自动生成，生成时间: 2025-11-18 00:03:34*
