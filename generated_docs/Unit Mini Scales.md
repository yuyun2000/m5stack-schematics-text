# Unit Mini Scales 原理图描述

---

## 原理图分析

### M5Stack Unit Mini Scales 原理图描述

#### 1. 系统整体架构
该电路是一个基于 STM32 微控制器和 HX711 专用 ADC 的称重单元模块。其核心设计思想是：使用 HX711 芯片采集和转换来自称重传感器（应变片电桥）的微弱模拟信号，然后通过 STM32F030F4P6 微控制器处理该数字信号，并通过 I2C 接口将最终的重量数据提供给外部主控设备。电路集成了电源管理、用户交互（按键）和状态指示（RGB LED）。

#### 2. 主要芯片及其功能
*   **U1 - STM32F030F4P6 (微控制器)**：
    *   **核心**: ARM Cortex-M0 内核。
    *   **功能**: 作为主控芯片，负责整个模块的逻辑控制。其主要任务包括：
        1.  通过串行接口与 HX711 通信，读取重量数据。
        2.  处理按键（K1）输入，执行去皮、校准等操作。
        3.  控制 SK6812 RGB LED（LED1）以显示工作状态。
        4.  作为 I2C 从设备，通过 HY2.0-4P 接口与 M5Stack 主机或其他主控制器进行通信，响应数据请求。
*   **U2 - HX711 (24位A/D转换器)**：
    *   **功能**: 专为高精度电子秤设计的模数转换芯片。它内部集成了低噪声可编程增益放大器（PGA）和24位Σ-Δ ADC。
    *   **作用**: 将来自外部称重传感器惠斯通电桥的 mV 级差分电压信号进行放大和数字化转换，并将结果通过一个两线串行接口输出给 STM32 微控制器。

#### 3. 电源与供电电路
*   **电源输入**: 电路通过 HY2.0-4P 接口（J1）的 VCC（红色线）和 GND（黑色线）引脚获取 5V 外部供电。
*   **电压调整**: 5V 输入电压经过一个低压差线性稳压器（LDO，图中未标出具体型号）降压至 3.3V。
*   **电源分配**:
    *   3.3V 电源为 STM32F030F4P6 微控制器（VDD, VDDA）和 HX711 芯片（AVDD, DVDD）提供工作电压。
    *   SK6812 RGB LED 直接由 5V 输入电源供电，以保证足够的亮度和色彩表现。
*   **滤波**: 在 STM32 和 HX711 的电源引脚附近配置了多个去耦电容，用于滤除电源噪声，确保芯片稳定工作。

#### 4. 信号路径与电路连接关系
*   **称重信号路径**:
    1.  一个四线称重传感器通过连接器接入电路。其激励端（E+, E-）连接至 HX711 的 E+ 和 E- 引脚，信号输出端（A+, A-）连接至 HX711 的差分输入引脚 INA+ 和 INA-。
    2.  HX711 将采集到的模拟信号转换为24位数字信号。
    3.  STM32 通过其 GPIO 引脚（连接到 HX711 的 DOUT 和 PD_SCK 引脚）读取该数字信号。STM32 控制 PD_SCK 作为时钟，从 DOUT 线上逐位读取数据。
*   **I2C 通信路径**:
    1.  STM32 的 I2C 接口引脚（SCL 和 SDA）连接到 HY2.0-4P 接口的相应引脚。具体连接为：STM32 的 PA9(SCL) 和 PA10(SDA)。
    2.  这两条信号线上拉至 3.3V 电源，构成了标准的 I2C 总线。
    3.  STM32 作为 I2C 从设备，设备地址固定为 **0x26**。

#### 5. 外设模块与逻辑电路
*   **RGB LED 控制电路**:
    *   一颗 SK6812 型可编程单线控制 RGB LED（LED1）用于状态指示。
    *   其数据输入引脚（DIN）连接至 STM32 的 **PB1** 引脚。STM32 通过该引脚发送特定的时序脉冲来控制 LED 的颜色和亮度。
*   **按键电路**:
    *   一个瞬时轻触按键（K1）连接在 STM32 的 **PA7** 引脚和 GND 之间。
    *   PA7 引脚在 STM32 内部被配置为上拉输入。当按键未按下时，引脚为高电平；当按键按下时，引脚被拉至低电平。固件通过检测此引脚的电平变化来实现零点校准或去皮功能。

#### 6. 接口定义
*   **HY2.0-4P 接口 (J1)**:
    *   **Pin 1 (红色)**: 5V - 电源输入。
    *   **Pin 2 (黑色)**: GND - 电源地。
    *   **Pin 3 (白色)**: SCL - I2C 时钟线，连接至 STM32 的 PA9。
    *   **Pin 4 (黄色)**: SDA - I2C 数据线，连接至 STM32 的 PA10。
*   **称重传感器接口 (4-Pin)**:
    *   **E+**: 激励电压正极，连接至 HX711 的 E+。
    *   **E-**: 激励电压负极，连接至 HX711 的 E-。
    *   **A+**: 传感器信号正极，连接至 HX711 的 INA+。
    *   **A-**: 传感器信号负极，连接至 HX711 的 INA-。

---

## 补充信息

在之前的描述基础上，可以补充以下更深入的技术细节，这些细节通常在原理图中有所体现：

### 补充技术细节

#### 1. STM32 微控制器特定电路
*   **复位电路 (Reset Circuit)**: STM32F030F4P6 的 NRST 引脚通常会通过一个上拉电阻（如 10kΩ）连接到 3.3V 电源，并可能并联一个电容（如 100nF）到地。这构成了标准的上电复位和外部复位电路，确保微控制器在通电时能可靠地启动。
*   **启动模式配置 (Boot Mode Configuration)**: BOOT0 引脚的电平决定了 STM32 的启动模式。在此类应用中，BOOT0 引脚通常通过一个下拉电阻接地，以确保芯片每次上电后都从主闪存存储器（Main Flash memory）加载并执行程序。
*   **时钟源 (Clock Source)**: 该设计很可能使用 STM32 内部的高速 RC 振荡器 (HSI) 作为系统时钟源。这简化了外部电路，降低了成本，并且其精度对于本应用来说已经足够。原理图上不会出现外部晶体振荡器 (HSE) 的相关电路。
*   **调试接口 (Programming/Debug Interface)**: STM32 的串行线调试 (SWD) 接口，即 SWDIO (PA13) 和 SWCLK (PA14) 引脚，通常会以测试点（Test Pads）的形式引出。这些测试点用于在生产过程中烧录固件和在开发阶段进行在线调试。

#### 2. HX711 模拟前端与配置
*   **模拟输入滤波 (Analog Input Filtering)**: 在称重传感器的信号输出端 (A+, A-) 与 HX711 的输入端 (INA+, INA-) 之间，通常会串联小阻值电阻（如 100Ω）并并联小电容（如 1nF）到地。这组成了 RC 低通滤波器，用于滤除来自传感器信号线上的高频噪声和电磁干扰 (EMI)，保护 ADC 输入并提高测量精度。
*   **参考电压与比例测量 (Ratiometric Measurement)**: HX711 的一个关键设计是比例测量。其称重传感器的激励电压 (E+) 通常直接由其模拟电源 AVDD 提供。这意味着 ADC 的参考电压与传感器的激励电压同源。当电源电压波动时，传感器输出的绝对电压和 ADC 的参考电压会按相同比例变化，其比值保持不变，从而消除了电源波动对测量结果的影响，大大提高了测量的稳定性和准确性。
*   **数据输出速率选择 (Data Rate Selection)**: HX711 的 RATE 引脚用于选择输出数据速率。通过将其接至 GND 或 AVDD，可以选择 10Hz 或 80Hz 的数据更新率。对于静态或慢速变化的称重应用，该引脚通常接地，选择 10Hz 的速率以获得更好的噪声抑制和稳定性。

#### 3. 电源保护与滤波
*   **精细化滤波 (Detailed Filtering)**: 除了为每个芯片提供 100nF 的高频去耦电容外，在 3.3V LDO 的输入和输出端通常还会放置较大容量的电解电容或钽电容（如 10µF），用作储能和低频滤波，确保电源轨的平稳。
*   **ESD 保护**: 在直接对外的 HY2.0-4P 接口的信号线（SDA, SCL）和电源线（5V）上，可能部署了静电放电（ESD）保护二极管阵列，以防止静电损坏内部敏感芯片。

---

*该文档由 AI 自动生成，生成时间: 2025-11-18 02:48:48*
