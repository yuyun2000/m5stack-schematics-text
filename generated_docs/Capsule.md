# Capsule 原理图描述

---

## 原理图分析

好的，以下是根据 M5Stack Capsule (SKU: K129) 原理图生成的结构化技术描述。

---

### **1. 主控单元 (MCU)**

核心控制器为 M5Stack Stamp-S3 模块，其主控芯片为乐鑫 (Espressif) 的 ESP32-S3FN8。该芯片内置 8MB Flash，负责整个系统的逻辑控制、数据处理和外设驱动。

### **2. 电源管理 (Power Management)**

#### **2.1. 供电输入**

*   **USB 5V 输入 (5V_IN):** 通过板载 USB Type-C 接口输入 5V 直流电源，用于系统供电和电池充电。
*   **电池输入 (VBAT_IN):** 通过 2-Pin 1.25mm 间距连接器接入内部 3.7V 锂电池 (250mAh)，为系统提供移动供电。

#### **2.2. 电池充电电路**

系统集成了一颗电源管理芯片（未标型号），负责锂电池充电管理。该芯片接收来自 `5V_IN` 的电源，为 `VBAT_IN` 连接的电池充电。充电状态通过两个 LED 指示灯显示，分别连接到该芯片的 `CHG` 和 `DONE` 引脚。

#### **2.3. 电源输出**

*   **3.3V 电源:** 系统主电源。由一颗 SY8089I SOT23-5 封装的 LDO（低压差线性稳压器）芯片 U2 生成。该 LDO 的输入端连接 `VBAT`，输出稳定的 3.3V 电压，为 ESP32-S3 主控及大部分外设（如 BMI270, BM8563, SPM1423, microSD 卡）供电。
*   **5V 电源 (5V_OUT):** `5V_OUT` 与 `5V_IN` 直接相连，用于向外部 Grove 接口等需要 5V 的外设供电。

#### **2.4. 电源保持与开关机逻辑**

*   **HOLD 引脚:** ESP32-S3 的 **G46** 引脚被定义为 `HOLD` 信号。该引脚通过一个电阻连接到 3.3V LDO (U2) 的 `EN` (使能) 引脚。
*   **开机:** 按下 `WAKE` 按钮，将 LDO 的 `EN` 引脚拉高，3.3V LDO 开始工作，系统上电。ESP32-S3 启动后，需立即将 **G46** 引脚设置为高电平输出，以维持 LDO 的 `EN` 引脚为高电平，实现电源自锁。
*   **关机:** ESP32-S3 将 **G46** 引脚设置为低电平或高阻态，LDO 的 `EN` 引脚变为低电平，3.3V 电源被切断，系统实现软件关机。

### **3. 外设电路 (Peripheral Circuits)**

#### **3.1. 六轴姿态传感器 (6-Axis IMU)**

*   **芯片:** Bosch BMI270。
*   **通信接口:** I2C 总线。芯片的 `SDI` 引脚连接到主控的 `G8` (SDA)，`SCK` 引脚连接到 `G10` (SCL)。
*   **I2C 地址:** 芯片的 `SDO` 引脚通过一个 10kΩ 电阻上拉至 3.3V，设定其 I2C 地址为 **0x69**。
*   **电源:** `VDD` 和 `VDDIO` 引脚均连接到 3.3V 电源。

#### **3.2. 实时时钟 (RTC)**

*   **芯片:** NXP BM8563。
*   **通信接口:** I2C 总线。芯片的 `SDA` 引脚连接到主控的 `G8` (SDA)，`SCL` 引脚连接到 `G10` (SCL)。
*   **I2C 地址:** 固定为 **0x51**。
*   **唤醒功能:** 芯片的 `INT` (中断) 引脚连接到主控的 **G4** 引脚，用于实现 RTC 定时唤醒或闹钟中断功能。
*   **电源:** `VDD` 引脚连接到 3.3V 电源。

#### **3.3. MEMS 麦克风 (MEMS Microphone)**

*   **芯片:** Knowles SPM1423。
*   **通信接口:** 数字 PDM (Pulse Density Modulation) 接口。芯片的 `DAT` 引脚连接到主控的 **G41**，`CLK` 引脚连接到主控的 **G40**。
*   **电源:** `VDD` 引脚连接到 3.3V 电源。

#### **3.4. 红外发射电路 (Infrared Emitter Circuit)**

*   **驱动方式:** ESP32-S3 的 **G6** 引脚 (`IR_TX`) 控制一个 NPN 型三极管 S8050 (Q1)。
*   **电路工作:** 当 `G6` 输出高电平时，三极管 Q1 导通，电流从 3.3V 电源流经红外发射管 D1，发射红外信号。一个串联电阻 R8 用于限制电流。

#### **3.5. 蜂鸣器电路 (Buzzer Circuit)**

*   **驱动方式:** ESP32-S3 的 **G2** 引脚控制一个 NPN 型三极管 S8050 (Q2)。
*   **电路工作:** 当 `G2` 输出高电平时，三极管 Q2 导通，为无源蜂鸣器 BZ1 提供通路，使其发声。一个续流二极管 D2 并联在蜂鸣器两端，用于吸收蜂鸣器线圈在关闭时产生的反向电动势。

### **4. 存储单元 (Storage Unit)**

*   **接口类型:** microSD 卡插槽。
*   **通信协议:** SPI 总线。
*   **引脚连接:**
    *   `CS` (片选): 连接到 ESP32-S3 的 **G11**。
    *   `DI` (MOSI): 连接到 ESP32-S3 的 **G12**。
    *   `CLK` (时钟): 连接到 ESP32-S3 的 **G14**。
    *   `DO` (MISO): 连接到 ESP32-S3 的 **G39**。
*   **电源:** microSD 卡插槽的 VDD 引脚连接到 3.3V 电源。

### **5. 用户接口 (User Interface)**

*   **WAKE 按钮 (BTN_WAKE):**
    *   一端连接到 3.3V LDO (U2) 的 `EN` 引脚，用于物理按键开机。
    *   另一端连接到 ESP32-S3 的 **G42** 引脚，并上拉至 3.3V，允许主控在开机后检测此按键状态。
*   **RESET 按钮 (BTN_RST):**
    *   直接连接到 ESP32-S3 模块的 `RST` (EN) 引脚。按下后将该引脚拉低，实现硬件复位。

### **6. 扩展接口 (Expansion Interfaces)**

#### **6.1. Grove 接口**

*   **连接器类型:** HY2.0-4P。
*   **引脚定义:**
    *   Pin 1: GND
    *   Pin 2: 5V
    *   Pin 3: ESP32-S3 **G13**
    *   Pin 4: ESP32-S3 **G15**

#### **6.2. Proto 排母**

提供了一组 2.54mm 间距的排母，引出了 ESP32-S3 的部分 GPIO 和电源引脚，具体映射如下：
*   G40, G41, G39, G14, G12, G11 (已被麦克风和 microSD 使用)
*   G13, G15 (与 Grove 接口共用)
*   G5, G7, G4, G6, G2 (部分已被外设使用)
*   3V3, 5V, GND

### **7. 通信总线 (Communication Buses)**

*   **I2C 总线:**
    *   SDA: **G8**
    *   SCL: **G10**
    *   挂载设备: BMI270 (地址 0x69), BM8563 (地址 0x51)。总线上有 4.7kΩ 上拉电阻。
*   **SPI 总线:**
    *   CS: **G11**
    *   MOSI: **G12**
    *   CLK: **G14**
    *   MISO: **G39**
    *   挂载设备: microSD 卡插槽。

---

## 补充信息

是的，可以补充以下几点以使描述更加完整和精确：

### **8. 电源滤波与去耦 (Power Filtering and Decoupling)**

*   **3.3V 电源轨:** 在 3.3V 电源网络上，分布了多个不同容值的电容（如 10μF, 1μF, 0.1μF）。这些电容被放置在各个主要芯片（如 ESP32-S3, BMI270, BM8563）的电源引脚附近，作为去耦电容。它们的作用是滤除电源噪声，为芯片提供稳定、纯净的供电，确保其可靠运行。
*   **5V 电源轨:** 同样的，在 `5V_IN` 和 `5V_OUT` 路径上也配置了电容，用于稳定输入电压和为外部设备提供稳定的 5V 电源。

### **9. I/O 资源分配总结 (I/O Resource Allocation Summary)**

*   **专用内部外设引脚:**
    *   **G2:** 蜂鸣器控制
    *   **G4:** RTC (BM8563) 中断/唤醒
    *   **G6:** 红外发射器控制
    *   **G40, G41:** 数字麦克风 (SPM1423)
    *   **G42:** WAKE 按键输入
    *   **G46:** 电源保持 (`HOLD`)
*   **共享总线引脚:**
    *   **G8 (SDA), G10 (SCL):** I2C 总线，连接 BMI270 和 BM8563。
    *   **G11(CS), G12(MOSI), G14(CLK), G39(MISO):** SPI 总线，连接 microSD 卡插槽。
*   **外部扩展引脚:**
    *   **G13, G15:** 分配给 Grove 接口，也可通过 Proto 排母访问。
    *   **G5, G7:** 仅通过 Proto 排母引出，可作为通用 GPIO 使用。

### **10. 物理结构与固定 (Physical Structure and Mounting)**

*   **磁吸固定:** 设备底部集成了一块磁铁，用于方便地吸附在铁质表面。此磁铁无电气连接。
*   **M3 螺丝孔:** 设备上预留了 M3 规格的螺丝孔，用于机械固定。这些孔位同样无电气连接。

这些补充信息进一步阐明了电路设计的细节、引脚的使用情况以及产品的物理特性，有助于更全面地理解该设备的设计。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 20:48:07*
