# Unit AC Measure 原理图描述

---

## 原理图分析

好的，遵照您的要求，以下是关于 Unit AC Measure 原理图的技术性描述。

### **Unit AC Measure 原理图描述**

#### **1. 主要芯片及其功能**
*   **微控制器 (MCU):** STM32G030F6P6。作为单元的主控制器，位于电气隔离的“冷区”。其主要功能是：
    *   接收并处理来自交流测量芯片的隔离信号。
    *   通过内部算法计算出交流电压、电流和有功功率的有效值。
    *   作为 I2C 从设备，通过 Grove 接口与外部主控进行通信，I2C 地址为 0x42。
*   **交流测量芯片:** HLW8032。作为单元的测量核心，位于电气隔离的“热区”。其主要功能是：
    *   采集交流电路中的电压和电流模拟信号。
    *   将采集到的信号转换为数字脉冲信号，其中 CF 引脚输出与有功功率成正比的脉冲频率，CF1 引脚输出与电流或电压有效值成正比的脉冲频率。
*   **隔离 DC-DC 电源模块:** B0505ST16-W5。为“热区”电路提供隔离电源。
*   **光电耦合器:** EL357NB。用于在“热区”与“冷区”之间传输数字信号，实现电气隔离。

#### **2. 电路设计思想**
该单元采用“热区/冷区”隔离设计，确保用户侧接口（冷区）与高压交流电侧（热区）之间的电气安全。HLW8032 负责高压信号的直接采集与初步处理，STM32G030F6P6 负责后续的数据计算与通信。通过隔离电源和光耦，将高压风险完全隔离在热区内部。

#### **3. 供电与充电电路**
*   **冷区供电:** 单元通过 HY2.0-4P (Grove) 接口从外部获取 5V 电源。该 5V 电压首先经过一个 ME6211 系列的 LDO（低压差线性稳压器）降压至 3.3V，为微控制器 STM32G030F6P6 及其外围电路（如 I2C 上拉电阻）供电。
*   **热区供电:** 来自 Grove 接口的 5V 电源同时输入到 B0505ST16-W5 隔离 DC-DC 模块。该模块输出一组与输入侧完全电气隔离的 5V 隔离电源 (5V_ISO) 和隔离地 (GND_ISO)。
*   **热区稳压:** 5V_ISO 电源再经过一个 ME6211 系列的 LDO 降压至 3.3V_ISO，为热区的 HLW8032 芯片和光耦的输入侧（发光二极管）供电。

#### **4. 信号路径**
*   **电压采样路径:** 交流火线 (L) 经由一个由多个兆欧级电阻串联组成的高阻抗分压网络（R3-R8），将 100-240V 的交流电压分压至毫伏级别，然后送入 HLW8032 的电压采样引脚 V1P。交流零线 (N) 连接到 V1N 引脚作为参考。
*   **电流采样路径:** 交流火线 (L) 串联一个毫欧级的锰铜合金采样电阻 (R1)。电流流过该电阻时产生的压降被 HLW8032 的电流采样引脚 IP 和 IN 采集。
*   **数据信号路径:** HLW8032 将测量结果转换为脉冲信号，从 CF 和 CF1 引脚输出。这两个信号分别驱动两个 EL357NB 光电耦合器（U4, U5）的输入端。光耦的输出端（光电晶体管）连接到 STM32G030F6P6 的 GPIO 引脚（PA1, PA0）。STM32 通过对单位时间内接收到的脉冲数量进行计数，来计算功率和电流/电压值。
*   **通信路径:** STM32G030F6P6 处理完数据后，通过其 I2C 接口（SDA @ PA10, SCL @ PA9）将数据提供给外部设备。该 I2C 总线连接到 HY2.0-4P Grove 接口。

#### **5. 外设模块与接口**
*   **交流输入/输出接口:** 一个 3.96mm 间距的 4P 接线端子，定义为 L_IN, N_IN, L_OUT, N_OUT。L_IN 和 N_IN 为交流电源输入，L_OUT 和 N_OUT 连接到负载。电流采样电阻串联在 L_IN 和 L_OUT 之间。
*   **通信接口:** 一个 HY2.0-4P Grove 接口，引脚定义为 GND, 5V, SDA, SCL。用于供电和 I2C 通信。

#### **6. 逻辑电路与电平转换**
*   HLW8032 输出的 3.3V_ISO 电平的脉冲信号，通过光耦转换为 STM32G030F6P6 可以识别的 3.3V 电平信号。光耦在此不仅起到电平传递的作用，更关键的是实现了信号的电气隔离。
*   STM32G030F6P6 的 I2C 总线（SDA, SCL）通过两个上拉电阻 (R11, R12) 上拉至 3.3V，确保 I2C 通信的电平稳定。

#### **7. 电源管理与保护电路**
*   **过流保护:** 在交流火线输入端 (L_IN) 串联一个保险丝 (F1)，用于在发生严重过流时熔断，保护后级电路。
*   **过压保护:** 在保险丝之后，火线与零线之间并联一个压敏电阻 (MOV1)，用于吸收电网中的瞬态浪涌电压，防止高压损坏电路。
*   **隔离设计:** PCB 布局上，“热区”与“冷区”之间有明显的物理隔离带（Creepage Distance），隔离带上没有任何布线，以满足安规要求。B0505ST16-W5 隔离电源和 EL357NB 光耦是实现电气隔离的核心元件。

#### **8. 电路之间的连接关系**
*   **热区内部:** 交流输入端子通过保护电路连接到电压采样分压网络和电流采样电阻。HLW8032 分别从这两个采样点获取信号，并由 3.3V_ISO 供电。其输出的脉冲信号连接到光耦的输入端。
*   **冷区内部:** STM32G030F6P6 由 3.3V 供电，其 GPIO 引脚连接到光耦的输出端，I2C 引脚连接到 Grove 接口。
*   **热区与冷区连接:** 唯一的连接是通过 B0505ST16-W5 隔离电源模块的变压器磁耦合和 EL357NB 光耦的光耦合实现的，不存在任何直接的电气连接。

---

## 补充信息

好的，基于对同类产品通用电路设计的分析，以下是对原理图可能包含的、但前述描述未详尽提及的技术细节的补充：

### **补充描述**

#### **1. 微控制器（MCU）外围电路**
*   **复位电路:** STM32G030F6P6 的 NRST 引脚通常会连接一个由上拉电阻和下拉电容组成的 RC 网络。此电路确保了在上电时提供一个可靠的复位信号，并在需要时提供手动复位或外部复位的能力。
*   **调试接口:** 为了进行固件烧录和在线调试，STM32 的 SWD (Serial Wire Debug) 接口引脚，即 SWDIO 和 SWCLK，通常会引出到板上的测试点（Test Pads）或一个专用的排针接口。
*   **时钟源:** 该设计很可能依赖 STM32G030F6P6 内置的高速内部振荡器 (HSI) 作为系统主时钟。对于脉冲计数和 I2C 通信这类应用，内部振荡器的精度通常已经足够，无需外部晶体振荡器 (HSE)，从而简化了电路并降低了成本。

#### **2. 交流测量前端细节**
*   **HLW8032 模式选择:** HLW8032 芯片的 SEL 引脚用于选择 CF1 脉冲输出代表的是电流有效值还是电压有效值。在原理图中，该引脚会被固定连接到 GND_ISO 或 3.3V_ISO。例如，若接地，则 CF1 输出电流有效值对应的脉冲；若接高电平，则输出电压有效值对应的脉冲。STM32 固件会根据这一硬件配置来解析 CF1 信号。
*   **输入信号滤波:** 在 HLW8032 的电压采样输入引脚 (V1P) 和电流采样输入引脚 (IP, IN) 处，通常会设计有简单的 RC 低通滤波器。这些滤波器用于滤除输入信号中的高频噪声，以提高测量精度和稳定性。

#### **3. 电源滤波与去耦**
*   **去耦电容:** 在每个集成电路（IC），包括 STM32G030F6P6、HLW8032 和两个 LDO 的电源引脚附近，都会放置一个或多个去耦电容（通常为 100nF 的陶瓷电容）。这些电容的作用是滤除电源线上的高频噪声，为芯片提供稳定、纯净的电源。
*   **大容量滤波电容:** 在各 LDO 的输入和输出端，以及 B0505ST16-W5 隔离电源的输出端，通常会放置较大容量的电解电容或钽电容（例如 10uF 或更高）。这些电容作为储能元件，用于稳定电压、抑制低频纹波和应对电路的瞬时电流需求。

#### **4. 状态指示**
*   **电源指示灯:** 在“冷区”的 3.3V 电源轨上，通常会连接一个由限流电阻和 LED 组成的电源指示灯电路。当单元通过 Grove 接口上电后，该 LED 会点亮，直观地显示单元已正常供电。

---

*该文档由 AI 自动生成，生成时间: 2025-11-18 00:00:47*
