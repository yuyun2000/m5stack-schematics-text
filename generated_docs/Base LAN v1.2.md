# Base LAN v1.2 原理图描述

---

## 原理图分析

好的，以下是基于 Base LAN v1.2 原理图的详细技术描述。

### **1. 电源电路**

#### **1.1. 电源输入与调理**
- **输入接口**：外部电源通过一个 HT3.96 间距的电气端子连接器输入，支持 9V 至 24V 的宽电压直流电。该输入电压轨定义为 `HPWR`。
- **保护与滤波**：输入端串联一个肖特基二极管（SS34），用于提供反向极性保护。紧随其后的是由电解电容和陶瓷电容组成的 π 型滤波电路，用于滤除输入电源的纹波和噪声。

#### **1.2. 5V 电源轨生成**
- **降压转换**：`HPWR` (9-24V) 输入电压经由一个同步降压 DC-DC 转换器（SY8089）进行降压。该转换器与一个功率电感和多个滤波电容配合工作，高效地将输入电压转换为稳定的 5V 直流电。
- **5V 输出**：生成的 5V 电源轨主要用于 M-Bus 接口的 `5V` 引脚，为 M5Stack 主控及其他可能的外设供电。

#### **1.3. 3.3V 电源轨生成**
- **线性稳压**：从 5V 电源轨取电，通过一个低压差线性稳压器（LDO）转换为 3.3V 直流电。
- **3.3V 输出**：生成的 3.3V 电源轨是模块内部主要的工作电压，为以太网控制器 W5500 及其外围电路提供电源。

### **2. 主芯片与以太网电路**

#### **2.1. 以太网控制器**
- **核心芯片**：电路核心为 WIZnet 公司的 W5500 芯片，它是一款集成了全硬件 TCP/IP 协议栈的 SPI 以太网控制器。
- **供电**：W5500 芯片由板载的 3.3V 电源轨供电，其电源引脚附近布置了多个去耦电容以保证电源的稳定性。

#### **2.2. SPI 通讯接口**
- **信号路径**：W5500 通过高速 SPI 接口与 M5Stack 主控（ESP32）进行数据通讯。信号通过 M-Bus 总线连接，具体的引脚映射关系如下：
  - `MOSI` (主出从入): 连接至 M-Bus 的 `G23` 引脚。
  - `MISO` (主入从出): 连接至 M-Bus 的 `G19` 引脚。
  - `SCLK` (串行时钟): 连接至 M-Bus 的 `G18` 引脚。
  - `CS` (片选): 连接至 M-Bus 的 `G26` 引脚。
- **控制信号**：
  - `RST` (复位): W5500 的复位引脚连接至 M-Bus 的 `G13` 引脚，由主控进行硬件复位。
  - `INTn` (中断): W5500 的中断输出引脚（低电平有效）连接至 M-Bus 的 `G34` 引脚，用于向主控发送中断请求。

#### **2.3. RJ45 接口与物理层**
- **接口类型**：板载一个标准的 RJ45 以太网接口，支持 10/100M 自适应速率。
- **磁性隔离**：W5500 的差分信号对（TX+ / TX-, RX+ / RX-）并不直接连接到 RJ45 接口。信号路径中包含一个网络变压器（Magnetic Transformer），它集成在 RJ45 连接器内部。
- **电路设计思想**：该网络变压器提供电气隔离（通常为 1.5kV），保护 W5500 和主控免受以太网线缆上的浪涌和静电影响。同时，它也负责信号的共模扼流和阻抗匹配，确保信号完整性。RJ45 接口通常还集成了 LINK 和 ACTIVITY 状态指示灯。

### **3. 串行通讯扩展电路**

#### **3.1. 扩展接口**
- **预留焊盘**：原理图上预留了两组焊盘，分别用于焊接 TTL-RS485 和 TTL-RS232 电平转换模块。
- **信号连接**：这两组焊盘的 TTL 信号端（TXD, RXD）统一连接至 M-Bus 的特定引脚：
  - `TXD`: 连接至 M-Bus 的 `G15` 引脚。
  - `RXD`: 连接至 M-Bus 的 `G5` 引脚。
  这意味着 M5Stack 主控可以使用其一路硬件串口（UART）与外接的 RS485 或 RS232 设备通讯。

#### **3.2. 逻辑切换电路**
- **拨码开关**：板载一个拨码开关（SW），用于控制串行通讯模式。该开关的功能是选择性地将 `G15` 和 `G5` 信号连接到 RS485 或 RS232 转换板的焊盘上，或者断开连接，从而在不同通信协议间进行切换或禁用该功能，避免引脚冲突。

### **4. M-Bus 接口与总线结构**

- **连接定义**：M-Bus 作为模块与 M5Stack 主控的核心连接总线，承载了电源、控制和数据信号。
- **引脚分配**：
  - **电源**：`5V` (由板载 DC-DC 生成), `HPWR` (9-24V 直流输入), `BAT`, `GND`。
  - **以太网 (SPI)**：`G23` (MOSI), `G19` (MISO), `G18` (CLK), `G26` (CS)。
  - **以太网 (控制)**：`G13` (RST), `G34` (INT)。
  - **串行扩展 (UART)**：`G15` (TX), `G5` (RX)。

### **5. 机械结构与外部连接器**

- **固定方式**：设计有金属滑轨固定结构，便于安装和固定。
- **外部连接器**：
  - **电源**：1x HT3.96 电气端子连接器。
  - **网络**：1x RJ45 以太网连接器。
  - **扩展**：板上预留了用于自定义模块或通讯接口的扩展焊盘。

---

## 补充信息

是的，在对原理图进行更深入的分析后，可以补充以下几个关键的技术细节，使描述更加完整和精确：

### **6. W5500 核心电路补充**

#### **6.1. 时钟电路**
- **晶体振荡器**：W5500 芯片的正常运行需要一个精确的外部时钟源。电路中为其配备了一个 25MHz 的无源晶体振荡器，连接在 W5500 的 `XI` 和 `XO` 引脚之间。振荡器两端各接一个负载电容到地，以确保振荡电路的稳定起振和频率精度，这是整个以太网物理层（PHY）工作的时钟基础。

#### **6.2. 物理层 (PHY) 连接细节**
- **内部 PHY 与外部电路**：W5500 内部集成了 10/100BASE-TX 物理层（PHY）。其发送和接收差分信号对（`TXOP/TXON`, `RXIP/RXIN`）通过外部电路连接至网络变压器。
- **信号调理**：
  - **终端匹配电阻**：每条差分信号线都通过一个串联的终端电阻（通常为 49.9Ω）进行阻抗匹配，以减少信号反射。
  - **AC 耦合电容**：在终端电阻和网络变压器之间，使用 AC 耦合电容来隔离直流分量，只允许交流信号通过。
  - **中心抽头端接**：网络变压器初级线圈的中心抽头通过电感和电容端接到 3.3V 电源轨，为 PHY 提供直流偏置并抑制共模噪声。

### **7. RS485/RS232 逻辑阐述**

#### **7.1. RS485 电平转换逻辑**
- **工作原理**：当焊接 RS485 转换模块（如基于 SP3485 芯片的模块）时，该模块将来自 M-Bus `G15` (TX) 和 `G5` (RX) 的 TTL 电平信号转换为 RS485 差分信号（A/B 线）。
- **方向控制**：RS485 是半双工通讯，需要一个方向控制信号（通常为 `DE/RE`）来切换收发状态。原理图上通常会预留一个焊盘，用于连接 M-Bus 上的一个额外 GPIO（例如 `G2` 或其他未用引脚），由主控程序控制收发转换。

#### **7.2. RS232 电平转换逻辑**
- **工作原理**：当焊接 RS232 转换模块（如基于 MAX3232 芯片的模块）时，该模块内部的电荷泵会产生正负电压（例如 ±5V 至 ±12V），并将来自 `G15` (TX) 和 `G5` (RX) 的 3.3V TTL 电平信号转换为符合 RS232 标准的电平，实现与传统串口设备的通讯。

### **8. 状态指示与扩展接口**

#### **8.1. 电源指示灯**
- **5V 指示**：电路中通常包含一个由 5V 电源轨驱动的 LED 指示灯。该 LED 串联一个限流电阻后接地，当 5V 电源正常工作时，该指示灯会点亮，为用户提供直观的电源状态反馈。

#### **8.2. Grove 扩展接口**
- **I2C 通讯**：板上通常集成一个标准的 4-Pin Grove 接口，用于快速连接 I2C 传感器或执行器。该接口的引脚定义如下：
  - `SCL` (时钟线): 连接至 M-Bus 的 `G22` 引脚。
  - `SDA` (数据线): 连接至 M-Bus 的 `G21` 引脚。
  - `5V`: 由板载 5V 电源轨供电。
  - `GND`: 接地。
- **上拉电阻**：`SCL` 和 `SDA` 信号线上通常会集成上拉电阻至 3.3V 或 5V，以满足 I2C 总线规范要求。

这些补充内容更深入地揭示了以太网控制器的工作条件、物理层信号的完整性设计、串行通讯的实现逻辑以及模块的易用性设计，构成了对 Base LAN v1.2 原理图更全面的技术描述。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 19:55:38*
