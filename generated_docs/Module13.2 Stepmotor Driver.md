# Module13.2 Stepmotor Driver 原理图描述

---

## 原理图分析

### Module13.2 Stepmotor Driver 原理图描述

#### 1. 主要芯片及其功能

*   **HR8825 (3颗):** 核心步进电机驱动芯片。每颗芯片负责驱动一个双极步进电机，提供最大1.5A的驱动电流。芯片内部集成了驱动逻辑和功率MOSFET。
*   **TCA9554:** I2C接口的8位I/O扩展芯片，I2C地址为0x27。用于扩展主控的GPIO资源，集中控制三路电机驱动器的公共信号，如使能（EN）和细分模式（M0/M1/M2）。

#### 2. 电路设计思想

该模块设计为一套紧凑的三轴步进电机驱动系统。主控通过M5-Bus接口，为三路驱动器（X、Y、Z轴）提供独立的STEP（步进）和DIR（方向）信号，实现对每个轴的独立运动控制。为了节省主控的GPIO引脚并实现同步控制，所有驱动器共享的控制信号——驱动使能（DRV_EN）和细分模式选择（M0/M1/M2）——通过一个I2C I/O扩展器（TCA9554）进行统一管理。模块集成了宽电压输入的DC-DC电源电路，可将外部9-24V的电机电源转换为5V的系统逻辑电源，并通过RS485接口支持远程通讯和控制。

#### 3. 供电与充电电路

*   **电源输入:** 模块支持两种9-24V直流电源输入方式：
    1.  通过一个DC-JACK接口输入。
    2.  通过PWR485接口（3.96-4P端子）的VIN和GND引脚输入。
    这两种输入源在内部并联，共同为`HPWR`（9-24V）总线供电。
*   **DC-DC转换电路:** `HPWR`总线上的9-24V电压首先直接供给三颗HR8825芯片的`VMOT`引脚，作为电机驱动的功率电源。同时，该电压也输入到一个板载的DC-DC降压转换电路，该电路将9-24V电压高效地转换为稳定的5V电压。
*   **电源分配:**
    *   **5V:** 由DC-DC电路产生的5V电源，为TCA9554、RS485通讯芯片以及三颗HR8825的逻辑部分（`VDD`引脚）供电。此5V电源也通过M5-Bus接口提供给主控或其它模块。
    *   **3.3V:** 模块从M5-Bus获取3.3V电源，主要用于I2C总线的上拉电阻。
    *   **HPWR (9-24V):** 直接作为三路步进电机驱动器的动力源。

#### 4. 步进电机驱动电路

模块包含三路完全相同的步进电机驱动电路，分别对应X、Y、Z轴。以X轴为例：
*   **驱动核心:** 一颗HR8825芯片。
*   **控制信号:** `STEP_X`和`DIR_X`信号由M5-Bus直接连接到HR8825的`STEP`和`DIR`引脚。
*   **公共控制:** `nENBL`（使能，低电平有效）、`M0`、`M1`、`M2`（细分设置）引脚与另外两颗HR8825的对应引脚并联，由TCA9554统一控制。
*   **电流调节:** 每颗HR8825的`VREF`引脚连接一个可调电位器。通过调节此电位器，可以独立设置该路电机驱动的最大输出电流。
*   **电机输出:** HR8825的`AOUT1`、`AOUT2`、`BOUT1`、`BOUT2`引脚连接到一个2.54mm间距的4P端子，用于连接双极步进电机的一组线圈（A+, A-）和另一组线圈（B+, B-）。

#### 5. I/O扩展与控制逻辑 (TCA9554)

*   **I2C通讯:** TCA9554的`SCL`和`SDA`引脚连接至M5-Bus的`SCL`和`SDA`总线，与主控进行I2C通讯。
*   **引脚功能分配:**
    *   **P0 - P3:** 配置为输入模式，连接到外部的输入信号端子（2.54-2P），可用于连接限位开关等外部信号。
    *   **P4:** 配置为输出模式，连接到名为`DRV_EN`的信号线。该信号线并联到三颗HR8825的`nENBL`引脚，用于同步使能或禁用所有电机驱动器。
    *   **P5 - P7:** 配置为输出模式，分别连接到`M2`、`M1`、`M0`信号线。这三条信号线并联到三颗HR8825的`M2`、`M1`、`M0`引脚，用于同步设置所有电机的细分模式（最高1/32步）。

#### 6. 串口与通讯芯片

*   **RS485通讯:**
    *   模块集成了一颗RS485收发芯片。
    *   收发芯片的`DI`（数据输入）引脚连接到M5-Bus的`RS485_TX`。
    *   收发芯片的`RO`（数据输出）引脚连接到M5-Bus的`RS485_RX`。
    *   差分信号`A`和`B`连接到PWR485接口（3.96-4P）的相应引脚上，用于实现长距离、抗干扰的串行通讯。

#### 7. 信号路径与电路连接关系

*   **主控到驱动器:** 主控通过M5-Bus发送独立的`STEP_X/Y/Z`和`DIR_X/Y/Z`信号，直接控制每颗HR8825的步进和方向。
*   **I2C控制路径:** 主控通过M5-Bus的I2C总线（SDA/SCL）与TCA9554通讯。TCA9554再通过其P4-P7引脚输出`DRV_EN`、`M0`、`M1`、`M2`信号，这些信号以广播方式并联至所有三颗HR8825，实现全局控制。
*   **步进信号连接:** 三颗HR8825的`STEP`引脚分别连接到M5-Bus的`STEP_X`、`STEP_Y`、`STEP_Z`，彼此独立，不存在级联或串联关系。

#### 8. 外部接口与端子

*   **M5-Bus:** 连接M5Stack主控的核心接口，传输所有控制信号、通讯信号及部分电源。
*   **DC-JACK:** 9-24V电源输入接口。
*   **PWR485接口 (3.96-4P):** 复合功能接口，提供RS485通讯（A, B引脚）和9-24V电源输入（VIN, GND引脚）。
*   **电机输出端子 (3组, 2.54-4P):** 分别用于连接X、Y、Z三轴的步进电机。
*   **输入信号端子 (2.54-2P):** 连接至TCA9554的P0-P3引脚，用作通用数字输入。

---

## 补充信息

好的，基于已提供的信息，以下是对原理图描述的补充细节：

### 9. 电路设计细节补充

*   **HR8825 驱动器细节:**
    *   **电流检测:** 每颗 HR8825 芯片都配有两个低阻值（通常为毫欧级别）的电流检测电阻，分别连接在 `SENSEA`/`SENSEB` 引脚和地之间。芯片通过检测这些电阻上的电压降，来实时监控并调节流经电机线圈的电流，实现恒流斩波驱动。
    *   **控制引脚处理:** 除了由 TCA9554 控制的引脚外，每颗 HR8825 的 `nSLEEP` 引脚被上拉至 5V 逻辑电源，确保驱动器在模块上电后默认处于唤醒状态。`nFAULT` 引脚是故障状态输出（开漏），在本设计中未连接至主控，表明模块不向主控主动报告硬件故障。

*   **电源去耦与滤波:**
    *   在 `HPWR` (9-24V) 电源输入端，通常会并联一个大容量的电解电容，用于稳定电机驱动电源，吸收电机启动和换向时产生的大电流冲击。
    *   在每颗 HR8825 的 `VMOT` (电机电源) 和 `VDD` (逻辑电源) 引脚附近，以及 TCA9554 和 RS485 芯片的电源引脚附近，均配置了陶瓷去耦电容（如 0.1uF），用于滤除高频噪声，保证芯片的稳定工作。

*   **I2C 总线配置:**
    *   连接到 M5-Bus 的 `SCL` 和 `SDA` 信号线，在模块内部通过上拉电阻连接到 3.3V 电源。这为 I2C 总线提供了必要的上拉，确保了主控与 TCA9554 之间的通讯稳定。

*   **输入信号接口:**
    *   连接至 TCA9554 (P0-P3) 的四个输入端子，其内部电路通常包含上拉或下拉电阻，为输入引脚提供一个默认的逻辑电平。这使得在未连接外部信号（如限位开关）时，引脚状态是确定的，防止了误触发。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 23:40:09*
