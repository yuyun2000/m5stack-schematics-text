# Atom Socket 原理图描述

---

## 原理图分析

好的，这是根据您提供的原理图信息生成的 M5Stack Atom Socket 技术描述。

***

### M5Stack Atom Socket 原理图描述

#### 1. 主要芯片及其功能
*   **HLW8032**: 一款单相电能计量 IC。该芯片负责实时测量交流电路的电压有效值、电流有效值、有功功率，并通过其内部计算得出视在功率和功率因数。测量结果通过串行接口（UART）输出。

#### 2. 电路整体设计思想
本电路设计为一个由 M5Stack ATOM 主控控制的智能电源插座。其核心功能是实现对交流电源负载的通断控制及电能计量。电路主要由三部分构成：
1.  **AC-DC 电源模块**：将输入的交流电转换为 5V 直流电，为整个系统（包括 ATOM 主控、继电器线圈、HLW8032 芯片）供电。
2.  **电能计量模块**：以 HLW8032 芯片为核心，通过电压采样和电流采样电路，精确测量负载的电气参数。
3.  **继电器控制模块**：接收来自 ATOM 主控的控制信号，通过驱动电路控制继电器的通断，从而接通或切断连接到插座上的负载电源。

#### 3. 供电与充电电路
*   **AC 输入**: 电路通过标准 PSE 接口（L-火线, N-零线, G-地线）接收 100~120V 交流电。
*   **DC 供电**: 内部集成的 AC-DC 转换电路（未在核心逻辑中标明具体型号）将输入的交流电转换为 +5V 的直流电，作为系统的主供电 VCC。
*   **电源分配**:
    *   +5V 电源直接供给 M5Stack ATOM 主控的 5V 输入引脚。
    *   +5V 电源为 HLW8032 芯片的 VCC 引脚供电，并通过一个电容进行滤波。
    *   +5V 电源作为继电器线圈的供电来源。
    *   +5V 电源通过 HY2.0-4P 接口对外输出。

#### 4. HLW8032 电能计量电路
*   **电流采样**: 在交流电的 N（零线）回路上，串联一个低阻值、高精度的锰铜采样电阻（Shunt Resistor）。负载电流流过该电阻时产生的微小压降被送入 HLW8032 的电流采样引脚 IP 和 IN。该压降与负载电流成正比。
*   **电压采样**: 交流电的 L（火线）通过一个由多个 Megaohm 级别电阻串联组成的高阻抗分压网络进行分压，将 100~120V 的高压降至 HLW8032 芯片可接受的毫伏级别。分压后的信号送入 HLW8032 的电压采样引脚 VP。
*   **芯片通讯**: HLW8032 的 TX 引脚（串行数据输出）连接到 ATOM 主控的 G22 引脚。数据以 4800bps 波特率、8位数据位、偶校验、1位停止位（8E1）的 UART 协议格式单向传输给主控。
*   **模式选择**: HLW8032 的 SEL 引脚通过一个电阻接地，用于设置芯片的数据输出模式（例如，决定输出数据包中包含电压、电流还是功率信息）。

#### 5. 继电器及驱动电路
*   **继电器**: 使用一个单刀单掷（SPST）继电器，其触点规格为 AC 100~120V@10A / DC 28V@10A。
*   **AC 路径**: 交流输入的 L（火线）连接到继电器的 COM（公共）端，继电器的 NO（常开）端连接到输出插座的 L 端。当继电器线圈通电时，COM 与 NO 闭合，负载得电。
*   **驱动电路**:
    *   ATOM 主控的 G23 引脚作为继电器控制信号输出。
    *   G23 的高低电平信号通过一个限流电阻驱动一个 NPN 型三极管的基极。
    *   该三极管作为开关，其发射极接地，集电极连接到继电器线圈的一端。线圈的另一端连接到 +5V 电源。
    *   当 G23 输出高电平时，三极管导通，继电器线圈获得电流并吸合。
    *   在继电器线圈两端并联一个反向二极管（Flyback Diode），用于在三极管截止、线圈断电时，吸收线圈产生的反向感应电动势，保护驱动三极管。

#### 6. M5Stack ATOM 主控接口与信号路径
*   **G22 (Input)**: 作为 UART 的 RX 端，接收来自 HLW8032 的电能计量数据。
*   **G23 (Output)**: 作为数字输出口，控制继电器驱动电路的开关状态，从而控制插座电源的通断。
*   **5V / GND**: 从板载的 +5V DC 电源和地获取工作电源。
*   **G39 (Button)**: ATOM 主控正面的物理按键，其状态信号通过 HY2.0-4P 接口的 BTN_OUT 引脚引出。

#### 7. 外部接口 (HY2.0-4P)
该接口提供了与外部设备交互的能力，引脚定义如下：
*   **Pin 1 (RELAY_IN)**: 继电器信号输入。此引脚与 ATOM 的 G23 控制路径相连（可能通过或门逻辑或直接并联到三极管基极），允许外部信号直接控制继电器的状态。
*   **Pin 2 (BTN_OUT)**: 按键信号输出。此引脚连接到 ATOM 主控板载按键（G39）的信号线上，可将 ATOM 的按键状态输出给外部设备使用。
*   **Pin 3 (GND)**: 系统地。
*   **Pin 4 (5V)**: 系统 +5V 电源输出。

#### 8. 电路之间的连接关系总结
*   **控制流**: ATOM (G23) -> 三极管驱动电路 -> 继电器线圈 -> 继电器触点 -> 交流负载。
*   **数据流**: 交流负载 -> 采样电阻/分压网络 -> HLW8032 -> UART (TX) -> ATOM (G22)。
*   **外部交互**: 外部设备可通过 HY2.0 接口的 `RELAY_IN` 引脚控制继电器，并通过 `BTN_OUT` 引脚监测 ATOM 的板载按键状态。

---

## 补充信息

好的，基于先前的描述，以下是一些从电路设计和安全角度出发的补充说明，这些细节在原理图中通常会体现。

***

### 补充说明

#### 1. 电源输入保护电路
*   **过流保护**: 在交流输入 L（火线）端，通常串联一个 **保险丝 (Fuse)**。其作用是在负载电流或内部电路发生短路导致电流异常增大时熔断，切断整个电路，以防止设备损坏和火灾风险。
*   **过压保护**: 在交流 L-N 输入端之间，通常并联一个 **压敏电阻 (MOV, Metal Oxide Varistor)**。当电网出现瞬时高压浪涌（如雷击感应）时，MOV 的电阻会瞬间变得极低，将浪涌电流导向大地或在 L-N 间形成通路，从而钳位电压，保护后级的 AC-DC 转换器和其他电子元件。

#### 2. 高低压隔离 (Galvanic Isolation)
*   **核心隔离**: 电路设计的关键在于高压交流部分与低压直流控制部分之间的电气隔离。这种隔离主要由两个元件实现：
    1.  **AC-DC 电源模块**: 该模块内部的变压器提供了主隔离屏障，将 100~120V 的交流电安全地转换为隔离的 5V 直流电。这确保了 M5Stack ATOM 主控、HLW8032 的数字部分以及 HY2.0 接口与危险的市电完全隔离。
    2.  **继电器 (Relay)**: 继电器通过电磁感应原理工作，其线圈（低压控制侧）与触点（高压负载侧）在物理上是完全隔离的。这使得低压信号可以安全地控制高压电路的通断。
*   **PCB 布局**: 在物理 PCB 设计上，高压区域和低压区域之间会有明显的物理间距（**爬电距离 Creepage** 和 **电气间隙 Clearance**），通常会通过开槽或丝印标记进行强化，以满足安全规范。

#### 3. 信号完整性与滤波
*   **去耦电容 (Decoupling Capacitors)**: 在原理图中，除了 HLW8032 的 VCC 引脚外，为 M5Stack ATOM 供电的 5V 输入端附近通常也会放置一个或多个去耦电容（例如一个 10uF 的电解电容和一个 0.1uF 的陶瓷电容）。它们的作用是滤除电源线上的高频噪声，并为芯片在高速开关时提供瞬时电流，保证系统稳定运行。

#### 4. 外部接口逻辑 уточнение
*   **RELAY_IN 的逻辑关系**: `RELAY_IN` 引脚与 ATOM 的 `G23` 引脚共同控制继电器。它们的逻辑关系通常是“或”（OR）。这意味着，只要 `G23` 为高电平 **或** `RELAY_IN` 上有外部输入的高电平信号，继电器就会吸合。这种设计允许通过主控程序或外部开关/传感器两种方式来触发插座通电。
*   **BTN_OUT 的特性**: `BTN_OUT` 引脚是对 ATOM 主控 G39 按键信号的直接引出，通常是一个无源输出。外部电路可以通过监测该引脚的电平变化（通常是高电平，按下时变为低电平）来同步获取 ATOM 主控按键的按压事件。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 19:34:33*
