# Module13.2 Dual Kmeter 原理图描述

---

## 原理图分析

### Module13.2 Dual Kmeter 原理图描述

#### 1. 主要芯片及其功能
*   **U1 (STM32F030F4P6):** 主控制器。这是一款基于 ARM Cortex-M0 内核的微控制器，负责处理来自 M5-Bus 的 I2C 通信指令，通过 SPI 协议读取 MAX31855 的温度数据，并控制继电器切换数据通路。
*   **U5, U6 (MAX31855KASA+T):** K 型热电偶-数字转换器。每个芯片负责将一路 K 型热电偶的模拟电压信号转换为包含冷端补偿的数字温度值。
*   **U7 (CA-IS3020S):** 四通道数字信号隔离器。用于实现主控 STM32（冷端）与 MAX31855（热端）之间 SPI 信号的电气隔离。
*   **U8 (B0505LS-1WR2):** 隔离电源模块。提供 5V 输入到 5V 输出的电气隔离电源，为测量侧（热端）电路独立供电。
*   **U2 (ME3116AM6G):** DC-DC 降压转换器。将来自 M5-Bus 的 5V 电压转换为 3.3V，为主控 STM32（冷端）供电。
*   **U3 (HX6306P332), U4 (MD5333):** 低压差线性稳压器 (LDO)。将隔离后的 ISO_5V 分别稳压至 ISO_3V3（为 MAX31855 和 CA-IS3020S 热端侧供电）和 ISO_P3V3（为继电器线圈供电）。
*   **K1 (AGQ200A4H):** 信号继电器。用于切换来自 U5 和 U6 的 SDO（串行数据输出）信号，实现 MISO 信号的复用。

#### 2. 电路设计思想
该模块采用隔离式双通道温度测量设计。整体电路分为“冷端”（MCU 侧）和“热端”（测量侧）两部分。
*   **冷端：** 以 STM32F030F4P6 (U1) 为核心，通过 M5-Bus 上的 I2C 接口与外部主控通信。其供电直接来源于 M5-Bus。
*   **热端：** 包含两路 MAX31855 (U5, U6) 及其对应的热电偶输入接口。此部分电路通过隔离电源模块 (U8) 和信号隔离芯片 (U7) 与冷端完全电气隔离，以增强测量的稳定性和安全性。
*   **数据采集：** STM32 作为 SPI 主机，通过隔离芯片与 MAX31855 通信。为节省引脚，两路 MAX31855 的 SDO 输出通过一个信号继电器 (K1) 进行选择，复用一根 MISO 信号线。

#### 3. 供电电路
*   **主供电输入:** 电源主要来自 M5-Bus 的 `5V`、`3V3` 和 `GND` 引脚。
*   **冷端供电:** M5-Bus 的 `5V` 输入至 DC-DC 芯片 ME3116 (U2)，经由电感 L1 降压后输出稳定的 `3.3V`，为 STM32 (U1) 及信号隔离芯片 CA-IS3020S (U7) 的 A 侧供电。
*   **隔离电源:** M5-Bus 的 `5V` 同时输入至隔离电源模块 B0505LS-1WR2 (U8)，输出一路电气隔离的 `ISO_5V` 和 `ISO_GND`。
*   **热端供电:**
    *   `ISO_5V` 输入至 LDO HX6306P332 (U3)，输出 `ISO_3V3`，为两颗 MAX31855 (U5, U6) 和 CA-IS3020S (U7) 的 B 侧供电。
    *   `ISO_5V` 同时输入至 LDO MD5333 (U4)，输出 `ISO_P3V3`，专门为继电器 K1 的线圈供电，以避免开关噪声干扰敏感的测量电路。

#### 4. 信号路径
*   **K 型热电偶输入路径:** 两路热电偶分别接入接线端子 P1 和 P2。P1 的信号 (`K_IN1+`, `K_IN1-`) 经过 C21/R8 滤波后直接送入 U5 的 `T+`/`T-` 引脚。P2 的信号 (`K_IN2+`, `K_IN2-`) 经过 C22/R9 滤波后直接送入 U6 的 `T+`/`T-` 引脚。
*   **SPI 信号路径:**
    1.  STM32 (U1) 的 SPI 引脚 (`PA5/SCK`, `PA7/MOSI`, `PA6/MISO`, `PB0/CS1`, `PB1/CS2`) 连接至数字隔离器 CA-IS3020S (U7) 的 A 侧。
    2.  U7 的 B 侧输出隔离后的 SPI 信号 (`ISO_SCK`, `ISO_MOSI`, `ISO_MISO`, `ISO_CS1`, `ISO_CS2`)。
    3.  `ISO_SCK`, `ISO_MOSI` 分别并联至 U5 和 U6 的 `SCK` 和 `SDI` 引脚。`ISO_CS1` 和 `ISO_CS2` 分别连接至 U5 和 U6 的 `~CS` 引脚，用于片选。
    4.  U5 的 `SDO` (`U5_SO`) 和 U6 的 `SDO` (`U6_SO`) 分别连接至继电器 K1 的常开和常闭触点。
    5.  继电器 K1 的公共端连接至 `ISO_MISO`，最终通过 U7 返回至 STM32 的 `PA6/MISO` 引脚。通过控制继电器，STM32 选择读取 U5 或 U6 的数据。

#### 5. 逻辑电路
*   **I2C 地址配置:** 拨码开关 SW1 的两位连接至 STM32 的 `PA0` 和 `PA1` 引脚。这两引脚通过上拉电阻 R3 和 R4 接至 `3.3V`。当开关闭合时，对应引脚被拉低至 `GND`。STM32 通过读取这两引脚的电平组合来确定自身的 I2C 地址。
*   **继电器控制逻辑:** STM32 的 `PA4` 引脚通过限流电阻 R7 控制 NPN 型三极管 Q1 的基极。当 `PA4` 输出高电平时，Q1 导通，将 `RLY` 节点拉至 `ISO_GND`，从而使继电器 K1 的线圈（连接在 `ISO_P3V3` 和 `RLY` 之间）通电吸合。二极管 D1 为续流二极管，用于保护 Q1。

#### 6. 串口与通讯芯片
*   **I2C 通信:** STM32 (U1) 的 `PB6/SCL` 和 `PB7/SDA` 引脚直接连接至 M5-Bus 的对应引脚，作为 I2C 从设备与 M5 主机通信。线路上有 R1 和 R2 (4.7KΩ) 作为上拉电阻。
*   **SPI 通信:** STM32 (U1) 作为 SPI 主机，通过 `PA5, PA6, PA7, PB0, PB1` 引脚与 MAX31855 通信。
*   **信号隔离 (CA-IS3020S):** U7 实现了 SPI 总线的电气隔离。其 A 侧（VA, GNDA）连接冷端 `3.3V` 电源域，B 侧（VB, GNDB）连接热端 `ISO_3V3` 电源域，通过内部的电容或变压器结构传输数字信号，阻断直流和低频共模噪声。

#### 7. 电源管理与电路连接关系
*   **M5-Bus 接口:** 是整个模块的电源和通信入口，提供了 `5V` 和 `3.3V` 电源以及 `SCL/SDA` 通信线。
*   **冷端电路:** 由 M5-Bus 的 `5V` 经 ME3116 (U2) 稳压至 `3.3V` 供电，包含 STM32 (U1) 和 CA-IS3020S (U7) 的 A 侧。
*   **隔离层:** 由 B0505LS-1WR2 (U8) 实现电源隔离，由 CA-IS3020S (U7) 实现信号隔离。
*   **热端电路:** 由隔离电源 `ISO_5V` 经两路 LDO (U3, U4) 分别稳压后供电，包含 MAX31855 (U5, U6)、继电器 (K1) 和 CA-IS3020S (U7) 的 B 侧。
*   **连接关系总结:** M5-Bus -> 冷端电路 (STM32) -> 隔离层 (电源+信号) -> 热端电路 (MAX31855, 继电器) -> 热电偶传感器。STM32 通过 I2C 接收指令，通过隔离的 SPI 总线和继电器控制来采集双通道温度数据，并将结果返回给 I2C 主机。

---

## 补充信息

好的，以下是对原理图描述的补充说明，涵盖了一些更精细的电路设计细节：

### 补充说明

#### 1. 无源元件的角色与细节
*   **去耦电容:** 在原理图中，每个集成电路（U1, U2, U3, U4, U5, U6, U7, U8）的电源引脚附近都配有多个电容（如 C1-C19）。这些是去耦电容，通常为 0.1μF 和若干μF的组合，其作用是滤除电源线上的高频噪声，并为芯片提供瞬时电流，保证芯片工作的稳定性。
*   **输入滤波电路:** 在两路 K 型热电偶输入端（P1, P2），分别设计了由电阻（R8, R9）和电容（C21, C22）组成的 RC 低通滤波器。此滤波器的主要功能是滤除由热电偶长导线引入的高频电磁干扰（EMI/RFI），确保进入 MAX31855 芯片的是干净的毫伏级信号。
*   **上拉/下拉电阻:**
    *   I2C 总线上的 R1 和 R2（4.7KΩ）为标准上拉电阻，确保 SCL 和 SDA 信号在总线空闲时处于高电平。
    *   地址配置引脚 PA0 和 PA1 上的 R3 和 R4（10KΩ）为上拉电阻，使得拨码开关断开时，引脚读取为高电平。
    *   在 MAX31855 (U5, U6) 的 SDI 引脚上可能接有下拉电阻（如 R11, R12），以确保在没有数据传输时，数据输入线处于确定的低电平状态，防止信号悬空。

#### 2. 微控制器辅助电路
*   **复位电路:** STM32 (U1) 的 `NRST` 引脚（Pin 4）通过上拉电阻 R5 连接到 `3.3V`，并通过电容 C20 接地。这是一个标准的上电复位（Power-on Reset）电路，确保微控制器在通电时能够可靠地复位启动。
*   **编程/调试接口:** STM32 的串行线调试（SWD）接口引脚 `PA14/SWCLK` (Pin 18) 和 `PA13/SWDIO` (Pin 17) 被引出。这些引脚用于固件的烧录和在线调试，通常会连接到板上的测试点（Test Points）或专用的编程接口。

#### 3. 继电器驱动细节
*   **晶体管开关:** NPN 晶体管 Q1 作为一个低边开关（Low-side Switch）来驱动继电器 K1。STM32 的 PA4 引脚通过基极电阻 R7 控制 Q1 的导通与截止。R7 的作用是限制流入基极的电流，保护 MCU 的 I/O 引脚。
*   **续流二极管:** 继电器线圈两端并联的二极管 D1 是一个续流二极管（Flyback Diode）。当 Q1 从导通变为截止时，继电器线圈中存储的磁能会产生一个反向的高压脉冲。D1 为这个感应电流提供了一个释放回路，从而保护开关晶体管 Q1 免受过压损坏。

#### 4. 电源隔离模块的细节
*   **B0505LS-1WR2 (U8):** 这是一个 1W 的 DC-DC 隔离电源模块。它将输入的 5V 电压转换为一路浮地的、与输入侧电气隔离的 5V 电压（ISO_5V）。这种隔离是实现热电偶安全测量的关键，它能有效断开接地回路，抑制共模干扰，并保护 M5 主系统免受测量端可能出现的高压影响。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 22:29:58*
