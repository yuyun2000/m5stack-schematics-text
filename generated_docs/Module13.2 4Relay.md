# Module13.2 4Relay 原理图描述

---

## 原理图分析

好的，以下是根据您提供的原理图和信息生成的 Module13.2 4Relay 模块技术描述。

### 1. 主要芯片及其功能

*   **微控制器 (MCU):** 核心控制器为 **STM32F030F4P6 (U2)**。该 MCU 负责接收来自 M5 主控的 I2C 指令，并根据指令控制 4 路继电器的开关状态。
*   **DC-DC 降压转换器:** 采用 **SY8089 (U1)** 作为降压稳压器。它将来自 DC5521 接口的 5V-24V 宽范围直流输入电压（`DC_IN`）转换为稳定的 +5V 电压（`+5V_EXT`），专门用于驱动 4 路继电器的线圈。
*   **低压差线性稳压器 (LDO):** 采用 **ME6211 (U3)**。它将来自 M5 BUS 的 +5V 电压转换为 +3.3V，为 STM32F030F4P6 微控制器提供工作电源。

### 2. 电路设计思想

该模块采用主从式架构。STM32F030F4 作为从机，通过 I2C 总线与 M5 主控（主机）通信。MCU 电路与继电器驱动电路在供电上进行了隔离设计：MCU 由 M5 BUS 供电，而继电器线圈由外部 DC 电源独立供电，避免了继电器开关时产生的电气噪声对主控和 MCU 的干扰。通过跳线帽设计，实现了继电器输出的有源/无源模式切换以及对 M5 BUS 的高功率供电功能。

### 3. 供电与充电电路

*   **外部电源输入:** 通过一个 **DC5521 (DC005)** 母座接收外部直流电源，支持 5V-24V 输入。输入端串联一个 **SS14 (D5)** 肖特基二极管，用于防反接保护。经过保护后的电压为 `V_IN`。
*   **继电器供电:** `V_IN` 电压输入至 SY8089 (U1) DC-DC 降压芯片，输出稳定的 +5V (`+5V_EXT`)，专门为 K1-K4 继电器线圈供电。
*   **MCU 供电:** 模块通过 M5 BUS 的 PIN28 获取 +5V 电压，再经过 ME6211 (U3) LDO 降压至 +3.3V，为 STM32F030F4 (U2) 供电。
*   **HPWR 供电输出:** `V_IN` 电压通过跳线帽 **JP5** 连接到 M5 BUS 的 HPWR 引脚（PIN 25, 27, 29）。当 JP5 跳线帽接通时，外部 DC 输入的电压将直接输出到 M5 BUS 的高功率总线上。

### 4. 串口与通讯芯片

*   **I2C 通讯:** 模块通过 I2C 接口与 M5 主控通信，其 I2C 地址在 STM32F030 的固件中被设定为 **0x26**。
    *   STM32F030 的 **PB7** 引脚连接到 M5 BUS 的 **SDA** (PIN 17)。
    *   STM32F030 的 **PB6** 引脚连接到 M5 BUS 的 **SCL** (PIN 18)。
    *   SDA 和 SCL 线路上各有一个 **10KΩ (R8, R7)** 的上拉电阻，连接至 +3.3V。

### 5. 继电器驱动与信号路径

*   **驱动电路:** 每一路继电器均由一个 N-MOSFET (型号 **2N7002**, Q1-Q4) 作为低边开关进行驱动。
*   **控制信号路径:**
    *   STM32F030 的 GPIO 引脚（**PA4, PA5, PA6, PA7**）分别作为 `RELAY_CTL1` 至 `RELAY_CTL4` 控制信号。
    *   控制信号通过一个 **1KΩ** 的串联电阻（R1, R3, R4, R6）连接到对应 MOSFET 的栅极。
    *   MOSFET 的源极接地，漏极连接到继电器线圈的一端。
*   **继电器驱动过程:** 当 MCU 的某个 GPIO 输出高电平时，对应的 MOSFET 导通，形成从 `+5V_EXT` 到继电器线圈再到 GND 的电流通路，继电器吸合。输出低电平时，MOSFET 关断，继电器释放。
*   **续流二极管:** 每个继电器线圈（K1-K4）两端都并联了一个 **1N4148** 二极管（D1-D4），用于在 MOSFET 关断时吸收线圈产生的反向感应电动势，保护驱动管。

### 6. 外设模块与连接关系

*   **继电器输出端子:** 4 组 **HK4100F-DC5V-SHG** 继电器（K1-K4）的开关触点连接至 4 个 2Pin 绿色接线端子（J1-J4）。每个端子引出继电器的 **COM (公共端)** 和 **NO (常开端)**。
*   **跳线帽配置:**
    *   **有源/无源模式切换 (JP1, JP2, JP3, JP4):** 每个继电器对应一个 3Pin 跳线排针。排针的 Pin1 连接到继电器的 COM 端，Pin2 连接到 `V_IN` 电压。
        *   **无源模式 (Dry Contact):** 移除跳线帽。此时 COM 端与模块内部电源 `V_IN` 断开，用户可将 COM 和 NO 端子用于切换外部自定义电路。
        *   **有源模式 (Wet Contact):** 使用跳线帽连接 Pin1 和 Pin2。此时 `V_IN` 电压直接连接到继电器的 COM 端。当继电器吸合时，`V_IN` 电压会从 NO 端输出，直接驱动负载。
    *   **HPWR 输出 (JP5):** 一个 2Pin 跳线排针。当跳线帽接通时，外部输入的 `V_IN` 电压被连接到 M5 BUS 的 HPWR 总线上。

---

## 补充信息

好的，以下是基于原理图的补充细节描述：

### 电路细节补充

#### 1. 微控制器 (STM32F030F4) 周边电路

*   **复位电路:** MCU 的 `NRST` 引脚连接了一个由 **10KΩ 电阻 (R11)** 和 **100nF 电容 (C9)** 组成的 RC 复位电路。R11 将 `NRST` 引脚上拉至 +3.3V，保证正常工作状态；C9 提供上电复位延迟并增强抗干扰能力。
*   **启动模式:** `BOOT0` 引脚通过一个 **10KΩ 下拉电阻 (R10)** 接地，这配置了 STM32F030 在复位后从主闪存存储器 (Main Flash Memory) 启动。
*   **电源去耦:** 在 MCU 的 VDD 和 VSS 引脚附近配置了多个去耦电容 (**C6, C7, C8**)，用于滤除电源噪声，保证 MCU 稳定运行。
*   **调试接口:** MCU 的串行线调试 (SWD) 接口引脚——**SWDIO (PA13)** 和 **SWCLK (PA14)**——被引出到 PCB 上的测试点 `SWD` 和 `SWC`，用于固件的烧录与在线调试。

#### 2. 电源转换与指示电路

*   **DC-DC 转换器元件:** SY8089 (U1) 降压电路的核心元件包括一个 **4.7µH 的功率电感 (L1)**，以及输入/输出滤波电容 (**C1, C2, C3**)，这些元件共同构成了 Buck 转换器拓扑，以高效地将 5-24V 输入转换为 5V 输出。
*   **LDO 稳压器元件:** ME6211 (U3) LDO 的输入和输出端各有一个电容 (**C4, C5**)，用于稳定 LDO 的工作，改善瞬态响应和抑制噪声。
*   **电源指示灯:** 电路中包含一个绿色 **LED (LED1)**，通过一个 **1KΩ 限流电阻 (R9)** 连接到 `+5V_EXT` 电源轨。当外部 DC 电源接入且 SY8089 正常工作时，该 LED 会点亮，作为继电器供电正常的指示。

#### 3. 继电器驱动电路可靠性设计

*   **MOSFET 栅极下拉电阻:** 每个驱动 MOSFET (Q1-Q4) 的栅极不仅有串联电阻，还有一个 **10KΩ 的下拉电阻** (R2, R5, R14, R15) 接地。此电阻确保在 MCU 上电初始化期间或 GPIO 引脚处于高阻态时，MOSFET 的栅极能被可靠地拉到低电平，防止继电器意外导通。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 22:18:17*
