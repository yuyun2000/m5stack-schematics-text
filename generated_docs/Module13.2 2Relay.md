# Module13.2 2Relay 原理图描述

---

## 原理图分析

好的，请看以下基于您提供的原理图与提示词生成的 Module13.2 2Relay 技术描述。

---

### **Module13.2 2Relay 原理图描述**

#### **1. 主要芯片及其功能**
模块的核心控制器是意法半导体的 **STM32F030F4P6** 微控制器（MCU）。该 MCU 负责处理来自 I2C 总线的指令，并通过其 GPIO 引脚输出控制信号，以驱动两路继电器。其 I2C 通信地址固定为 **0x26**。

#### **2. 供电电路**
模块支持多种供电方式：
*   **M-Bus 接口供电**：可通过 M-Bus 接口直接获取 5V 和 3.3V 电源。
    *   **3.3V**：直接由 M-Bus 的 3.3V 引脚提供，专门为 STM32F030 MCU 及其复位电路供电。
    *   **5V**：直接由 M-Bus 的 5V 引脚提供，为两路继电器的线圈及状态指示灯供电。
*   **外部直流/交流电源输入 (PWR_IN)**：模块板载一个 **MB10S** 桥式整流器，允许通过 `PWR_IN` 接口输入直流或交流电。
    *   输入电源经桥式整流和电容 `C1` 滤波后，送至一个 **ME6211** 系列的低压差线性稳压器 (LDO)。
    *   ME6211 将输入电压稳定输出为 5V，为继电器线圈供电。
    *   M-Bus 的 **HPWR** 引脚也与 ME6211 的输入端相连，因此也可以通过 M-Bus 的高功率引脚为模块供电。

#### **3. 串口与通讯芯片**
*   **I2C 通信**：模块通过 M-Bus 接口进行 I2C 通信。
    *   STM32F030 MCU 的 **PB6** 引脚作为 **SDA** (串行数据)，**PB7** 引脚作为 **SCL** (串行时钟)。
    *   SDA 和 SCL 信号线路上各有一个 **10kΩ** 的上拉电阻 (`R3`, `R4`) 连接至 3.3V 电源，以满足 I2C 总线规范。

#### **4. 电路设计思想与信号路径**
*   **控制逻辑**：MCU 通过 GPIO 控制继电器，信号路径如下：
    1.  MCU 的 **PA4** 引脚用于控制第一路继电器 (RELAY1)，**PA5** 引脚用于控制第二路继电器 (RELAY2)。
    2.  当 MCU 的 GPIO 引脚（如 PA4）输出高电平时，电流通过一个 **4.7kΩ** 的基极电阻 (`R5`) 流入 NPN 型晶体管 **Q1 (MMBT3904)** 的基极，使其导通。
    3.  晶体管 Q1 导通后，其集电极与发射极之间形成通路，将继电器 **K1** 线圈的一端拉至 GND。
    4.  继电器 K1 线圈的另一端始终连接在 5V 电源上，因此电路闭合，线圈通电，继电器吸合。
    5.  第二路继电器 (RELAY2) 的控制原理与第一路完全相同，由 PA5、R6 和 Q2 构成驱动电路。

*   **保护电路**：
    *   每个继电器线圈两端都反向并联了一个 **1N4148** 开关二极管（`D1`, `D2`）。此为续流二极管，用于在继电器线圈断电时，吸收其产生的反向感应电动势，保护驱动晶体管 Q1 和 Q2 免受高压冲击。

*   **状态指示**：
    *   每个继电器线圈都并联了一个 LED 指示灯（`LED1`, `LED2`）和一个限流电阻（`R7`, `R8`）。当继电器线圈通电吸合时，对应的 LED 会被点亮，直观地显示继电器的当前工作状态。

#### **5. 外设模块与连接关系**
*   **继电器模块**：模块集成了两路 **932-5VDC-SL-AH** 型号的继电器 (`K1`, `K2`)。该继电器线圈驱动电压为 5VDC，其触点支持最大 **250VAC@5A** 的负载。
*   **输出接线端子**：
    *   每路继电器的常开 (NO) 和公共 (COM) 触点被引出至一个 **VH3.96-2P** 规格的接线端子（`J3` 用于 RELAY1，`J4` 用于 RELAY2）。
    *   继电器的常闭 (NC) 触点在原理图中未被引出至外部端子。
*   **M-Bus 接口**：模块通过 `J1` M-Bus 接口与 M5Stack 主机连接，实现了电源供应（GND, 3V3, 5V, HPWR）和 I2C 通信（SDA, SCL）的集成。

---

## 补充信息

在上述描述的基础上，可以补充以下几点技术细节：

#### **1. MCU 外围电路**

*   **复位电路**：MCU 的 `NRST` 引脚通过一个由 10kΩ 电阻 (`R1`) 和 100nF 电容 (`C4`) 组成的 RC 网络连接。`R1` 将 `NRST` 引脚上拉至 3.3V，`C4` 接地，构成一个标准的上电复位和手动复位电路，确保 MCU 可靠启动。
*   **启动模式配置**：MCU 的 `BOOT0` 引脚通过一个 10kΩ 的下拉电阻 (`R2`) 接地。此配置确保了 MCU 在上电后从其内部闪存（Flash Memory）启动，这是正常的程序运行模式。
*   **电源去耦**：在 MCU 的 `VDD_1` 和 `VDD_2` 电源引脚附近，各配置了一个 100nF 的去耦电容（`C2`, `C5`）。这些电容用于滤除电源线上的高频噪声，为 MCU 提供稳定、纯净的 3.3V 工作电压。

#### **2. 电源管理细节**

*   **LDO 稳定性**：线性稳压器 ME6211 的输入端和输出端均配置了 10µF 的电容（`C6` 和 `C7`）。输入电容 `C6` 用于稳定输入电压，输出电容 `C7` 用于稳定输出电压并改善瞬态响应，确保 LDO 能够稳定输出 5V。
*   **5V 电源路径**：模块的 5V 电源轨（`5V_RELAY`）由两个来源共同汇入：
    1.  来自 M-Bus 接口的 5V 输入。
    2.  来自外部电源输入（`PWR_IN` 或 `HPWR`）经 ME6211 稳压后的 5V 输出。
    这两个电源路径被直接并联到一起。这意味着，当同时使用 M-Bus 5V 和外部电源时，两个电源会直接连接。

#### **3. 连接器标识**

*   **M-Bus 接口**：原理图标号为 `J1`。
*   **外部电源输入**：AC/DC 输入接口标号为 `J2`。
*   **继电器输出端子**：RELAY1 和 RELAY2 的输出接线端子在原理图上分别标号为 `J3` 和 `J4`。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 22:14:13*
