# Atom Stepmotor 原理图描述

---

## 原理图分析

好的，根据提供的 M5Stack Atom Stepmotor 原理图和解析提示，以下是该电路的技术性描述。

### M5Stack Atom Stepmotor 原理图描述

#### 1. 主要芯片及其功能

- **DRV8825 (U1):** 核心组件为德州仪器（TI）的 DRV8825 步进电机驱动器。它集成了两个 H 桥驱动电路，用于驱动双极步进电机。
    - **功能:** 接收来自主控（ATOM-Lite）的 STEP 和 DIR 信号，控制电机的步进和方向。内置索引器逻辑，支持从全步进到 1/32 微步进的细分控制。
    - **保护:** 芯片内部集成过流保护（OCP）、短路保护（SCP）、欠压锁定（UVLO）和过温关断（TSD）功能。故障状态通过 `nFAULT` 引脚输出。
    - **电流调节:** 通过 `VREF` 引脚的模拟电压设定电机线圈的峰值电流。

#### 2. 供电电路

- **电源输入:** 电路接受 **9–18V DC** 外部电源输入，通过 **J2 (DC JACK)** 或 **J1 (KF128L)** 的相应引脚接入。输入端串联一个 **SS34 肖特基二极管 (D1)**，提供反接保护。经过保护后的电源总线为 **VDC**。
- **DC-DC 降压转换:** **VDC** 电源分为两路：
    1.  直接供给 **DRV8825** 的 `VM` 引脚，作为电机驱动电源。输入端配置了一个 **100µF 电解电容 (C5)** 用于稳压和滤波。
    2.  送至 **SY8089 (U2)** DC-DC 降压转换芯片的 `VIN` 引脚。
- **5V 电源生成:** **SY8089 (U2)** 将 **VDC** 降压至 **5V**，作为系统的逻辑电源。该 5V 电源：
    -   为 **ATOM-Lite** 通过 M5-Bus 的 `5V` 引脚供电。
    -   为 `nFAULT` 信号提供上拉电源。
    -   点亮电源指示灯 **LED1**。
    -   作为下一级 LDO 的输入。
- **3.3V 电源生成:** **5V** 电源被送至 **ME6211 (U3)** 低压差线性稳压器（LDO），生成 **3.3V** 电源，通过 M5-Bus 的 `3V3` 引脚为 **ATOM-Lite** 的 3.3V 系统供电。
- **输入电压监测:** `VDC` 通过一个由 **R9 (100kΩ)** 和 **R10 (10kΩ)** 组成的电阻分压器连接到 M5-Bus 的 `PWR-ADC` 引脚（对应 ATOM-Lite 的 G33）。分压比为 1/11，允许 ATOM-Lite 的 ADC 测量并监控外部输入电压。

#### 3. 信号路径与逻辑电路

- **控制信号:**
    -   **STEP (G21):** 从 ATOM-Lite 输入至 DRV8825 的 `STEP` 引脚，每个脉冲上升沿使电机步进一次。
    -   **DIR (G25):** 从 ATOM-Lite 输入至 DRV8825 的 `DIR` 引脚，控制电机旋转方向。
    -   **EN (G22):** 从 ATOM-Lite 输入至 DRV8825 的 `nENBL`（低电平有效）引脚，用于使能或禁用 H 桥输出。
    -   **RESET (G19):** 从 ATOM-Lite 输入至 DRV8825 的 `nRESET` 引脚，用于复位驱动器内部逻辑。
- **状态反馈信号:**
    -   **FAULT (G23):** DRV8825 的 `nFAULT`（低电平有效）引脚连接至 ATOM-Lite 的 G23。该引脚在发生过流或过温等故障时被拉低，并通过 **R1 (10kΩ)** 上拉至 5V。

#### 4. 外设模块与接口

- **M5-Bus 接口:** 用于连接 ATOM-Lite 主控。关键引脚连接关系如下：
    -   `G19`: `nRESET`
    -   `G21`: `STEP`
    -   `G22`: `nENBL`
    -   `G23`: `nFAULT`
    -   `G25`: `DIR`
    -   `G33`: `PWR-ADC`
    -   `5V`, `3V3`, `GND`: 为 ATOM-Lite 提供电源。
- **电机输出接口 (J1):** 采用 **KF128L 2.54 6P** 接线端子。
    -   `B+` / `B-`: 连接电机 B 相线圈，对应 DRV8825 的 `BOUT1` / `BOUT2`。
    -   `A+` / `A-`: 连接电机 A 相线圈，对应 DRV8825 的 `AOUT1` / `AOUT2`。
- **拨码开关 (S1):** 一个四位拨码开关用于配置 DRV8825 的工作模式。每个模式引脚（`M0`, `M1`, `M2`, `DECAY`）通过一个 **10kΩ** 电阻（R12-R15）上拉至 DRV8825 内部的 **V3P3OUT**。当开关拨至 ON 时，对应引脚接地（逻辑低）。
    -   **S1-1:** 控制 `M0`
    -   **S1-2:** 控制 `M1`
    -   **S1-3:** 控制 `M2`
    -   （`M0`, `M1`, `M2` 组合设置步进细分，从全步进至 1/32 步进）
    -   **S1-4:** 控制 `DECAY`，用于选择电流衰减模式（ON 为慢衰减，OFF 为快/混合衰减）。

#### 5. 电流调节与电源管理

- **电流调节:** 板载一个 **10kΩ 电位器 (VR1)**，其滑动端连接到 DRV8825 的 `VREF` 引脚。电位器两端接在 **V3P3OUT** 和 **GND** 之间，通过调节电位器可以改变 `VREF` 的电压（0V 至 3.3V），从而设定电机线圈的峰值斩波电流。电流计算公式为 `I_CHOP = VREF / (5 * R_SENSE)`。其中 `R_SENSE` 为 **R4** 和 **R5**，阻值为 **0.2Ω**。
- **电源管理:** DRV8825 的 `nSLEEP` 引脚通过 **R2 (10kΩ)** 上拉至 **V3P3OUT**，使驱动器默认处于工作状态。ATOM-Lite 可通过引脚控制使其进入低功耗睡眠模式（原理图中未引出至 M5-Bus）。

#### 6. 指示灯
- **LED1:** 一个红色 LED，通过 **1kΩ** 限流电阻 **R6** 连接在 **5V** 和 **GND** 之间，作为 **5V 逻辑电源** 的工作状态指示灯。当系统上电且 DC-DC 转换正常工作时，该灯点亮。

---

## 补充信息

好的，在上述描述的基础上，以下是对原理图设计细节的进一步补充说明：

### 补充说明

#### 1. DRV8825 驱动芯片外围电路细节

- **电荷泵电路:** DRV8825 (U1) 内部集成了一个电荷泵，用于生成驱动 H 桥高侧 N-MOSFET 所需的栅极电压。该电路需要外部电容配合工作：
    - **C1 (0.1µF):** 连接在 `VCP` 和 `VM` 之间，作为电荷泵的储能电容。
    - **C2 (0.1µF):** 连接在 `CP1` 和 `CP2` 之间，是电荷泵的飞行电容。
    - **C3 (0.1µF):** 连接在 `VCP` 和 `GND` 之间，用于稳定电荷泵输出电压。
    这些电容对于驱动器的正常工作至关重要。

- **电源去耦:**
    - **C4 (0.1µF):** 紧靠 DRV8825 的 `VM` 引脚放置，作为高频去耦电容，用于滤除电机电源线上的高频噪声，确保驱动器供电稳定。它与 **C5 (100µF)** 的大容量电解电容共同构成了完整的电源滤波网络。

- **电流检测电阻:**
    - **R4 (0.2Ω)** 和 **R5 (0.2Ω)** 是两个独立的电流检测电阻，分别连接在 H 桥 A 和 H 桥 B 的低侧源极与 `PGND`（功率地）之间。DRV8825 通过检测这两个电阻上的压降来实时监控并限制流过 A、B 两相线圈的电流。

#### 2. 电源转换器外围电路

- **SY8089 (DC-DC):**
    - **L1 (2.2µH):** 是降压转换器的核心储能电感。
    - **C7 (22µF):** 是 **SY8089** 的输出滤波电容，用于稳定输出的 5V 电压并减小纹波。
- **ME6211 (LDO):**
    - **C8 (1µF)** 和 **C9 (1µF):** 分别是 **ME6211** 的输入和输出电容，用于保证 LDO 工作的稳定性，防止电压振荡。

#### 3. 内部逻辑电源域区分

- **V3P3OUT 引脚:** DRV8825 芯片内部集成了一个 3.3V LDO，其输出引脚为 `V3P3OUT`。此电源仅用于驱动器内部的数字逻辑部分，并为模式选择引脚（`M0`, `M1`, `M2`, `DECAY`）和 `nSLEEP` 引脚提供上拉电压。它与外部由 **ME6211** 生成、供给 ATOM-Lite 的 **3.3V** 主逻辑电源是相互独立的。这种设计隔离了驱动器内部逻辑与外部主控的电源，增强了系统的稳定性。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 19:15:41*
