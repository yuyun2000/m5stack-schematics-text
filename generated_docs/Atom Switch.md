# Atom Switch 原理图描述

---

## 原理图分析

### M5Stack Atom Switch 原理图描述

#### 1. 整体架构
该原理图描绘了一款集成双路继电器控制、AC-DC 电源及 RS485 通讯功能的物联网开关模块。其核心为 M5Stack Atom 主控模块，负责逻辑控制与 Wi-Fi 通讯。外围电路主要由三部分构成：
1.  **电源系统**：包含 AC-DC 转换电路和外部 DC 供电电路，为整个系统提供稳定的 5V 工作电压。
2.  **继电器控制电路**：两路独立的继电器驱动电路，通过主控 GPIO 信号控制大功率负载的通断。
3.  **通讯与扩展接口**：集成了 RS485 通讯电路和标准的 PORT.A 扩展接口。

电路设计上，通过继电器和电源模块实现了强电（AC 250V）与弱电（DC 5V）部分的物理隔离，确保了控制端的安全。

#### 2. 供电系统
系统采用双路供电设计，可由市电 AC 或外部 DC 电源供电。

*   **AC-DC 供电电路**：
    *   **输入**：通过 VH3.96-2P 接口接入 AC 85-265V 市电。输入端串联有保险丝（FUSE）用于过流保护，并联有压敏电阻（MOV）用于吸收浪涌电压，提升电路的抗冲击能力。
    *   **转换**：内置一体化 AC-DC 开关电源模块，将输入的交流电高效转换为稳定的 DC 5V/1A 输出。该模块具备短路保护和过热保护功能。
    *   **输出**：转换后的 5V 电压作为系统主供电（V_SYS），为 Atom 主控、继电器线圈、SP485EE 芯片及其他逻辑电路供电。

*   **外部 DC 供电电路**：
    *   **输入**：通过 RS485 的 VH3.96-4P 接口的电源引脚接入 DC 9-24V 电源。
    *   **转换**：外部直流电输入后，经过一个板载 DC-DC 降压转换器（Buck Converter），将其转换为稳定的 5V 电压。
    *   **电源路径选择**：通过二极管等防反灌电路与 AC-DC 模块的 5V 输出进行隔离，实现了电源的“或”逻辑选择，确保两路电源不会相互冲突，并优先使用电压较高的一路或根据设计进行切换。

#### 3. 主控模块与信号路径
M5Stack Atom 模块作为中央处理器，其引脚与外围电路的连接关系如下：
*   **电源**：`5V` 和 `GND` 引脚连接至系统 5V 供电和地。
*   **继电器控制**：
    *   `GPIO22` 连接至第一路继电器（RELAY1）的控制端。
    *   `GPIO19` 连接至第二路继电器（RELAY2）的控制端。
*   **RS485 通讯**：
    *   `GPIO33` 作为 `RS485_TX`，连接至 SP485EE 芯片的 `DI`（Driver Input）引脚。
    *   `GPIO26` 作为 `RS485_RX`，连接至 SP485EE 芯片的 `RO`（Receiver Output）引脚。
*   **I2C 接口**：
    *   `GPIO21` (SDA) 和 `GPIO25` (SCL) 被引出至 HY2.0-4P (PORT.A) 接口，用于连接 I2C 外设。

#### 4. 继电器控制电路
电路包含两路上完全相同的驱动电路，用于将主控的 TTL 电平信号放大以驱动继电器线圈。
*   **驱动方式**：每路控制采用一个 NPN 型三极管作为低边开关。主控的 GPIO 引脚（如 GPIO22）通过一个限流电阻连接到三极管的基极。
*   **工作原理**：当 GPIO 输出高电平时，三极管导通，其集电极被拉至低电平，构成继电器线圈的导通回路（5V -> 线圈 -> 三极管 -> GND），线圈得电，继电器吸合，其常开触点闭合。当 GPIO 输出低电平时，三极管截止，线圈失电，继电器释放。
*   **保护电路**：每个继电器线圈两端都并联一个反向续流二极管（Flyback Diode），用于在三极管截止、线圈断电时，为线圈产生的感应电动势提供一个释放回路，保护驱动三极管不被高压击穿。
*   **输出**：继电器的常开（NO）和公共（COM）端子被引出至两个独立的 VH3.96-2P 接口，用于串联到外部 AC 250V/10A 的负载回路中。

#### 5. 串口与通讯芯片 (RS485)
*   **芯片**：采用 SP485EE 芯片，作为 RS485 收发器，实现 TTL/CMOS 逻辑电平与 RS485 差分信号电平之间的转换。
*   **连接关系**：
    *   **逻辑侧**：芯片的 `DI` 和 `RO` 引脚分别连接到 Atom 主控的 `GPIO33` 和 `GPIO26`。`DE` (Driver Enable) 和 `RE#` (Receiver Enable) 引脚通常会连接在一起，由主控的另一个 GPIO 控制，以实现半双工通讯的发送/接收模式切换。
    *   **总线侧**：芯片的 `A` 和 `B` 差分信号引脚连接到 VH3.96-4P 接口，用于接入 RS485 总线。总线上通常会配置终端匹配电阻和上下拉偏置电阻，以保证总线空闲时的稳定状态和抑制信号反射。
    *   **供电**：SP485EE 芯片由系统 5V 电源供电。

#### 6. 外部接口
*   **AC IN (1×VH3.96-2P)**：交流电源输入接口。
    *   Pin 1: AC_L (火线)
    *   Pin 2: AC_N (零线)
*   **RELAY OUT (2×VH3.96-2P)**：两路独立的继电器开关输出接口。
    *   Pin 1: COM (公共端)
    *   Pin 2: NO (常开端)
*   **RS485 (1×VH3.96-4P)**：RS485 通讯及外部直流供电接口。
    *   Pin 1: 9-24V (外部直流电源输入)
    *   Pin 2: GND (地)
    *   Pin 3: B (RS485 差分信号 B)
    *   Pin 4: A (RS485 差分信号 A)
*   **PORT.A (1×HY2.0-4P)**：I2C/GPIO 扩展接口，兼容 M5Stack 生态系统。
    *   Pin 1: G21 (SDA)
    *   Pin 2: G25 (SCL)
    *   Pin 3: 5V
    *   Pin 4: GND

---

## 补充信息

是的，基于通用电路设计原则和此类产品的常见实践，可以补充以下几点技术细节，以获得对原理图更全面的理解：

#### 1. 安全、隔离与电路保护的深化
*   **物理隔离与安规设计**：除了通过继电器和电源模块实现强弱电隔离外，在实际的 PCB（印刷电路板）设计中，原理图的实现会严格遵守安全规范。这包括在高压区（AC 输入）和低压区（DC 控制）之间保持足够的**爬电距离（Creepage）**和**电气间隙（Clearance）**，并在两者之间开槽或使用隔离栅，以防止在高湿度或污染环境下发生电弧或短路，确保用户安全。
*   **ESD（静电放电）保护**：对外暴露的通讯接口，特别是长距离布线的 RS485 接口（A/B 线），通常会额外增加 **TVS（瞬态电压抑制）二极管**。这些元件并联在信号线和地之间，用于钳位静电、浪涌等高压瞬变，保护 SP485EE 芯片和主控不被损坏。PORT.A 接口的信号线也可能配置有低电容的 ESD 保护器件。

#### 2. 电源完整性 (Power Integrity)
*   **去耦电容（Decoupling Capacitors）**：原理图中虽然可能未逐一标明，但在实际电路中，每个集成电路（IC）的电源引脚（VCC/VDD）附近都会放置一个或多个**去耦电容**（通常是 0.1µF 的陶瓷电容）。它们的作用是滤除电源线上的高频噪声，并为芯片提供瞬时电流，保证芯片内部逻辑的稳定运行。Atom 主控、SP485EE 芯片等都需要这样的电容。
*   **大容量滤波电容（Bulk Capacitors）**：在 5V 系统电源（V_SYS）总线上，通常会放置一个或多个**大容量电解电容或钽电容**（例如 10µF - 100µF）。它们作为储能水库，用于平滑电源电压，并在负载发生突变（如继电器吸合瞬间）时，快速补充电流，防止电压跌落影响系统稳定性。

#### 3. 状态指示与用户界面
*   **LED 指示灯**：一个完整的物联网产品通常会包含状态指示灯，这在原理图上表现为与 GPIO 或电源相连的 LED 电路。
    *   **电源指示灯**：一个 LED 直接连接到 5V 系统电源（通过一个限流电阻），用于指示模块是否上电。
    *   **继电器状态指示灯**：每个继电器控制通路上可能会并联一个 LED。当 GPIO 输出高电平驱动三极管导通时，该 LED 也会点亮，直观地显示相应继电器的吸合状态。
    *   **通讯指示灯**：也可能存在用于指示 RS485 数据发送（TX）或接收（RX）的 LED，由相应的控制信号驱动。

#### 4. 控制逻辑的默认状态
*   **上拉/下拉电阻**：为确保系统在上电初始化期间或引脚未被主控配置时处于一个确定的、安全的状态，关键的控制引脚上会使用**上拉或下拉电阻**。
    *   **继电器控制引脚**：GPIO19 和 GPIO22 可能会配置一个下拉电阻，确保在 Atom 启动过程中，继电器默认处于断开状态，避免负载意外启动。
    *   **RS485 使能控制**：如果 SP485EE 的 `DE/RE#` 引脚由一个 GPIO 控制，该 GPIO 也会配置上拉或下拉电阻，以默认进入接收模式，避免总线冲突。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 18:43:20*
