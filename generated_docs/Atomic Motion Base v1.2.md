# Atomic Motion Base v1.2 原理图描述

---

## 原理图分析

好的，这是根据您提供的提示词生成的 Atomic Motion Base v1.2 原理图技术描述。

---

### **1. 主控单元 (MCU)**

*   **芯片型号**: STM32F030F4P6
*   **核心功能**: 作为整个运动底座的协处理器，负责执行来自上位机（如 Atom 系列主控）的指令，并管理底部的电机和舵机。
*   **通信协议**: 通过 I2C 总线与上位机通信，其 I2C 从机地址为 `0x38`。
*   **引脚分配与功能**:
    *   **舵机控制**:
        *   `PA0`: 输出 PWM 信号至 SERVO1 接口。
        *   `PA1`: 输出 PWM 信号至 SERVO2 接口。
        *   `PA2`: 输出 PWM 信号至 SERVO3 接口。
        *   `PA3`: 输出 PWM 信号至 SERVO4 接口。
    *   **直流电机控制**:
        *   `PA4`: 连接至 RZ7899 驱动芯片，控制电机1正转 (M1F)。
        *   `PA5`: 连接至 RZ7899 驱动芯片，控制电机1反转 (M1R)。
        *   `PA6`: 连接至 RZ7899 驱动芯片，控制电机2正转 (M2F)。
        *   `PA7`: 连接至 RZ7899 驱动芯片，控制电机2反转 (M2R)。
    *   **I2C 总线**: MCU 的 I2C 引脚（SDA/SCL）连接至内部的 INA226 功率监测芯片，并同时连接至对外的 HY2.0-4P 接口及与上位机通信的接口。

### **2. 驱动电路**

*   **直流电机驱动**:
    *   **芯片型号**: RZ7899
    *   **功能**: 一颗双通道 H 桥电机驱动芯片，用于驱动两路直流电机，实现正转、反转和刹车功能。
    *   **控制路径**: 由 STM32 的 `PA4`~`PA7` 引脚输入逻辑电平进行控制。
    *   **供电**: 由系统 5V 电源供电。
    *   **保护**: 芯片内部集成过流保护、短路保护和欠压锁定等功能，设计支持 5V@5A 的过载保护能力。

*   **舵机驱动**:
    *   **实现方式**: 由主控 STM32F030F4P6 直接通过 GPIO（`PA0`~`PA3`）产生四路独立的 PWM 信号。
    *   **接口**: 提供四个 2.54mm 间距的舵机接口（SERVO1-SERVO4），每个接口包含 5V 电源、GND 和 PWM 信号线。

### **3. 电源管理系统**

*   **充放电管理芯片**:
    *   **芯片型号**: ETA9740
    *   **功能**: 集成锂电池充电管理与 5V 升压输出功能。负责管理 18350 锂电池的充电过程，并为电机驱动、舵机和外部接口提供稳定的 5V 输出。
    *   **充电参数**: 充电截止电压为 4.14V。可通过外部 5V 输入或上位机接口的 5V 进行充电。
    *   **放电参数**: 放电截止电压为 2.5V，防止电池过放。

*   **电池保护电路**:
    *   **芯片型号**: DW01-A
    *   **功能**: 单节锂电池保护 IC，与外部双 N-MOSFET 配合，构成完整的电池安全保护电路。
    *   **保护机制**: 提供电池的过充电保护、过放电保护以及短路/过电流保护。当检测到任一故障状态时，会切断电池与主电路的连接，确保安全。

*   **功率监测芯片**:
    *   **芯片型号**: INA226
    *   **功能**: 高精度、I2C 接口的电流/电压/功率监测器。
    *   **电路连接**: 串联在电池输出的主路径上，实时测量系统的总线电压和电流。
    *   **数据路径**: 通过 I2C 总线将采集到的电压、电流和计算出的功率值发送给主控 STM32F030，用于电量估算和功耗监控。

*   **电源开关与路径**:
    *   设有一个独立的物理电源开关，用于控制整个底座的电源通断。
    *   电池（BAT）的电力首先经过 DW01-A 保护电路，然后送至 ETA9740 充放电管理芯片。
    *   ETA9740 将电池电压升压至 5V，供给 RZ7899 电机驱动、舵机接口和 HY2.0-4P 接口。
    *   系统还包含一个 3.3V 的电源轨，用于为主控 STM32F030F4P6 及其他逻辑电路供电，该 3.3V 通常由 5V 或电池电压通过 LDO（低压差线性稳压器）转换而来。

### **4. 通信与接口**

*   **I2C 总线结构**:
    *   系统内存在一个共享的 I2C 总线。
    *   上位机（如 Atom）作为 I2C 主机。
    *   STM32F030 作为 I2C 从机（地址 `0x38`），接收上位机的指令。
    *   在 STM32F030 的控制下，它作为 I2C 主机与 INA226 芯片通信，读取功率数据。
    *   此 I2C 总线（SDA/SCL）也被引出至外部接口。

*   **外部接口**:
    *   **类型**: HY2.0-4P
    *   **功能**: 用于扩展外部 I2C 传感器或模块。
    *   **引脚定义**: 包含 5V、GND、SCL、SDA，为外部设备提供电源和通信线路。

*   **内部连接关系**:
    *   电源系统（ETA9740, DW01-A）是核心，为所有单元供电。
    *   主控 STM32F030 是控制核心，通过 GPIO 控制 RZ7899 和舵机，通过 I2C 与上位机及 INA226 通信。
    *   所有驱动电路（RZ7899, 舵机 PWM）均由 STM32F030 直接控制。
    *   功率监测（INA226）的数据流向 STM32F030，为控制策略提供依据。

---

## 补充信息

好的，基于前述描述，可以补充以下更深入的技术细节和电路设计要点，使描述更加完整：

### **补充说明**

#### **1. 微控制器 (MCU) 周边电路**

*   **时钟源**: STM32F030F4P6 通常使用其内部高速振荡器 (HSI) 作为系统时钟，无需外部晶体振荡器。这种设计简化了电路并降低了成本，足以满足电机控制和 I2C 通信的时钟精度要求。
*   **复位电路**: MCU 的 `NRST` 引脚通常连接一个上拉电阻至 3.3V，并并联一个电容到地。这构成了标准的上电复位 (Power-on Reset) 和手动复位电路，确保 MCU 在上电或电压波动时能可靠地启动。
*   **调试接口**: 电路板上通常会预留 SWD (Serial Wire Debug) 接口的测试点或引脚，包括 `SWDIO` 和 `SWCLK`。该接口用于固件的烧录和在线调试。
*   **电源去耦**: 在 MCU 的 `VDD` 电源引脚附近，会配置多个去耦电容（通常为 100nF 和一个较大的电解电容或钽电容），用于滤除电源噪声，保证 MCU 运行的稳定性。

#### **2. 电源系统设计细节**

*   **3.3V 稳压器 (LDO)**: 系统中存在一个低压差线性稳压器 (LDO)。它的作用是将电池电压 (VBAT) 或 5V 系统电压转换为稳定的 3.3V，专门供给 STM32F030 MCU 及其他可能存在的低压逻辑电路。这确保了控制核心的供电不受电机等大功率负载波动的影响。
*   **电流采样电阻**: INA226 功率监测芯片与一个低阻值、高精度的采样电阻（Shunt Resistor）串联在电池输出的主干路上。INA226 通过测量该电阻两端的微小压降来精确计算流经系统的总电流，这是其工作的基础原理。
*   **电源路径隔离**:  servo 的 5V 电源与 MCU 的 3.3V 电源是严格隔离的。伺服电机所需的大电流由 ETA9740 升压后的 5V 直接提供，而不会流经 3.3V LDO，避免了舵机启动或堵转时的大电流冲击影响主控的稳定性。

#### **3. 通信总线与保护**

*   **I2C 总线上拉电阻**: 在 SCL 和 SDA 信号线上，配置有上拉电阻（通常阻值为 2.2kΩ 至 10kΩ），连接到 3.3V 电源轨。这是 I2C 总线协议的必要组成部分，确保总线在空闲状态时保持高电平，并提供信号上升沿驱动能力。
*   **接口静电保护 (ESD)**: 对外的接口，如 HY2.0-4P 和与上位机连接的引脚，在设计上可能会增加 ESD 保护二极管阵列，以防止静电放电损坏内部敏感芯片（如 MCU）。

#### **4. 整体逻辑关系总结**

*   **电源流**: `18350 电池` -> `DW01-A 保护板` -> `ETA9740 充放电管理芯片`。ETA9740 一路输出升压后的 `5V` (供给电机驱动 RZ7899、舵机接口、外部接口)，另一路（或从电池端）通过 `LDO` 降压为 `3.3V` (供给 MCU)。
*   **控制流**: `上位机 (Atom)` <--(I2C)--> `STM32 MCU`。STM32 MCU 再分发控制信号：通过 `GPIO (PWM)` 控制 `舵机`；通过 `GPIO (Logic)` 控制 `RZ7899` 驱动直流电机。
*   **数据流**: `INA226` 采集电池侧的电压电流数据，通过 `I2C` 总线发送给 `STM32 MCU`。MCU 处理后，可通过 I2C 通道上报给上位机，实现电量监测。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 19:14:18*
