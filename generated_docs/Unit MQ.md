# Unit MQ 原理图描述

---

## 原理图分析

好的，遵照您的指示，以下是根据提供的硬件信息对 Unit MQ 原理图的技术性描述。

---

### 主要芯片及功能

*   **主控制器 (MCU):** STM32G030F6P6 (U1)，一颗基于 ARM Cortex-M0+ 内核的 32 位微控制器。它负责处理传感器数据采集、加热器控制、温度补偿计算以及通过 I2C 接口与外部主控进行通信。

### 电路设计思想

该单元的核心设计思想是利用 STM32G030F6P6 微控制器精确控制 MQ-5 气体传感器的工作状态并采集其模拟输出。通过内置 ADC 对传感器输出电压和环境温度进行数字化，实现对可燃气体浓度的测量。电路设计支持两种加热模式（连续/间歇），并通过 I2C 协议提供标准化的数字接口。

### 供电与充电电路

*   **电源输入:** 电路通过 HY2.0-4P 连接器的 5V 和 GND 引脚获取外部 5V 供电。
*   **电源调理:** 外部输入的 5V 电源分为两路。
    1.  一路直接供给 MQ-5 传感器的加热电路（通过 MOSFET 开关控制）以及传感器信号采集端的上拉电阻。
    2.  另一路输入至一个低压差线性稳压器 (LDO)，型号为 ME6211 (U2)。该 LDO 将 5V 电压转换为 3.3V，专门为 STM32G030F6P6 微控制器 (VDD) 以及 I2C 总线的上拉电阻供电。
*   **去耦电容:** 在 LDO 的输入和输出端以及 MCU 的 VDD 引脚附近配置了陶瓷电容（如 C1, C2, C4），用于电源滤波和稳定。

### 信号路径

*   **气体浓度信号路径:** MQ-5 传感器的传感引脚（A/B）与一个负载电阻（RL，如图中 R7）串联后接在 5V 和 GND 之间，构成一个分压电路。负载电阻 R7 两端的电压与气体浓度相关，该电压信号直接送入 MCU 的一个 ADC 通道（PA0）。
*   **温度补偿信号路径:** 一个 NTC 热敏电阻（RT1）与一个固定电阻（R6）串联，构成一个分压电路，其分压点连接至 MCU 的另一个 ADC 通道（PA1）。MCU 通过采集该点的电压来计算当前环境温度，用于对气体浓度读数进行补偿。

### 外设模块与电路连接

*   **MQ-5 气体传感器模块:**
    *   **传感元件:** 传感引脚 A 和 B 通过负载电阻 R7 连接到地，形成信号输出节点。
    *   **加热元件:** 加热引脚 H 和 H 串联一个加热电阻。该加热回路由一个 N-MOSFET (Q1) 控制。MOSFET 的漏极 (Drain) 连接加热元件一端，源极 (Source) 接地。5V 电源连接加热元件的另一端。
*   **加热控制电路:** MCU 的一个 GPIO 引脚（PB1，标记为 HEAT_EN）用于控制 MOSFET (Q1) 的栅极 (Gate)。
    *   当 HEAT_EN 输出高电平，MOSFET 导通，5V 电流流过加热元件，传感器开始加热（连续加热模式）。
    *   当 HEAT_EN 输出低电平或通过 PWM 信号控制时，MOSFET 关断或间歇导通，实现 heater 的关闭或间歇加热模式。
    *   栅极处有一个下拉电阻 R5，确保在 MCU 初始化期间 MOSFET 保持关断状态。

### 串口与通讯芯片

*   **通讯接口:** 电路采用 I2C 总线进行通信。
*   **I2C 引脚:** MCU 的 PB7 引脚用作 SDA (串行数据)，PB6 引脚用作 SCL (串行时钟)。
*   **上拉电阻:** SDA 和 SCL 信号线上各连接一个上拉电阻（R1, R2），上拉至 3.3V 电源。这确保了总线在空闲状态时为高电平，符合 I2C 协议规范。
*   **物理接口:** I2C 信号、5V 电源和 GND 通过一个 HY2.0-4P (Grove) 接口连接器 (J1) 引出。引脚定义为：GND, 5V, SDA, SCL。

### MCU 相关电路

*   **复位电路:** MCU 的 NRST 引脚通过一个上拉电阻 (R3) 连接到 3.3V，并通过一个电容 (C3) 连接到地，构成标准的上电复位电路。
*   **时钟源:** 电路未配置外部晶体振荡器，STM32G030F6P6 使用其内部的高速振荡器 (HSI)作为系统时钟源。
*   **编程/调试接口:** MCU 的 SWD (串行线调试) 接口引脚 PA14 (SWCLK) 和 PA13 (SWDIO) 被引出至测试点，用于固件烧录和在线调试。

---

## 补充信息

好的，基于已有的描述，以下是针对该原理图的补充说明，以提供更完整的技术细节：

### 补充说明

*   **电源域划分 (Power Domain Separation):** 电路中存在两个清晰的电源域。
    1.  **5V 电源域:** 这是一个相对高功率的域，专门用于驱动 MQ-5 传感器的加热元件，其电流由 MOSFET (Q1) 控制。
    2.  **3.3V 电源域:** 这是一个低功耗的逻辑和信号处理域，由 LDO (ME6211) 生成，为核心控制器 STM32G030F6P6 和 I2C 通信接口的上拉电阻提供稳定供电。这种分离设计可以避免加热器的大电流波动对 MCU 及通信总线造成干扰。

*   **ADC 内部参考电压 (ADC Internal Reference Voltage):** STM32G030F6P6 内部集成了一个精确的参考电压源 (VREFINT)。MCU 可以通过内部 ADC 通道测量这个参考电压的值。通过将 VREFINT 的读数与其实际的标称值进行比较，固件可以精确计算出当前的 Vdda (3.3V) 电压。这个过程对于 ADC 读数的校准至关重要，能够有效补偿因 LDO 输出偏差或负载变化引起的 3.3V 电源微小波动，从而提高气体浓度和温度测量的准确性。

*   **模拟信号调理 (Analog Signal Conditioning):** 气体传感器和热敏电阻的模拟信号采用了最简洁的无源调理方式。信号通过电阻分压网络后直接送入 MCU 的 ADC 引脚，电路中并未设计运算放大器（Op-Amp）等有源器件进行信号缓冲或放大。这意味着电路的设计依赖于分压电路的输出阻抗与 MCU ADC 的输入阻抗相匹配，以确保采样精度。

*   **I2C 地址配置 (I2C Address Configuration):** 尽管该单元的 I2C 地址是可配置的，但在所描述的电路图中并未体现用于硬件地址选择的跳线、拨码开关或专用地址引脚。这表明 I2C 地址的配置很可能是通过软件指令写入 MCU 内部的非易失性存储器（如 Flash 或 EEPROM）来实现的。上电后，MCU 读取该存储的地址值来初始化其 I2C 外设。

*   **测量精度相关元件 (Components Related to Measurement Accuracy):** 最终测量结果的准确性与模拟前端的无源元件特性密切相关。具体来说，负载电阻 R7、分压电阻 R6 以及 NTC 热敏电阻 RT1 的精度（公差）和温度系数（TCR）将直接影响气体浓度和温度值的计算精度。在精密测量应用中，这些元件通常会选用高精度、低温漂的型号。

---

*该文档由 AI 自动生成，生成时间: 2025-11-18 03:24:58*
