# Atom Socket-CN 原理图描述

---

## 原理图分析

好的，以下是根据 M5Stack Atom Socket-CN 原理图生成的结构化技术描述。

### M5Stack Atom Socket-CN 原理图解析

#### 1. 主要芯片及其功能

*   **主控单元 (M5_ATOM)**: 核心控制器为 M5Stack ATOM 模组。该模组通过 2.54mm 间距的排针与底座连接，利用其内建的 ESP32-PICO-D4 芯片（集成 WiFi 功能）实现设备逻辑控制、数据处理和无线通讯。
*   **电能计量芯片 (U2)**: 型号为 HLW8032。这是一款高精度的单相电能计量 IC，通过其内置的 ∑-Δ ADC 采集电压和电流信号。它负责计算有效电压、有效电流、有功功率、视在功率和功率因数等电能参数，并通过 UART 接口将数据发送给主控单元。

#### 2. 电路设计思想

该原理图设计了一个基于 M5Stack ATOM 的智能插座。其核心设计思想是：通过 HLW8032 芯片实时监测交流电负载的功耗参数，同时利用 ATOM 主控的 GPIO 控制一个继电器，从而实现对插座电源的通断控制和电能计量。整个系统集成了交流电源转换、电能计量、继电器控制和外部扩展接口，构成一个紧凑的物联网控制节点。

#### 3. 供电与充电电路

*   **AC-DC 转换模块 (U1)**: 采用 HLK-2M05 AC-DC 电源模块。该模块将输入的 85~264V 交流电直接转换为稳定的 +5V 直流电，为整个低压控制系统提供主电源。
*   **电源分配**: +5V 电源轨直接供给 M5Stack ATOM 模组（通过其 `5V` 引脚）、电能计量芯片 HLW8032（`VDD` 引脚）以及继电器 K1 的线圈。ATOM 模组内部自带 LDO，会将输入的 5V 转换为其核心工作所需的 3.3V。

#### 4. 电能计量电路 (HLW8032)

*   **电压采样网络**: 交流火线（L）的电压信号通过一个由多个 200kΩ 电阻（R3, R4, R5, R6, R7, R8）串联组成的高阻抗分压网络进行采样。分压后的信号送入 HLW8032 的电压采样输入引脚 `VIP` (Pin 5) 和 `VIN` (Pin 6)，其中 `VIN` 接地。
*   **电流采样网络**: 交流零线（N）的回路中串联了一个 1mΩ 的锰铜采样电阻 R1。负载电流流过该电阻产生的微小压降被送入 HLW8032 的电流采样输入引脚 `CIP` (Pin 3) 和 `CIN` (Pin 4) 进行测量。
*   **与主控通讯**: HLW8032 通过 UART 接口与 ATOM 主控进行单向通讯。其 `RXD` (Pin 8) 引脚连接到 ATOM 的 `G22` 引脚，用于向主控发送计量数据。芯片的 `SEL` (Pin 7) 引脚通过电阻 R10 接地，用于配置其工作模式。`TXD` (Pin 1) 引脚悬空，未使用。

#### 5. 继电器控制电路

*   **继电器 (K1)**: 使用一个 HONGFA HF32F-G/005-HS 型继电器，其触点额定值为 AC 250V@10A / DC 30V@10A。该继电器的常开（NO）触点串联在交流火线（L）通往输出插孔的路径上，用于控制负载的通断。
*   **驱动电路**: ATOM 主控的 `G23` 引脚作为继电器控制信号输出。该信号通过限流电阻 R11（1kΩ）驱动一个 S8050 NPN 型三极管 Q1。当 `G23` 输出高电平时，Q1 导通，使继电器 K1 的线圈通电吸合，接通负载电源。
*   **保护电路**: 二极管 D1 (1N4148) 与继电器线圈并联，作为续流二极管，用于在 Q1 截止时吸收线圈产生的反向感应电动势，保护驱动三极管 Q1。

#### 6. 信号路径与电路连接关系

*   **主控引脚映射**:
    *   `G22`: 连接至 HLW8032 的 `RXD` 引脚，作为 UART 输入，接收电能计量数据。
    *   `G23`: 连接至继电器驱动三极管 Q1 的基极，作为输出，控制继电器通断。
    *   `G33` 和 `G25`: 连接至外部 HY2.0-4P 接口，作为通用 IO 口。
*   **交流电源路径**: 交流电从 `CN-SOCKET` 的 L/N/E 输入，火线 L 经过继电器 K1 的 `COM` 和 `NO` 触点，然后输出至 `CN-SOCKET` 的负载端。零线 N 和地线 E 直接连通输入与输出。
*   **电气隔离**: 继电器 K1 的线圈（低压直流部分）与触点（高压交流部分）之间存在物理隔离，实现了控制电路与主电源负载之间的电气隔离。

#### 7. 外设模块与接口

*   **外部接口 (J1)**: 提供一个 HY2.0-4P 规格的 Grove 兼容接口。其引脚定义如下：
    *   Pin 1: `G33` (连接至 ATOM G33)
    *   Pin 2: `G25` (连接至 ATOM G25)
    *   Pin 3: `5V` (系统 +5V 电源)
    *   Pin 4: `GND` (系统地)
    此接口可用于连接外部传感器、按键或驱动其他外设。

---

## 补充信息

好的，在之前的基础上，可以对原理图中的一些细节和设计考虑进行补充，使描述更加全面。

### 补充技术细节

#### 1. 用户交互与状态指示

*   **继电器状态指示灯 (LED1)**: 在继电器 K1 的线圈两端，并联了一个由红色 LED (LED1) 和限流电阻 R2 (1kΩ) 组成的指示电路。当三极管 Q1 导通、继电器线圈得电吸合时，LED1 会同时点亮，为用户提供关于插座通电状态的直观视觉反馈。
*   **ATOM 内置接口**:
    *   **按键 (BUTTON)**: M5Stack ATOM 模组自带一个物理按键，该按键连接到其主控芯片的 `G39` 引脚。这个按键可由固件编程定义功能，例如手动切换继电器状态、触发配网模式等。
    *   **RGB LED**: ATOM 模组内部集成了一颗 WS2812 型可编程 RGB LED，连接到主控的 `G27` 引脚。该 LED 可用于通过不同的颜色和闪烁模式来指示设备的多种状态，如 Wi-Fi 连接状态、配置模式或故障告警。

#### 2. 电路稳定与保护设计

*   **电源去耦**: 在 +5V 电源轨上，布置了电解电容 C1 (10µF) 和贴片陶瓷电容 C2 (0.1µF)。C1 用于大容量滤波，稳定直流电压，抑制低频纹波；C2 用于高频去耦，滤除电路中的高频噪声，确保 M5_ATOM 和 HLW8032 等敏感芯片的供电纯净。
*   **续流保护**: 在继电器驱动电路中，二极管 D1 (1N4148) 的作用是续流二极管（Flyback Diode）。当 `G23` 从高电平变为低电平，三极管 Q1 截止时，继电器线圈由于电感特性会产生一个很高的反向感应电压。D1 为这个感应电流提供了一个释放回路，从而保护驱动三极管 Q1 免受高压击穿。

#### 3. 芯片配置细节

*   **HLW8032 工作模式配置**: 电能计量芯片 HLW8032 的 `SEL` 引脚通过电阻 R10 (1kΩ) 接地。根据其数据手册，将 `SEL` 引脚拉低，会使芯片工作在 UART 通讯模式下，并以 4800 bps 的波特率主动上报电能参数数据包。这是一个固定的硬件配置，决定了主控与其通信的方式。

#### 4. 电压采样网络细节

*   **高阻抗分压**: 火线（L）侧的电压采样网络总串联电阻为 1.2 MΩ (200kΩ * 6)。采用如此高的阻抗是为了将流经分压网络的电流限制在微安级别，从而显著降低采样电路自身的功耗，并确保在 220V 交流高压下的操作安全性。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 19:35:46*
