# Unit 4Relay 原理图描述

---

## 原理图分析

好的，这是根据您提供的原理图图片和提示词生成的 M5Stack Unit 4Relay (U097) 原理图技术描述。

***

### M5Stack Unit 4Relay (U097) 原理图描述

#### 主要芯片及其功能
- **微控制器 (MCU):** 核心控制器为意法半导体的 `STM32F030F4P6`。该芯片负责处理来自 I2C 总线的指令，其固件预设的 I2C 地址为 `0x26`。它通过通用输入/输出 (GPIO) 引脚，独立控制 4 路继电器和 4 个对应的状态指示 LED。
  - **PA9, PA10:** 分别用作 I2C 通讯的 SCL 和 SDA 信号线。
  - **PA0, PA1, PA4, PA5:** 用于输出控制信号，驱动 4 路继电器。
  - **PB1, PA7, PA6, PF0:** 用于输出控制信号，驱动 4 个 LED 指示灯。

#### 电路设计思想
该单元的电路设计思想是利用微控制器实现对多路大功率负载的 I2C 远程控制。I2C 通讯接口接收外部主控的指令，`STM32F030F4P6` 解析指令后，通过 GPIO 控制晶体管驱动电路，进而控制继电器线圈的通断电。继电器的机械触点则用于切换外部负载电路，实现了控制信号（低压直流）与负载（高压交/直流）之间的电气隔离。同时，每路继电器配有一个 LED 指示灯，其状态可通过 I2C 指令进行同步或独立控制。

#### 供电电路
- **输入电源:** 电路通过 HY2.0-4P (Grove) 接口的 `5V` 引脚获取电源。
- **电源分配:** 输入的 `5V` 电源直接供给 4 个继电器（K1, K2, K3, K4）的线圈，并作为板载线性稳压器（LDO）的输入。
- **稳压电路:** 板载一颗 `ME6211` 系列的低压差线性稳压器（LDO），将输入的 `5V` 电压转换为 `3.3V`。该 `3.3V` 电源（`VCC_3V3`）专门为 `STM32F030F4P6` 微控制器供电，并为 I2C 总线的上拉电阻提供参考电压。

#### 信号路径与逻辑电路
1.  **I2C 控制路径:** 外部主控通过 Grove 接口的 `SCL` 和 `SDA` 线与 `STM32F030F4P6` 的 `PA9` 和 `PA10` 引脚进行 I2C 通讯。`SCL` 和 `SDA` 信号线上各连接一个 `4.7KΩ` 的上拉电阻到 `3.3V` 电源。
2.  **继电器驱动路径:**
    - `STM32F030` 的 `PA0`, `PA1`, `PA4`, `PA5` 引脚分别输出高/低电平信号。
    - 每个控制信号通过一个 `1KΩ` 的电阻连接到一个 `S8050` NPN 型晶体管（Q1, Q2, Q3, Q4）的基极。
    - 当 MCU 引脚输出高电平时，对应的 NPN 晶体管导通，其集电极-发射极通路将继电器线圈的一端拉至 `GND`。
    - 继电器线圈的另一端恒接 `5V` 电源，因此晶体管导通时，线圈通电，继电器吸合。
    - 每个继电器线圈两端都并联一个 `1N4148` 续流二极管（D1, D2, D3, D4），用于在晶体管截止、线圈断电时吸收其产生的反向感应电动势，保护驱动晶体管。
3.  **LED 指示灯控制路径:**
    - `STM32F030` 的 `PB1`, `PA7`, `PA6`, `PF0` 引脚分别控制 4 个 LED（LED1, LED2, LED3, LED4）。
    - 每个 LED 的阴极连接到 MCU 的 GPIO 引脚，阳极通过一个 `1KΩ` 的限流电阻连接到 `3.3V` 电源。
    - 当 MCU 引脚输出低电平时，对应的 LED 点亮。
    - 通过内部寄存器 `0x10` 和 `0x11` 的配置，可实现 LED 与继电器状态同步或独立控制。

#### 外设模块与接口
- **通讯接口:** 1 个 HY2.0-4P Grove 接口 (PORT.A)，引脚定义为 `GND`, `5V`, `SDA`, `SCL`。
- **继电器:** 4 个型号为 `HFD27/005-S` 的继电器，其触点支持最大 `AC 250V / DC 28V` 的负载切换。额定电流为 `10A`。
- **负载输出端子:** 4 个 VH3.96-4P 接线端子，分别对应 4 路继电器。每个端子的引脚连接到其对应继电器的 `NC` (Normally Closed - 常闭)、`COM` (Common - 公共) 和 `NO` (Normally Open - 常开) 触点。其中一个引脚为空脚（NC，此处的NC指 Not Connected）。

#### 电路之间的连接关系
- **电源系统:** Grove 接口输入的 `5V` 和 `GND` 构成主电源。`5V` 一路直接为继电器线圈供电，另一路经 `ME6211` 降压至 `3.3V` 后为 `STM32F030` 微控制器供电。
- **控制与驱动系统:** `STM32F030` 作为控制核心，通过 I2C 接口接收指令。其 `3.3V` 逻辑电平的 GPIO 信号，通过 NPN 晶体管组成的驱动电路，转换为足以驱动 `5V` 继电器线圈的电流信号。
- **隔离关系:** 继电器的线圈部分属于低压控制电路，由板载 `5V` 供电；其触点部分则完全与控制电路电气隔离，用于连接和切换外部高压/大电流负载，确保了控制侧的安全性。

---

## 补充信息

在先前的描述基础上，可以补充以下技术细节，使原理图的解析更加完整：

#### 补充细节

1.  **微控制器启动与复位电路 (MCU Startup & Reset Circuit):**
    - `STM32F030F4P6` 的 `NRST` (复位) 引脚通过一个 `10KΩ` 电阻上拉至 `3.3V` 电源，同时通过一个 `0.1µF` 的电容接地。这种 RC 组合构成了标准的上电复位电路，确保微控制器在通电时能够可靠地从一个已知的初始状态开始运行。

2.  **调试与编程接口 (Debug & Programming Interface):**
    - 原理图上通常会引出 `STM32F030F4P6` 的串行线调试 (SWD) 接口信号。具体为 `SWDIO` (串行线数据输入/输出) 和 `SWCLK` (串行线时钟) 引脚，它们通常连接到板上的测试点 (Test Points)。该接口用于在生产阶段烧录固件，以及在开发过程中进行硬件调试。

3.  **电源去耦 (Power Supply Decoupling):**
    - 在 `STM32F030F4P6` 的 `VDD` (电源) 和 `VSS` (地) 引脚附近，配置了多个去耦电容（通常为 `0.1µF` 的陶瓷电容）。这些电容的作用是滤除电源线上的高频噪声，为微控制器提供一个稳定、干净的 `3.3V` 电源，这对于保证 MCU 内部逻辑电路的正常工作至关重要。

4.  **负载端子连接细节 (Load Terminal Connection Details):**
    - 对于每个 VH3.96-4P 输出端子，其引脚与继电器触点的对应关系通常是固定的。以其中一路为例，端子的引脚排列对应继电器的三个触点：
      - **COM (Common):** 公共端，外部电路的输入或输出线通常连接于此。
      - **NO (Normally Open):** 常开端，继电器未通电时，此端与 COM 端断开；通电吸合后，此端与 COM 端导通。
      - **NC (Normally Closed):** 常闭端，继电器未通电时，此端与 COM 端导通；通电吸合后，此端与 COM 端断开。
    - 用户根据应用需求，选择将负载电路连接在 `COM-NO` 之间（实现通电闭合）或 `COM-NC` 之间（实现通电断开）。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 23:55:27*
