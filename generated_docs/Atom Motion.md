# Atom Motion 原理图描述

---

## 原理图分析

好的，这是对 Atom Motion 原理图的详细技术描述。

### 主要芯片及其功能

*   **主控芯片 (U2): STM32F030F4P6**
    *   功能：作为整个模块的从控制器，负责与上位 ATOM 主控进行 I2C 通信，解析指令，并生成相应的 PWM 信号来控制舵机和直流电机。它还负责监控电池充电状态。
*   **电机驱动芯片 (U3): RZ7899**
    *   功能：这是一个双 H 桥直流电机驱动芯片。它接收来自 STM32 的四路 PWM 或逻辑电平信号（IN1-IN4），驱动两路直流电机（MOTOR_A, MOTOR_B）的正反转和调速。
*   **电池充电管理芯片 (U5): ETA4054**
    *   功能：线性锂电池充电管理芯片，负责对连接的 16340/18350 锂电池进行充电。它从 USB Type-C 接口获取 5V 输入，并提供充电状态指示（CHG, DONE）。
*   **锂电池保护芯片 (U4): DW01A-G**
    *   功能：单节锂电池保护 IC，与双 N-MOSFET (U6, FS8205A) 配合，提供过充电、过放电和过电流保护功能，确保电池使用安全。
*   **5V 升压芯片 (U1): SY7065**
    *   功能：同步升压转换器，将电池电压（VBAT_SW，范围约 3.0V-4.2V）提升至稳定的 5V，为舵机、直流电机驱动器以及外部 HY2.0 接口供电。
*   **3.3V 稳压芯片 (U7): SPX3819**
    *   功能：低压差线性稳压器 (LDO)，将 5V 电压降压至 3.3V，为 STM32F030F4P6 主控芯片提供稳定的工作电压。

### 电路设计思想

该电路的设计核心是构建一个由 STM32F030F4P6 控制的 I2C 从设备，用于扩展 ATOM 主控的电机和舵机驱动能力。ATOM 主控通过 I2C 总线发送指令，STM32 接收并解析后，通过其内部的定时器生成多路 PWM 信号。其中四路 PWM 信号直接驱动舵机，另外四路信号输入到 RZ7899 驱动芯片，以控制两路直流电机的速度和方向。整个系统由可充电锂电池独立供电，并通过板载升压和降压电路为不同部分提供所需的 5V 和 3.3V 电压。

### 供电与充电电路

*   **电源输入**: 电路支持两种供电方式：
    1.  通过 J2 (USB Type-C) 接口输入 5V (VBUS)，主要用于给电池充电。
    2.  通过 J11 (BAT) 接口连接 16340/18350 锂电池。
*   **充电电路**: USB VBUS 的 5V 电压连接到 ETA4054 (U5) 的 VIN 引脚。ETA4054 对连接在 BAT 引脚的电池进行充电。其 CHG 和 DONE 引脚通过 NPN 晶体管 Q1 和 Q2 连接到 STM32 的 PA11 和 PB0 引脚，允许 MCU 监控充电状态，并驱动充电状态指示灯 D1 和 D2。
*   **电池保护**: 电池正负极首先经过由 DW01A-G (U4) 和 FS8205A (U6) 组成的保护电路，然后输出受保护的电池电压 VBAT。
*   **电源开关**: 一个物理开关 SW1 控制着 VBAT 是否连接到后端电路，形成一个开关后的电池电压 VBAT_SW。
*   **电压转换**:
    *   **5V 生成**: VBAT_SW 输入到 SY7065 (U1) 升压电路。该电路通过电感 L1 (2.2uH) 和肖特基二极管 D3，将电池电压升压至 5V。
    *   **3.3V 生成**: 5V 电压输入到 SPX3819 (U7) LDO，输出稳定的 3.3V 电压。

### 信号路径

*   **I2C 通信路径**: 上位 ATOM 主控通过 J1 连接器的 I2C_SCL 和 I2C_SDA 引脚，与 STM32 (U2) 的 PB6 (I2C1_SCL) 和 PB7 (I2C1_SDA) 引脚通信。该 I2C 总线也通过 J9 和 J10 (HY2.0-4P) 接口引出，用于连接外部 I2C 传感器。总线上拉电阻 R3 和 R4 (4.7kΩ) 连接到 3.3V 电源。
*   **舵机控制路径**: STM32 的 PB1, PA0, PA1, PA3 引脚分别产生 PWM 信号，直接连接到舵机接口 J4, J5, J6, J7 的信号引脚，用于控制四路舵机。
*   **直流电机控制路径**: STM32 的 PA4, PA5, PA6, PA7 引脚产生 PWM 信号，分别连接到 RZ7899 (U3) 驱动芯片的 IN1, IN2, IN3, IN4 输入引脚。RZ7899 内部的 H 桥根据这些输入信号，驱动其输出端 OUT1/OUT2 (MOTOR_A) 和 OUT3/OUT4 (MOTOR_B) 的电平变化，从而控制连接在 J3 和 J8 上的两路直流电机的转动。

### 外设模块

*   **ATOM 主控接口 (J1)**: 提供与 ATOM 系列主控的连接，引出了 5V, 3.3V, GND, I2C_SCL, I2C_SDA, 以及两个 GPIO (PORT.B G25, PORT.C G21)。
*   **舵机接口 (J4, J5, J6, J7)**: 四个标准的 2.54mm 间距 3-Pin 接口，分别提供 5V、GND 和 PWM 信号，用于连接标准舵机。
*   **直流电机接口 (J3, J8)**: 两个 2-Pin 接口，用于连接两路直流电机。
*   **扩展接口 (J9, J10)**: 两个 HY2.0-4P 规格的接口（兼容 GROVE），引出了 I2C 总线 (SDA, SCL)、5V 和 GND，用于扩展 I2C 设备。

### 逻辑电路

*   **I2C 从机逻辑**: STM32F030F4P6 被编程为 I2C 从设备，其 I2C 地址固定为 0x38。它侦听来自 ATOM 主控的 I2C 写操作，根据写入的寄存器地址和数据，更新内部 PWM 的占空比。
*   **PWM 生成逻辑**: STM32 使用其内部的定时器/计数器模块 (TIM) 来生成多路独立的 PWM 信号。
    *   4 路 PWM 用于舵机，通过调节脉冲宽度（如 500-2500μs）来控制舵机角度。
    *   4 路 PWM（或逻辑电平组合）用于电机驱动，通过调节占空比来控制电机速度，通过控制 H 桥的输入组合来控制电机方向。

### 串口与通讯芯片

*   **通讯接口**: 主要通讯方式为 I2C。STM32F030F4P6 作为 I2C 从机，通过其硬件 I2C 控制器（连接到 PB6/PB7）与上位机通信。
*   **调试接口**: STM32 的 SWD 调试接口引脚 SWDIO (PA13) 和 SWCLK (PA14) 被引出到测试点 TP3 和 TP2，用于固件烧录和调试。

### 电源管理

*   **主电源轨**: VBAT_SW 是由电池经过保护和开关后形成的主电源轨。
*   **5V 电源轨**: 由 SY7065 从 VBAT_SW 升压产生，是模块中的功率电源轨，为 RZ7899 驱动芯片、所有舵机接口和外部 HY2.0 接口供电。
*   **3.3V 电源轨**: 由 SPX3819 从 5V 降压产生，是模块中的数字逻辑电源轨，专门为 STM32 主控芯片供电。

### 电路之间的连接关系

*   **控制核心**: STM32 (U2) 是整个电路的控制核心。它通过 3.3V LDO (U7) 获得供电。
*   **通信链路**: ATOM 接口 (J1) 和扩展接口 (J9, J10) 上的 I2C 总线与 STM32 的 I2C 引脚相连，构成统一的通信总线。
*   **驱动链路**: STM32 的 GPIO 输出分别连接到舵机接口 (J4-J7) 和电机驱动芯片 RZ7899 (U3)。
*   **电源分配**: 电池 (J11) 的电力经过保护电路 (U4, U6) 和开关 (SW1) 后，一路送至 5V 升压电路 (U1)，另一路通过充电芯片 (U5) 与 USB 接口 (J2) 相连。升压后的 5V 电源，一部分供给电机驱动 (U3) 和舵机，另一部分经过 3.3V LDO (U7) 后供给 STM32 (U2)。系统地 (GND) 为所有电路共享。

---

## 补充信息

好的，基于对原理图的进一步深入分析，以下是一些补充的技术细节和电路特性说明：

### 电路设计细节与补充

1.  **USB Type-C 电源路径**:
    *   J2 (USB Type-C) 接口的 VBUS (5V) 不仅为电池充电芯片 ETA4054 (U5) 供电，还直接连接到 ATOM 主控接口 J1 的 5V 引脚。这意味着，当 Atom Motion 通过 USB-C 连接电源时，即使其自身的电源开关 SW1 关闭，它也能为顶部的 ATOM 主控提供 5V 电源。

2.  **STM32F030F4P6 微控制器配置**:
    *   **启动模式**: BOOT0 引脚通过下拉电阻 R1 (10kΩ) 接地，确保 MCU 在上电或复位后默认从主闪存 (Main Flash memory) 启动。
    *   **复位电路**: NRST 引脚连接了由上拉电阻 R2 (10kΩ) 和电容 C10 (0.1uF) 组成的标准 RC 复位电路，提供上电复位和抗干扰能力。
    *   **时钟源**: 原理图中未显示为 STM32 配置外部晶体振荡器 (HSE)。这表明该 MCU 使用其内部的高速 RC 振荡器 (HSI) 作为系统时钟源，这是一种简化设计和节省成本的常见做法。

3.  **电机驱动电路的供电**:
    *   直流电机驱动芯片 RZ7899 (U3) 的电机电源引脚 VM 直接连接到由 SY7065 (U1) 生成的 5V 电源轨。这意味着电机驱动的电压是经过升压和稳压的，而非直接使用波动的电池电压 (VBAT)，这有助于在电池电量变化时提供更稳定的电机性能。
    *   在 VM 引脚附近配置了大容量的电解电容 C8 (100uF) 和一个陶瓷电容 C13 (0.1uF)，用于电源滤波和去耦，吸收电机启动和换向时产生的高频噪声和电流冲击，保证电源稳定性。

4.  **GPIO 扩展连接**:
    *   ATOM 接口 (J1) 上的 PORT.B (G25) 和 PORT.C (G21) 信号，分别连接到 STM32 (U2) 的 PA10 和 PA9 引脚。这两个引脚可由 STM32 编程为通用输入/输出，用于与 ATOM 主控进行额外的数字信号交互，例如状态上报或触发信号。

5.  **电流控制与保护的实现**:
    *   原理图中没有为 RZ7899 设计外部的电流采样电阻。因此，提示词中提到的“峰值电流 1A/通道”应为 RZ7899 芯片内部集成的过流保护 (OCP) 功能的阈值，而非通过外部电路实现的可编程电流控制。当输出电流超过芯片内部设定值时，芯片会自动关断输出以保护自身和电机。

6.  **I2C 总线设计**:
    *   扩展接口 J9 和 J10 的 I2C 引脚与主控 STM32 (U2) 和 ATOM 接口 (J1) 的 I2C 引脚是并联在同一条总线上的。所有连接到这条总线上的设备共享上拉电阻 R3 和 R4。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 19:30:45*
