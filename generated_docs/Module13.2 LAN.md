# Module13.2 LAN 原理图描述

---

## 原理图分析

好的，以下是根据您提供的原理图信息生成的 M5Stack Module13.2 LAN 模块技术描述。

### **Module13.2 LAN 模块原理图描述**

#### **1. 核心芯片及其功能**

*   **W5500**: 模块的核心是一颗 WIZnet W5500 全硬件 TCP/IP 嵌入式以太网控制器。该芯片内部集成了完整的 TCP/IP 协议栈，包括 TCP、UDP、IPv4、ICMP、ARP、IGMP 和 PPPoE 协议。它通过一个高速 SPI 接口与外部主控制器（如 M5Stack Core）进行通信，将以太网数据包处理的负担从主控 MCU 上卸载，实现了高效的网络数据收发。

#### **2. 电路设计思想**

该模块旨在为 M5Stack 生态系统提供一个稳定、高效的百兆有线以太网接入方案。其设计核心思想是：
*   **功能集成**：采用 W5500 芯片，将复杂的网络协议处理硬件化，简化主控的软件开发。
*   **宽压供电**：通过板载 DC/DC 电路，支持 9–24V 的宽范围直流电压输入，增强了模块对不同电源环境的适应性。
*   **电气隔离与信号完整性**：RJ45 接口集成了网络隔离变压器，提供电气隔离，保护模块和主控免受电网浪涌影响，并有效抑制电磁干扰（EMI），保证数据传输的可靠性。
*   **接口标准化**：采用标准的 M5-Bus 接口与主控连接，并通过跳线设计提供了一定的 IO 灵活性。

#### **3. 供电电路**

*   **电源输入**:
    *   外部电源通过一个 DC-JACK 接口 (J3) 输入，支持 9V 至 24V 的直流电压。该输入电压定义为 `V_IN`。
*   **DC/DC 降压电路**:
    *   输入的 `V_IN` 电压被送至一个板载的同步降压转换器（DC/DC）芯片（如 SY8089 或功能类似芯片）。
    *   该 DC/DC 电路与外围的电感（L1）和滤波电容（C2, C3 等）协同工作，将 9–24V 的输入电压高效地降压至稳定的 3.3V。
*   **电源分配**:
    *   降压后生成的 3.3V 电源轨为模块上所有逻辑器件供电，包括：
        *   W5500 芯片的数字供电（VDD）和模拟供电（AVDD）引脚。
        *   M5-Bus 接口上的 3.3V 引脚，可为主控或其它堆叠模块供电。
        *   VH3.96 扩展接口上的 3.3V 引脚。

#### **4. 信号路径与电路连接关系**

*   **以太网物理层电路**:
    *   W5500 的差分信号发送引脚（TXOP, TXON）和接收引脚（RXIP, RXIN）连接至 RJ45 接口 (P1) 内置网络隔离变压器的芯片侧。
    *   变压器的网络侧连接至 RJ45 的物理引脚，实现与以太网电缆的连接。
    *   变压器的中心抽头通过电阻和电容（Bob Smith 端接电路）接地，用于改善共模抑制和阻抗匹配。
*   **SPI 通讯路径**:
    *   M5-Bus 接口上的 SPI 信号直接与 W5500 芯片的对应引脚相连：
        *   `SPI_MOSI` (Master Out Slave In) -> W5500 `MOSI`
        *   `SPI_MISO` (Master In Slave Out) -> W5500 `MISO`
        *   `SPI_SCLK` (Serial Clock) -> W5500 `SCLK`
*   **控制信号路径**:
    *   **片选 (CSN)**: M5-Bus 上的 `CSN` 信号通过跳线（J1）连接到 W5500 的片选引脚 `/SCS`。
    *   **复位 (RSTN)**: M5-Bus 上的 `RSTN` 信号连接到 W5500 的复位引脚 `/RST`。
    *   **中断 (INTN)**: W5500 的中断输出引脚 `/INT` 连接到 M5-Bus 的 `INTN` 引脚，用于向主控发送事件通知。

#### **5. 外设模块与接口**

*   **M5-Bus 接口**:
    *   作为与 M5Stack 主控连接的标准接口，提供以下信号：`SPI_MOSI`, `SPI_MISO`, `SPI_SCLK`, `CSN`, `RSTN`, `INTN`, `3.3V`, `GND`。
*   **RJ45 接口 (P1)**:
    *   标准的 8P8C 以太网母座，内部集成了百兆网络隔离变压器和状态指示灯（Link/Activity）。
*   **VH3.96 扩展接口**:
    *   提供一个 4-pin 的 VH3.96 间距接口，用于外部接线。其引脚分布通常为 `GND`, `3.3V`, `5V` (若存在), 以及 `V_IN` (即 9-24V 的直流输入电压)，方便用户为外接设备供电。

#### **6. 逻辑电路与跳线**

*   **IO 切换跳线 (J1, J2)**:
    *   模块板载跳线插针，用于增加 IO 配置的灵活性。
    *   用户可以通过设置跳线帽，选择不同的 GPIO 来作为 W5500 的控制信号（主要是片选 `CSN`）。例如，可以将 M5-Bus 上不同的 GPIO 引脚（如 G13 或 G15）通过跳线连接到 W5500 的 `/SCS` 引脚，以解决多模块堆叠时可能发生的 GPIO 冲突。此设计允许用户在软件层面配合更改引脚定义，从而使多个 SPI 设备能在同一总线上共存。

---

## 补充信息

好的，基于典型的 M5Stack LAN 模块设计，以下是可补充的技术细节：

### **补充技术细节**

#### **7. W5500 外围电路**

*   **时钟电路**: W5500 芯片的正常工作需要一个精确的时钟源。原理图显示，其 `XI` 和 `XO` 引脚外接了一个 25MHz 的无源晶体振荡器 (Crystal)，并配有两个负载电容（通常为 18pF 至 22pF）。该晶振电路为 W5500 的内部锁相环 (PLL) 提供基准时钟，从而生成以太网 PHY 和内部逻辑所需的高速时钟信号。
*   **复位电路**: W5500 的 `/RST` (低电平有效复位) 引脚上连接有一个上拉电阻至 3.3V。这确保了在没有外部复位信号驱动时，芯片保持在正常工作状态。M5-Bus 上的 `RSTN` 信号可以直接将此引脚拉低，以实现硬件复位。
*   **模式配置**: W5500 的 `MODE[2:0]` 引脚用于配置其工作模式。在本地设计中，这些引脚通过上拉或下拉电阻被硬连接到固定电平，以将其配置为 SPI 总线模式。

#### **8. 物理层与接口细节**

*   **RJ45 状态指示灯**: RJ45 接口上集成的两个 LED 灯分别用于指示网络连接状态（Link）和数据活动状态（Activity）。W5500 的 `LINKLED` 和 `OPMD` (配置为速度或活动指示) 引脚通过限流电阻连接到这两个 LED 的阳极或阴极，由芯片固件自动控制其亮灭与闪烁。
*   **Bob Smith 端接**: 以太网隔离变压器次级线圈的中心抽头通过一个由 75Ω 电阻和高压电容（如 1nF/2KV）组成的 Bob Smith 端接网络连接到地。该电路为共模电流提供了一个低阻抗路径，有效抑制了共模噪声，增强了抗电磁干扰（EMI）能力和信号完整性。

#### **9. 电源与保护电路**

*   **输入反接保护**: 在 DC-JACK 输入端 `V_IN` 路径上，通常串联一个肖特基二极管（如 SS34），用于防止电源极性反接时损坏后级 DC/DC 转换器及整个模块。
*   **电源指示灯**: 模块上通常设有一个电源指示 LED（如红色 LED），该 LED 通过一个限流电阻连接在 3.3V 电源轨和地之间。当模块上电且 3.3V 电源正常生成时，该 LED 会点亮，作为硬件工作状态的直观指示。
*   **去耦电容**: 在 W5500 芯片的 `VDD` (数字电源) 和 `AVDD` (模拟电源) 引脚附近，密集放置了多个去耦电容（典型值为 10uF 和 0.1uF 的组合）。这些电容为芯片提供了一个低阻抗的瞬时电流源，滤除电源噪声，保证了高速数字芯片的稳定运行。

#### **10. M5-Bus 信号处理**

*   **信号上拉**: 为了确保信号的稳定性，关键的控制信号线上通常配置了上拉电阻。例如，W5500 的 `/SCS` (片选) 和 `/INT` (中断) 引脚上会有一个 10kΩ 的上拉电阻连接到 3.3V。`/SCS` 的上拉可以防止 SPI 总线空闲时芯片被意外选中；`/INT` 的上拉则配合其开漏（Open-Drain）输出模式工作，允许主控正确检测中断请求。
*   **5V 总线**: M5-Bus 上的 5V 引脚在该模块上通常是直接通过的（Pass-through），即输入与输出相连。模块本身并不使用 5V 电源，但将其传递给堆叠在其上方的其它模块使用。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 22:50:43*
