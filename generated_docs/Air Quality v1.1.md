# Air Quality v1.1 原理图描述

---

## 原理图分析

好的，这是基于您提供的原理图信息生成的 Air Quality v1.1 技术描述。

***

### 1. 主控单元
设备主控为 **Stamp-S3A** 模块，其核心是 **ESP32-S3FN8** SoC。该 SoC 搭载双核 Xtensa LX7 处理器，并集成 **8MB Flash** 存储。Stamp-S3A 负责处理所有传感器数据、驱动显示屏、管理电源状态以及响应用户输入。

### 2. 电源管理系统
该系统设计围绕低功耗运行，支持多种供电和唤醒方式。

*   **2.1 供电来源**:
    *   **USB-C**: 提供 5V (VBUS) 输入，用于系统供电和电池充电。
    *   **锂电池**: 一块 **600mAh@3.7V** 的锂电池 (VBAT) 作为移动供电来源。

*   **2.2 电池充电电路**:
    *   系统集成了一个充电管理电路。当 USB-C 接口接入 5V 电源时，该电路为 3.7V 锂电池进行充电。

*   **2.3 系统供电与稳压**:
    *   系统存在一个主电源稳压电路，将 VBAT 或 VBUS 的电压转换为 3.3V，为 Stamp-S3A 主控、显示屏及其他主要外设供电。
    *   **RTC8563** 芯片直接由电池 (VBAT) 供电，以在主系统断电时维持计时功能。
    *   传感器电源由一个独立的控制电路管理。主控通过 **G10 (AirPWREN)** 引脚的高低电平，控制一个开关电路，从而决定是否为 SEN55 和 SCD40 传感器提供 3.3V 电源。这允许在不使用传感器时将其完全断电以节省功耗。

*   **2.4 关机、保持与唤醒逻辑**:
    *   **电源保持 (HOLD)**: 主控的 **GPIO46** 连接到电源系统的 **HOLD** 控制引脚。系统开机后，主控必须立即将 GPIO46 置为高电平，以自锁维持主电源的开启状态。当主控需要关机时，将 GPIO46 置为低电平即可切断主电源。
    *   **唤醒 (WAKE)**: **RTC8563** 的中断输出引脚连接到电源系统的 **WAKE** 控制引脚，同时该信号也连接到主控的 **GPIO42**。当 RTC 达到预设的闹钟时间，其会产生一个低电平脉冲，触发电源系统上电。上电后，主控通过读取 GPIO42 的状态可以判断是否由 RTC 唤醒。

*   **2.5 电池电压检测**:
    *   电池电压 (VBAT) 经过一个分压电路后，连接到主控的 **G14** 引脚。主控可通过此引脚的 ADC 功能读取分压后的电压值，从而估算电池剩余电量。

### 3. 显示单元
*   **型号**: **1.54 英寸墨水屏 GDEY0154D67**，分辨率为 200x200。
*   **接口类型**: **SPI**。
*   **信号路径**:
    *   `BUSY` -> `G1`
    *   `RST` -> `G2`
    *   `D/C` -> `G3`
    *   `CS` -> `G4`
    *   `SCK` -> `G5`
    *   `MOSI` -> `G6`

### 4. 传感器系统
设备集成两款环境传感器和一款 RTC 芯片，它们共享同一 I2C 总线。

*   **I2C 总线**:
    *   `SDA` -> `G11`
    *   `SCL` -> `G12`
*   **板载设备**:
    *   **SEN55**: 多合一环境传感器，I2C 地址为 **0x69**。
    *   **SCD40**: CO2 传感器，I2C 地址为 **0x62**。
    *   **RTC8563**: 低功耗实时时钟，用于定时和唤醒功能，同样通过 I2C 总线进行配置。
*   **供电控制**: SEN55 和 SCD40 的电源受主控 **G10 (AirPWREN)** 引脚控制。

### 5. 输入/输出单元
*   **按键 A**: 连接到 **G0**，外部上拉，按下时引脚电平为低。
*   **按键 B**: 连接到 **G8**，外部上拉，按下时引脚电平为低。
*   **蜂鸣器 (beep)**: 一个无源蜂鸣器，其驱动电路由一个三极管构成，受主控 **G9** 引脚的 PWM 信号控制。

### 6. 外部接口
*   **接口类型**: **HY2.0-4P Grove 接口**。
*   **引脚定义与连接**:
    *   **Pin 1 (Black)**: `GND`
    *   **Pin 2 (Red)**: `5V` (来源于 USB VBUS)
    *   **Pin 3 (Yellow)**: 连接到主控的 `G13`
    *   **Pin 4 (White)**: 连接到主控的 `G15`

---

## 补充信息

基于对电路设计的进一步分析，可以补充以下技术细节和设计要点：

*   **USB-C 功能扩展**: 除了提供 5V 供电与充电功能，USB-C 接口的 D+ 和 D- 数据线也直接连接到 Stamp-S3A (ESP32-S3) 的原生 USB 引脚。这意味着该接口不仅用于供电，还支持 **USB-OTG** 功能，可用于固件烧录、USB CDC 串行通信和调试，无需额外的 USB-to-UART 转换芯片。

*   **Grove 接口电源特性**: Grove 接口的 5V 电源引脚直接取自 USB-C 的 VBUS。因此，该接口的 5V 输出仅在 **USB-C 接口连接外部电源时** 才可用，在使用电池独立供电时，此引脚无电压输出。

*   **I2C 总线设计**: I2C 总线 (SDA-G11, SCL-G12) 上配置了上拉电阻。这是 I2C 协议所必需的，因为 I2C 是一种开漏/开集电极总线，需要外部上拉电阻将总线电平在空闲时维持在高电平状态。

*   **蜂鸣器驱动电路**: G9 引脚并非直接驱动无源蜂鸣器，而是通过控制一个 NPN 三极管的基极来实现。这种设计利用三极管的开关和电流放大作用，解决了 GPIO 引脚直接驱动能力不足的问题，能够为蜂鸣器提供足够的驱动电流。

*   **典型的低功耗工作循环**: 整个电路设计体现了一个清晰的低功耗工作模式：
    1.  **深度休眠**: 主控将 G46(HOLD) 拉低，切断自身及外设（传感器、屏幕）的 3.3V 主电源，仅 RTC 和电源管理逻辑由电池供电，实现纳安或微安级的休眠功耗。
    2.  **定时唤醒**: RTC8563 到达预设时间，通过其INT引脚输出一个低电平脉冲至 WAKE 引脚，触发电源系统重新上电。
    3.  **启动与自锁**: 主控 Stamp-S3A 启动后，立即将 G46(HOLD) 置高，锁定电源。
    4.  **工作任务**: 主控通过 G10(AirPWREN) 为传感器上电，经由 I2C 总线读取数据，然后通过 SPI 接口将数据更新至墨水屏。
    5.  **返回休眠**: 完成任务后，再次将 G46(HOLD) 拉低，进入下一个休眠周期。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 20:12:25*
