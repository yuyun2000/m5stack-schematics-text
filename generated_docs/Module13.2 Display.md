# Module13.2 Display 原理图描述

---

## 原理图分析

### Module13.2 Display 模块原理图解析

#### 1. 主要芯片及其功能

*   **FPGA (U1): GW1NR-LV9QN88C6-I5 (QN88 封装)**
    *   **功能**: 作为模块的核心控制器和信号处理器。负责接收来自 M5-Bus 的指令，生成 24 位并行 RGB 视频信号 (R[7:0], G[7:0], B[7:0])、像素时钟 (PCLK)、行场同步信号 (HSYNC, VSYNC)，以及多达 4 通道的 I2S 音频数据 (I2S_SD[3:0])、时钟 (I2S_SCK) 和帧同步信号 (I2S_WS)。
    *   **供电**:
        *   核心电压 `VCC`: 1.2V (来自 `VCC1V2`)。
        *   I/O 电压 `VCCIO[0/1/2/3]`: 3.3V (来自 `VCC3V3`)。
        *   PLL 等辅助电压 `VCCX`: 1.8V (来自 `VCC1V8`)。

*   **HDMI 发射器 (U4): LT8616SXB (QFN-48 封装)**
    *   **功能**: 将 FPGA 输出的并行 RGB 视频信号和 I2S 音频信号编码转换为标准的 HDMI 1.4 TMDS 差分信号。该芯片通过 I2C 总线 (HDMI_SCL, HDMI_SDA) 由 FPGA 进行配置，I2C 地址为 0x39。
    *   **供电**:
        *   数字 I/O 电压 `DVDD`: 3.3V (来自 `VCC3V3`)。
        *   数字核心电压 `VDD`、模拟电压 `VCCA` 及 PLL 电压 `VCCAPLL`: 1.8V (来自 `VCC1V8`)。

#### 2. 电路设计思想与信号路径

*   **视频信号路径**: FPGA (U1) 内部逻辑生成 24 位 RGB 数据、PCLK、HSYNC 和 VSYNC 信号，通过其 I/O 引脚直接输出至 LT8616SXB (U4) 的对应数据输入引脚。
*   **音频信号路径**: FPGA (U1) 生成 I2S 格式的音频流 (I2S_SCK, I2S_WS, I2S_SD0-I2S_SD3)，同样输入至 LT8616SXB (U4) 的 I2S 接口。
*   **HDMI 输出**: LT8616SXB (U4) 将接收到的音视频数据合成为 HDMI 信号，并通过其 TMDS 输出引脚 (TXC+/-, TX0+/-, TX1+/-, TX2+/-) 连接至标准 HDMI A 型接口 (J2)。
*   **控制路径**: FPGA (U1) 作为 I2C 主机，通过 `HDMI_SCL` 和 `HDMI_SDA` 信号线与作为从机的 LT8616SXB (U4) 通信，以进行初始化配置、分辨率设置等操作。这两条信号线通过电阻 R15 和 R16 上拉至 `VCC3V3`。

#### 3. 供电与电源管理

*   **电源输入**: 外部电源通过 DC JACK (J4) 输入，电压范围为 9V 至 24V。输入端配置有二极管 D1 用于防反接保护。

*   **一级降压 (9-24V 转 5V)**:
    *   **芯片**: SY8303 (U2)，为一颗 DC-DC Buck 转换器。
    *   **电路**: 输入电压经 U2、电感 L1 及外围滤波电容 (C1, C2, C5, C8) 转换为稳定的 5V 电压 (`VIN_5V`)。此路电源的使能由开关 SW1 控制，当 SW1 闭合时，`EN_5V` 信号将 U2 的 EN 引脚拉低，启动 5V 输出。

*   **二级降压 (5V 转 3.3V 和 1.2V)**:
    *   **芯片**: SY8089 (U3)，为一颗双路输出的 DC-DC Buck 转换器。
    *   **电路**:
        *   **3.3V 输出 (`VCC3V3`)**: `VIN_5V` 输入至 U3，经其内部一路开关稳压器和外部电感 L2 产生，为 FPGA I/O、LT8616SXB 数字 I/O 以及 M5-Bus 提供 3.3V 供电。
        *   **1.2V 输出 (`VCC1V2`)**: `VIN_5V` 经 U3 的另一路开关稳压器和外部电感 L3 产生，专门为 FPGA 的核心 (`VCC`) 供电。

*   **LDO 稳压 (5V 转 1.8V)**:
    *   **芯片**: LP5907 (U5)，为一颗低压差线性稳压器 (LDO)。
    *   **电路**: `VIN_5V` 输入至 U5，输出稳定的 1.8V 电压 (`VCC1V8`)。此电源主要供给 FPGA 的 `VCCX` 引脚以及 LT8616SXB 的模拟和核心部分 (`VCCA`, `VCCAPLL`, `VDD`)。

#### 4. 外设接口与连接关系

*   **M5-Bus 接口 (J1)**:
    *   提供与 M5Stack 主控的连接。
    *   **电源**: 包含 `5V` (来自 `VIN_5V`)、`3V3` (来自 `VCC3V3`) 和 `GND`。
    *   **通信**:
        *   I2C: `SCL`, `SDA` 引脚连接至 FPGA 的 I/O，用于主控与 FPGA 间的通信。
        *   SPI: `MOSI`, `MISO`, `CLK` 引脚连接至 FPGA 的 I/O，提供备选的高速通信方式。
    *   **GPIO**: G26, G36 等引脚也直接连接到 FPGA，可用于中断或通用 I/O。

*   **JTAG 接口 (J3)**:
    *   标准的 2x5 JTAG 调试和编程接口。
    *   `TCK`, `TMS`, `TDI`, `TDO` 信号直接连接至 FPGA (U1) 对应的 JTAG 引脚。
    *   `VREF` 引脚连接至 `VCC3V3`，为 JTAG 适配器提供参考电平。

*   **时钟电路**:
    *   一个 27MHz 的有源晶体振荡器 (Y1) 为 FPGA (U1) 提供主时钟源 (`CLK_27M`)，FPGA 内部的 PLL (锁相环) 利用此基准时钟生成系统所需的各种工作时钟，如像素时钟和逻辑时钟。

---

## 补充信息

好的，以下是基于前述分析的补充细节与电路逻辑：

### 补充细节与电路逻辑

#### 5. FPGA 配置电路

*   **SPI Flash 存储器 (U6):** 电路板上集成了一颗 SPI Flash 芯片（如 W25Q32JVSSIQ）。
    *   **功能**: 用于存储 FPGA (U1) 的配置文件（bitstream）。
    *   **连接关系**: 该 Flash 芯片通过专用的 SPI 接口（`F_CS`, `F_CLK`, `F_MOSI`, `F_MISO`）与 FPGA 连接。这些引脚独立于 M5-Bus 上的 SPI 接口。
    *   **启动过程**: 在上电复位后，FPGA 会自动进入 Master SPI 模式，从 U6 中读取配置文件并完成自身逻辑的加载。FPGA 的 `DONE` 引脚（通过 R10 上拉至 `VCC3V3`）输出高电平，标志着配置成功。

#### 6. 关键控制信号与状态反馈

*   **HDMI 热插拔检测 (HPD)**:
    *   HDMI 接口 (J2) 的 `HPD` (Hot Plug Detect) 引脚通过电阻 R18 连接到 FPGA 的一个 I/O 口。
    *   **信号流**: 当 HDMI 显示设备连接时，该引脚被设备拉高，FPGA 通过监测此信号电平，可以判断显示设备是否已连接，从而触发或停止 HDMI 信号的输出。

*   **HDMI 发射器复位**:
    *   FPGA 的一个 I/O 引脚（`HDMI_RST`）连接到 LT8616SXB (U4) 的 `RST_N` 引脚。
    *   **功能**: FPGA 可以通过该信号对 HDMI 发射器芯片进行硬件复位，确保其在配置前处于已知的初始状态。

*   **HDMI CEC 和 DDC**:
    *   HDMI 接口的 `CEC` (Consumer Electronics Control) 引脚直接连接至 FPGA，允许实现设备间的联动控制。
    *   HDMI 接口的 `DDC_SCL` 和 `DDC_SDA` 引脚用于显示设备与信号源之间的 EDID (Extended Display Identification Data) 信息交换。在本设计中，这些信号与 FPGA 控制 LT8616SXB 的 I2C 总线 (`HDMI_SCL`, `HDMI_SDA`) 相连，使得 FPGA 能够读取显示设备支持的分辨率等信息。

#### 7. 电路保护与信号完整性设计

*   **ESD 保护**:
    *   在 HDMI 接口 (J2) 的高速 TMDS 差分信号线 (TX0-TX2, TXC) 和控制信号线 (DDC, CEC, HPD) 上，部署了一颗或多颗 ESD（静电放电）保护器件 (如 U7)。
    *   **功能**: 这些器件用于吸收和抑制来自外部接口的静电冲击，保护后端敏感的 LT8616SXB 和 FPGA 芯片。

*   **电源滤波与去耦**:
    *   **磁珠 (Ferrite Beads)**: 在电源路径上，例如为 LT8616SXB 的模拟电源 `VCCA` 和 `VCCAPLL` 供电的线路上，使用了磁珠 (FB1, FB2)。它们用于隔离数字电源噪声，为模拟电路部分提供更纯净的电源，以保证视频信号质量。
    *   **去耦电容**: 在 FPGA (U1) 和 LT8616SXB (U4) 的每个电源引脚附近，都放置了大量的去耦电容（通常为 0.1uF 或 0.01uF）。它们的作用是滤除高频噪声，为芯片提供瞬时电流，保证高速数字电路的稳定运行。同时，每个电源轨也配置有较大容量的钽电容或电解电容（如 10uF, 22uF）作为储能电容。

*   **信号阻抗匹配**:
    *   从 FPGA 到 LT8616SXB 的 RGB 数据线和时钟线，以及从 LT8616SXB 到 HDMI 接口的 TMDS 差分线，其 PCB 走线均遵循严格的阻抗控制规则（例如，单端 50 欧姆，差分 100 欧姆），以最大限度地减少信号反射和衰减，确保高速信号的完整性。

---

*该文档由 AI 自动生成，生成时间: 2025-11-17 22:28:07*
