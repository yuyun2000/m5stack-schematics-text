# Unit PoE CAM-W v1.1 原理图描述

---

## 原理图分析

好的，以下是基于 Unit PoE CAM-W v1.1 原理图的详细技术描述。

### **1. 主要芯片及其功能**

*   **主控单元 (MCU):** 核心控制器为 ESP32-WROVER-E 模组 (U1)，内置 ESP32-D0WDQ6-V3 双核处理器。该模组集成了 Wi-Fi 和蓝牙功能，并通过外部连接了 16MB SPI Flash (U3, W25Q128JVSIQ) 用于程序存储和 8MB PSRAM (U2, IPUS80M16S) 用于扩展内存。
*   **以太网控制器:** 采用 W5500 芯片 (U7)，它是一个集成了 TCP/IP 协议栈、10/100Mbps 以太网 MAC 和 PHY 的全硬件网络接口芯片。W5500 通过 SPI 接口与主控 ESP32 通信，负责处理所有以太网数据链路层及以上的协议，减轻主控负担。
*   **图像传感器:** 摄像头模块采用 OV3660 图像传感器，通过一个 24-Pin FPC 连接器 (J2) 连接到主板。该传感器支持最高 300 万像素分辨率，其控制和配置通过 SCCB (一个 I2C 兼容接口) 进行，图像数据通过 8-bit DVP (Digital Video Port) 并行接口传输至 ESP32。

### **2. 供电与充电电路**

*   **PoE 供电:** 电源由符合 IEEE 802.3af 标准的 RJ45 接口 (J1) 引入。48V 的 PoE 电源通过以太网变压器 (T1) 的中心抽头被送至板载 PoE 模块 (U5, PM-1205-E)。
*   **电源转换与隔离:**
    1.  PoE 模块 (U5) 是一个隔离型 DC-DC 转换器，它将来自 RJ45 的高压 PoE 电源转换为隔离的 5V 直流电 (VBUS)。
    2.  该 5V 电源作为系统的主电源输入，一方面直接供给 Grove 接口，另一方面输入到一个同步降压转换器 (U6, SY8009A)。
    3.  SY8009A 芯片 (U6) 将 5V 电压高效地降压至 3.3V (VCC_3V3)，为 ESP32 模组、W5500 芯片、Flash、PSRAM 及其他逻辑电路提供核心工作电压。
*   **地线隔离:** 电路设计中存在两个独立的地：初级侧的 `PGND` 和次级侧的 `GND`。两者通过 PoE 模块 (U5) 和以太网变压器 (T1) 实现了电气隔离，增强了系统的抗干扰能力和安全性。

### **3. 信号路径与电路连接关系**

*   **ESP32 与 W5500 的连接 (SPI):** 两者通过一个标准的 4 线 SPI 总线进行通信。
    *   `GPIO18` (ESP32) -> `SCLK` (W5500)
    *   `GPIO19` (ESP32) -> `MISO` (W5500)
    *   `GPIO23` (ESP32) -> `MOSI` (W5500)
    *   `GPIO5` (ESP32) -> `SCSn` (片选)
    *   此外，W5500 的复位引脚 `RSTn` 由 ESP32 的 `GPIO21` 控制，中断引脚 `INTn` 连接到 ESP32 的 `GPIO34`。

*   **ESP32 与 OV3660 的连接 (DVP & SCCB):**
    *   **并行数据接口 (DVP):** 8-bit 图像数据线 (D2-D9) 连接到 ESP32 的 GPIOs：`GPIO35`, `GPIO34`, `GPIO39`, `GPIO36`, `GPIO15`, `GPIO12`, `GPIO13`, `GPIO4`。
    *   **时钟与同步信号:**
        *   `PCLK` (像素时钟) -> `GPIO22`
        *   `VSYNC` (垂直同步) -> `GPIO27`
        *   `HREF` (水平参考) -> `GPIO26`
    *   **控制接口 (SCCB):**
        *   `SIO_C` (串行时钟) -> `GPIO25`
        *   `SIO_D` (串行数据) -> `GPIO32`
    *   **控制信号:** 摄像头的 `PWDN` (掉电) 引脚由 `GPIO33` 控制，`RESET` 引脚连接到系统主复位线 `EN`。

*   **以太网信号路径:** RJ45 接口的差分信号对 (TX+/-, RX+/-) 首先进入以太网网络变压器 (T1, HR601680)。变压器完成信号的耦合与电气隔离，然后将信号传递给 W5500 芯片的相应收发引脚 (TXP/TXN, RXP/RXN)。

### **4. 外设模块与接口**

*   **Grove 接口 (J3):** 提供一个标准的 4-Pin Grove 接口，用于扩展 I2C 或其他传感器模块。
    *   `SCL`: 连接到 `GPIO33`。
    *   `SDA`: 连接到 `GPIO25`。此引脚与摄像头 SCCB 接口的 `SIO_C` 共享。
    *   `5V`: 直接取自 PoE 模块输出的 5V (VBUS)。
    *   `GND`: 系统地。
*   **按键与 LED:**
    *   一个物理按键 (SW1) 连接到 `GPIO37`，按下时将引脚拉低。该引脚通过电阻 R10 上拉至 3.3V。
    *   一个状态指示 LED (D1) 通过限流电阻 R2 连接在 3.3V 和 `GPIO0` 之间，当 `GPIO0` 输出低电平时 LED 点亮。
*   **下载/扩展接口 (J4):** 提供了一个 6-Pin 接口，用于固件烧录和调试。
    *   `EN`: 系统主复位。
    *   `G0`: `GPIO0`。
    *   `GND`: 系统地。
    *   `3.3V`: 系统 3.3V 电源。
    *   `G1 (TXD)`: ESP32 的 UART0 发送端。
    *   `G3 (RXD)`: ESP32 的 UART0 接收端。
*   **Wi-Fi 天线:** 板载一个 IPEX 天线座 (ANT1)，用于连接外部 Wi-Fi 天线，以增强无线信号。

### **5. 摄像头专用供电电路**

为了满足 OV3660 传感器对多种电压的需求，设计了多级 LDO (低压差线性稳压器) 电路：
1.  **2.8V 电源:** 系统 3.3V (VCC_3V3) 输入到 LDO (U8, S-1155B28) 中，生成 2.8V (`CAM_VCC_2V8`)，为摄像头模拟部分 (AVDD) 供电。
2.  **1.8V 电源:** 由 2.8V 电源经过另一个 LDO (U9, S-1155B18) 降压，生成 1.8V (`CAM_VCC_1V8`)，为摄像头数字 I/O (DOVDD) 供电。
3.  **1.2V 电源:** 同样由 2.8V 电源经过 LDO (U10, S-1155B12) 降压，生成 1.2V (`CAM_VCC_1V2`)，为摄像头核心数字部分 (DVDD) 供电。
所有 LDO 的输入和输出端均配有滤波电容，以确保输出电压的纯净和稳定。

---

## 补充信息

好的，以下是基于原理图的补充技术说明，对前述描述进行深化和细化：

### **补充说明**

#### **1. 时钟系统**

*   **ESP32 时钟:** ESP32-WROVER-E 模组内部集成了 40MHz 晶体振荡器，为主处理器和 Wi-Fi/Bluetooth 无线电提供核心时钟基准。
*   **W5500 时钟:** W5500 以太网控制器 (U7) 的时钟由一个外部 25MHz 无源晶体 (Y2) 提供，连接在其 `XI` 和 `XO` 引脚上。此晶体是 W5500 内部锁相环 (PLL) 产生其工作所需时钟的必要条件，确保了以太网 PHY 的正常运行。

#### **2. 复位与启动模式逻辑**

*   **系统复位 (EN):** 电路的 `EN` 信号线是 ESP32 的主复位输入。该信号线连接到下载接口 (J4)，允许外部编程器控制复位。同时，摄像头的 `RESET` 引脚也连接到此 `EN` 信号线，确保在系统复位时，摄像头模块也同步复位。
*   **用户按键:** 按键 (SW1) 连接到 `GPIO37`，仅作为通用输入按键，不参与系统复位或启动模式选择。
*   **启动模式 (Boot Mode):** ESP32 的启动模式由 `GPIO0` 在复位时的电平决定。该引脚连接到状态 LED (D1) 和下载接口 (J4)。通过下载接口控制 `GPIO0` 和 `EN` 的电平，可以使 ESP32 进入 UART 下载模式以烧录固件。

#### **3. GPIO 引脚复用与设计约束**

原理图中存在重要的 GPIO 引脚复用情况，这是使用时必须注意的设计约束：

*   **`GPIO33` 复用:** 该引脚同时连接到 Grove 接口 (J3) 的 `SCL` 端和摄像头模块 (J2) 的 `PWDN` (Power Down) 端。
*   **`GPIO25` 复用:** 该引脚同时连接到 Grove 接口 (J3) 的 `SDA` 端和摄像头模块 (J2) 的 `SIO_C` (SCCB 时钟) 端。

**结论:** 这种连接方式意味着 Grove 接口的 I2C 功能与摄像头的功能存在硬件冲突。用户在软件层面必须进行仲裁管理：
*   当使用摄像头时，`GPIO33` 需作为输出控制摄像头掉电，`GPIO25` 作为 SCCB 时钟。此时 Grove 接口无法作为标准 I2C 使用。
*   当需要使用 Grove I2C 接口时，必须确保摄像头处于不活动状态，且软件中对 `GPIO33` 和 `GPIO25` 的配置已切换为 I2C 功能（SCL 和 SDA），这可能会导致摄像头无法正常控制。

#### **4. 电源滤波与去耦**

*   **输入滤波:** 在 PoE 模块 (U5) 的 5V 输出端 (VBUS)，布置有大容量电解电容 (C19) 和多个陶瓷电容 (C20, C21等)，用于滤除 DC-DC 转换器产生的开关噪声，并作为储能电容提供稳定的 5V 电源。
*   **芯片级去耦:** 在 ESP32 模组、W5500、Flash、PSRAM 以及各 LDO 稳压器的电源引脚附近，均放置了多个 0.1µF (100nF) 的陶瓷去耦电容。这些电容为芯片提供瞬时电流，滤除高频噪声，是保证高速数字电路稳定运行的关键设计。

#### **5. W5500 外围电路配置**

*   除了 SPI 接口和晶体，W5500 的正常工作还依赖于其外围的阻容配置。例如，其 `RSTn` 引脚通过电阻 R14 上拉至 3.3V，确保在无外部复位信号时处于正常工作状态。网络变压器侧的中心抽头通过电容接地，提供了共模噪声的泄放通路。这些元件共同构成了 W5500 的最小工作系统。

---

*该文档由 AI 自动生成，生成时间: 2025-11-18 01:17:19*
